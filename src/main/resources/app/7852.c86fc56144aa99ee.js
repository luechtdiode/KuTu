"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7852],{7852:(de,_,c)=>{c.r(_),c.d(_,{LastResultsPageModule:()=>ue});var h=c(177),d=c(4341),v=c(1313),a=c(7125),k=c(467),f=c(6354),I=c(5964),G=c(152),C=c(3294),F=c(7647),$=c(5558),y=c(8103),A=c(1413),j=c(4412),x=c(7673),b=c(1158),e=c(4020),L=c(2872),E=c(2350);function M(i,r){1&i&&(e.j41(0,"ion-avatar",4),e.nrm(1,"img",5),e.k0s())}function P(i,r){1&i&&(e.j41(0,"ion-avatar",4),e.nrm(1,"img",6),e.k0s())}function D(i,r){if(1&i&&(e.j41(0,"li")(1,"small")(2,"em"),e.EFF(3),e.k0s()()()),2&i){const t=r.$implicit;e.R7$(3),e.JRh(t)}}function O(i,r){if(1&i&&(e.j41(0,"ion-label"),e.EFF(1),e.nrm(2,"br"),e.EFF(3," \xa0\xa0\xa0\xa0\xa0\xa0"),e.j41(4,"small")(5,"em"),e.EFF(6),e.k0s()(),e.nrm(7,"br"),e.j41(8,"ul"),e.DNE(9,D,4,1,"li",7),e.k0s()()),2&i){const t=e.XpG();e.R7$(),e.Lme("",t.teilnehmer.Rang,". ",t.teilnehmer["Team/Athlet"],""),e.R7$(5),e.JRh(t.teilnehmerSubResults),e.R7$(3),e.Y8G("ngForOf",t.teamTeilnehmerSubResults)}}function N(i,r){if(1&i&&(e.j41(0,"ion-label"),e.EFF(1),e.j41(2,"small"),e.EFF(3),e.k0s(),e.nrm(4,"br"),e.EFF(5," \xa0\xa0\xa0\xa0\xa0\xa0"),e.j41(6,"small")(7,"em"),e.EFF(8),e.k0s()()()),2&i){const t=e.XpG();e.R7$(),e.E5c("",t.teilnehmer.Rang,". ",t.teilnehmer.Athlet," (",t.teilnehmer.Jahrgang,")\xa0"),e.R7$(2),e.SpI(" - ",t.teilnehmer.Verein,""),e.R7$(5),e.JRh(t.teilnehmerSubResults)}}function Y(i,r){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI("\xf8 Ger\xe4t ",t.teilnehmer["\xf8 Ger\xe4t"],"")}}function B(i,r){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme("Total D/E ",t.teilnehmer["Total D"],"/",t.teilnehmer["Total E"],"")}}function X(i,r){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme("Total A/B ",t.teilnehmer["Total A"],"/",t.teilnehmer["Total B"],"")}}let z=(()=>{class i{teilnehmerSubResults="";teamTeilnehmerSubResults=[];teilnehmer;selected;constructor(){}ngOnInit(){this.teilnehmerSubResults=S(this.teilnehmer),this.teamTeilnehmerSubResults=0==this.teilnehmer.rows?.length?[]:this.teilnehmer.rows.map(U)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["scorelist-item"]],inputs:{teilnehmer:"teilnehmer"},outputs:{selected:"selected"},standalone:!1,decls:12,vars:8,consts:[[3,"click"],["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end"],["slot","start"],["src","assets/imgs/athlete.png"],["src","assets/imgs/verein.png"],[4,"ngFor","ngForOf"]],template:function(n,s){1&n&&(e.j41(0,"ion-item",0),e.bIt("click",function(){return s.selected?s.selected.emit(s.teilnehmer):{}}),e.DNE(1,M,2,0,"ion-avatar",1)(2,P,2,0,"ion-avatar",1)(3,O,10,4,"ion-label",2)(4,N,9,5,"ion-label",2),e.j41(5,"ion-note",3)(6,"b"),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.DNE(9,Y,2,1,"em",2)(10,B,2,2,"em",2)(11,X,2,2,"em",2),e.k0s()()),2&n&&(e.R7$(),e.Y8G("ngIf",s.teilnehmer.Athlet),e.R7$(),e.Y8G("ngIf",s.teamTeilnehmerSubResults.length>0),e.R7$(),e.Y8G("ngIf",s.teamTeilnehmerSubResults.length>0),e.R7$(),e.Y8G("ngIf",s.teilnehmer.Athlet),e.R7$(3),e.SpI("Total Punkte ",s.teilnehmer["Total Punkte"],""),e.R7$(2),e.Y8G("ngIf",s.teilnehmer["\xf8 Ger\xe4t"]),e.R7$(),e.Y8G("ngIf",s.teilnehmer["Total D"]),e.R7$(),e.Y8G("ngIf",s.teilnehmer["Total A"]))},dependencies:[h.Sq,h.bT,a.mC,a.uz,a.he,a.JI],styles:["ion-note[_ngcontent-%COMP%]{text-align:end}"]})}return i})();const w=["athletID","rows","Rang","Athlet","Team","Team/Athlet","Jahrgang","Verein","K","\xf8 Ger\xe4t","Total D","Total E","Total A","Total B","Total Punkte"];function U(i){return`${i.Team} (${i.K}): ${S(i)}`}function S(i){return Object.keys(i).map(r=>`${r}`).filter(r=>w.indexOf(r)<0&&i[r].Endnote).map(r=>`${r}: ${i[r].Endnote} (${i[r].Rang})`).join(", ")}const R=i=>({"gradient-border":i});function V(i,r){if(1&i&&(e.j41(0,"ion-select-option",11),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const t=r.$implicit;e.Y8G("value",t.uuid),e.R7$(),e.SpI(" ",t.titel+" "+e.i5U(2,2,t.datum,"dd-MM-yy"),"")}}function J(i,r){if(1&i){const t=e.RV6();e.j41(0,"ion-select",9),e.mxI("ngModelChange",function(s){e.eBV(t);const o=e.XpG(2);return e.DH7(o.competition,s)||(o.competition=s),e.Njj(s)}),e.DNE(1,V,3,5,"ion-select-option",10),e.k0s()}if(2&i){const t=e.XpG(2);e.R50("ngModel",t.competition),e.R7$(),e.Y8G("ngForOf",t.getCompetitions())}}function Q(i,r){if(1&i&&(e.j41(0,"ion-col")(1,"ion-item"),e.DNE(2,J,2,2,"ion-select",8),e.k0s()()),2&i){const t=e.XpG();e.R7$(2),e.Y8G("ngIf",t.getCompetitions().length>0)}}function W(i,r){if(1&i&&(e.j41(0,"ion-note",12),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI(" ",t.competitionName()," ")}}function K(i,r){if(1&i){const t=e.RV6();e.j41(0,"ion-searchbar",13),e.mxI("ngModelChange",function(s){e.eBV(t);const o=e.XpG();return e.DH7(o.sMyQuery,s)||(o.sMyQuery=s),e.Njj(s)}),e.bIt("ionInput",function(s){e.eBV(t);const o=e.XpG();return e.Njj(o.reloadList(s))})("ionCancel",function(s){e.eBV(t);const o=e.XpG();return e.Njj(o.reloadList(s))}),e.k0s()}if(2&i){const t=e.XpG();e.R50("ngModel",t.sMyQuery)}}function H(i,r){if(1&i&&(e.j41(0,"ion-col",16)(1,"div",17),e.nrm(2,"result-display",18),e.k0s()()),2&i){const t=r.$implicit,n=e.XpG(3);e.BMQ("size-xl",n.getMaxColumnSpec()),e.R7$(),e.Y8G("ngClass",e.eq3(5,R,n.isNew(t))),e.R7$(),e.Y8G("item",t)("title",n.getTitle(t))("groupedBy",n.groupBy.PROGRAMM)}}function Z(i,r){if(1&i&&(e.j41(0,"ion-row"),e.DNE(1,H,3,7,"ion-col",15),e.k0s()),2&i){const t=r.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("ngForOf",n.getWertungen(t))}}function q(i,r){if(1&i&&(e.j41(0,"ion-grid",3),e.DNE(1,Z,2,1,"ion-row",14),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.getProgramme())}}function ee(i,r){if(1&i&&(e.j41(0,"ion-col",20)(1,"div",17),e.nrm(2,"result-display",18),e.k0s()()),2&i){const t=r.$implicit,n=e.XpG(3);e.BMQ("size-xl",n.getMaxColumnSpec()),e.R7$(),e.Y8G("ngClass",e.eq3(5,R,n.isNew(t))),e.R7$(),e.Y8G("item",t)("title",n.getTitle(t))("groupedBy",n.groupBy.PROGRAMM)}}function te(i,r){if(1&i&&(e.j41(0,"ion-row"),e.DNE(1,ee,3,7,"ion-col",19),e.k0s()),2&i){const t=r.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("ngForOf",n.getWertungen(t))}}function ie(i,r){if(1&i&&(e.j41(0,"ion-grid",3),e.DNE(1,te,2,1,"ion-row",14),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.getProgramme())}}function ne(i,r){if(1&i){const t=e.RV6();e.j41(0,"ion-item-option",24),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,o=e.sdS(1),l=e.XpG(3);return e.Njj(l.followAthlet(s,o))}),e.nrm(1,"ion-icon",25),e.EFF(2),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" Detail-Wertungen ",t.Athlet," ")}}function se(i,r){if(1&i){const t=e.RV6();e.j41(0,"ion-item-sliding",null,0)(2,"scorelist-item",21),e.bIt("click",function(){const s=e.eBV(t).$implicit,o=e.sdS(1),l=e.XpG(3);return e.Njj(l.scoreItemTapped(s,o))}),e.k0s(),e.j41(3,"ion-item-options",22),e.DNE(4,ne,3,1,"ion-item-option",23),e.k0s()()}if(2&i){const t=r.$implicit;e.R7$(2),e.Y8G("teilnehmer",t),e.R7$(2),e.Y8G("ngIf",t.athletID)}}function oe(i,r){if(1&i&&(e.j41(0,"div")(1,"ion-item-divider"),e.EFF(2),e.k0s(),e.DNE(3,se,5,2,"ion-item-sliding",14),e.k0s()),2&i){const t=r.$implicit;e.R7$(2),e.JRh(t.title.text),e.R7$(),e.Y8G("ngForOf",t.rows)}}function re(i,r){if(1&i&&(e.j41(0,"ion-list"),e.DNE(1,oe,4,2,"div",14),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.filteredScoreList)}}function le(i,r){if(1&i){const t=e.RV6();e.j41(0,"ion-footer")(1,"ion-toolbar")(2,"ion-button",26),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.presentActionSheet())}),e.nrm(3,"ion-icon",27),e.k0s()()()}}let ae=(()=>{class i{navCtrl;backendService;actionSheetController;groupBy=b.R;items=[];lastItems;geraete=[];scorelinks=[];defaultPath=void 0;scoreblocks=[];sFilteredScoreList=[];sMyQuery;tMyQueryStream=new A.B;sFilterTask=void 0;busy=new j.t(!1);durchgangopen;subscriptions=[];constructor(t,n,s){this.navCtrl=t,this.backendService=n,this.actionSheetController=s,this.backendService.competitions||this.backendService.getCompetitions(),this.backendService.durchgangStarted.pipe((0,f.T)(o=>o.filter(l=>l.wettkampfUUID===this.backendService.competition).length>0)).subscribe(o=>{this.durchgangopen=o})}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe())}ngOnInit(){this.subscriptions.push(this.backendService.competitionSubject.subscribe(t=>{this.backendService.activateNonCaptionMode(this.backendService.competition).subscribe(n=>{this.geraete=n||[],this.sortItems()}),this.subscriptions.push(this.backendService.newLastResults.subscribe(n=>{this.lastItems=this.items.map(s=>s.id*this.geraete.length+s.geraet),this.items=[],n&&n.results&&Object.keys(n.results).forEach(s=>{this.items.push(n.results[s])}),this.sortItems(),this.scorelistAvailable()?this.backendService.getScoreLists().subscribe(s=>{const o=this.competitionContainer();let l="";o.altersklassen&&o.altersklassen.trim().length>0?l=":Wettkampf%20Altersklassen":o.jahrgangsklassen&&o.jahrgangsklassen.trim().length>0&&(l=":Wettkampf%20JG-Altersklassen");const m=`/api/scores/${o.uuid}/query?groupby=Kategorie${l}:Geschlecht`;if(s){const g=Object.values(s).filter(p=>"Zwischenresultate"!=p.name).sort((p,pe)=>p.name.localeCompare(pe.name)),T={name:"Generische Rangliste",published:!0,"published-date":"","scores-href":m,"scores-query":m},he={name:"Generische Team-Rangliste",published:!0,"published-date":"","scores-href":m+"&kind=Teamrangliste","scores-query":m+"&kind=Teamrangliste"};this.scorelinks=this.teamsAllowed(o)?[...g,he,T]:[...g,T];const ge=this.scorelinks.filter(p=>""+p.published=="true");this.refreshScoreList(ge[0])}}):this.title="Aktuelle Resultate"}))}))}teamsAllowed(t){return t.teamrule?.trim().length>0&&"Keine Teams"!==t.teamrule}_title="Aktuelle Resultate";get title(){return this._title}set title(t){this._title=t}refreshScoreList(t){let n=t["scores-href"];t.published||(n=t["scores-query"]),n.startsWith("/")&&(n=n.substring(1)),n=n.replace("html",""),this.title=t.name,this.defaultPath=n,this.backendService.getScoreList(this.defaultPath).pipe((0,f.T)(s=>s.title&&s.scoreblocks?s.scoreblocks:[])).subscribe(s=>{this.scoreblocks=s;const o=this.tMyQueryStream.pipe((0,I.p)(l=>!!l&&!!l.target&&!!l.target.value),(0,f.T)(l=>l.target.value),(0,G.B)(1e3),(0,C.F)(),(0,F.u)());o.subscribe(()=>{this.busy.next(!0)}),o.pipe((0,$.n)(this.runQuery(s))).subscribe(l=>{this.sFilteredScoreList=l,this.busy.next(!1)})})}sortItems(){this.items=this.items.filter(n=>void 0!==n.wertung.endnote).sort((n,s)=>{let o=n.programm.localeCompare(s.programm);return 0===o&&(o=this.geraetOrder(n.geraet)-this.geraetOrder(s.geraet)),o})}isNew(t){return 0===this.lastItems.filter(n=>n===t.id*this.geraete.length+t.geraet).length}get stationFreezed(){return this.backendService.stationFreezed}set competition(t){this.stationFreezed||(this.backendService.getDurchgaenge(t),this.backendService.activateNonCaptionMode(this.backendService.competition).subscribe(n=>{this.geraete=n||[],this.sortItems()}))}get competition(){return this.backendService.competition||""}getCompetitions(){return this.backendService.competitions||[]}competitionContainer(){const t={titel:"",datum:new Date,auszeichnung:void 0,auszeichnungendnote:void 0,id:void 0,uuid:void 0,programmId:0,teamrule:""};if(!this.backendService.competitions)return t;const n=this.backendService.competitions.filter(s=>s.uuid===this.backendService.competition);return 1===n.length?n[0]:t}competitionName(){const t=this.competitionContainer();return""===t.titel?"":t.titel+", am "+(t.datum+"T").split("T")[0].split("-").reverse().join("-")}geraetOrder(t){return this.geraete?this.geraete.findIndex(n=>n.id===t):0}geraetText(t){if(!this.geraete)return"";const n=this.geraete.filter(s=>s.id===t).map(s=>s.name);return 1===n.length?n[0]:""}getColumnSpec(){return this.geraete?.length||0}getMaxColumnSpec(){return Math.min(12,Math.max(1,Math.floor(12/this.geraete.length+.5)))}getTitle(t){return t.programm+" - "+this.geraetText(t.geraet)}onlyUnique(t,n,s){return s.indexOf(t)===n}getProgramme(){return this.items.map(t=>t.programm).filter(this.onlyUnique)}getWertungen(t){return this.items.filter(n=>n.programm===t)}scorelistAvailable(){return!this.durchgangopen&&0===this.items?.length&&new Date(this.competitionContainer().datum).getTime()<new Date(Date.now()-864e5).getTime()}get filteredScoreList(){return this.sFilteredScoreList&&this.sFilteredScoreList.length>0?this.sFilteredScoreList:this.getScoreListItems()}get isBusy(){return this.busy}runQuery(t){return n=>{const s=n.trim();let o=[];return s&&t&&t.forEach(l=>{const m=this.filter(s),u=l.rows.filter(g=>m(g,l));if(u.length>0){const g={title:l.title,rows:u};o=[...o,g]}}),(0,x.of)(o)}}filter(t){const n=t.toUpperCase(),s=n.split(" ");return(o,l)=>l.title.text.toUpperCase().indexOf(n)>-1||s.filter(m=>[o,...o.rows].find(u=>{if(u.Athlet?.toUpperCase().indexOf(m)>-1||u["Team/Athlet"]?.toUpperCase().indexOf(m)>-1||u.Team?.toUpperCase().indexOf(m)>-1||u.Verein?.toUpperCase().indexOf(m)>-1||u.Jahrgang?.toUpperCase()===m||l.title.text.toUpperCase().replace("."," ").replace(","," ").split(" ").indexOf(m)>-1)return!0})).length===s.length}reloadList(t){this.tMyQueryStream.next(t)}makeGenericScoreListLink(){return`${y.EV}${this.defaultPath}&html`}getScoreListItems(){return this.scoreblocks}scoreItemTapped(t,n){n.getOpenAmount().then(s=>{s>0?n.close():n.open("end")})}followAthlet(t,n){n.close(),t.athletID&&this.navCtrl.navigateForward(`athlet-view/${this.backendService.competition}/${t.athletID}`)}open(){window.open(this.makeGenericScoreListLink(),"_blank")}isShareAvailable(){return!!navigator&&!!navigator.share}share(){let t="GeTu";const s=this.competitionContainer();""!==s.titel&&(t={1:"Athletik",11:"KuTu",20:"GeTu",31:"KuTu"}[s.programmId]);let o=`${this.competitionName()} #${t}-${s.titel.replace(","," ").split(" ").join("_")}`;this.isShareAvailable()&&navigator.share({title:`${t} Rangliste`,text:o,url:this.makeGenericScoreListLink()}).then(function(){console.log("Article shared")}).catch(function(l){console.log(l.message)})}presentActionSheet(){var t=this;return(0,k.A)(function*(){let n=[...t.scorelinks.map(l=>""+l.published=="true"?{text:`${l.name} anzeigen ...`,icon:"document",handler:()=>{t.refreshScoreList(l)}}:{text:`${l.name} (unver\xf6ffentlicht)`,icon:"today-outline",handler:()=>{t.refreshScoreList(l)}}),{text:"Rangliste \xf6ffnen ...",icon:"open",handler:()=>{t.open()}}];t.isShareAvailable()&&(n=[...n,{text:"Teilen / Share ...",icon:"share",handler:()=>{t.share()}}]);let s={header:"Aktionen",cssClass:"my-actionsheet-class",buttons:n};yield(yield t.actionSheetController.create(s)).present()})()}static \u0275fac=function(n){return new(n||i)(e.rXU(L.q9),e.rXU(E.m),e.rXU(a.GD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-last-results"]],standalone:!1,decls:20,vars:8,consts:[["slidingAthletScoreItem",""],["slot","start"],["slot","icon-only","name","menu"],["no-padding",""],[4,"ngIf"],["slot","end",4,"ngIf"],["placeholder","Search","showCancelButton","never",3,"ngModel","ngModelChange","ionInput","ionCancel",4,"ngIf"],["no-padding","",4,"ngIf"],["label","Wettkampf","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["label","Wettkampf","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","end"],["placeholder","Search","showCancelButton","never",3,"ngModelChange","ionInput","ionCancel","ngModel"],[4,"ngFor","ngForOf"],["class","align-self-start","size-xs","12","size-md","6","size-lg","3",4,"ngFor","ngForOf"],["size-xs","12","size-md","6","size-lg","3",1,"align-self-start"],[3,"ngClass"],[3,"item","title","groupedBy"],["class","align-self-start","size-xs","12","size-sm","6","size-md","4","size-lg","3",4,"ngFor","ngForOf"],["size-xs","12","size-sm","6","size-md","4","size-lg","3",1,"align-self-start"],[3,"click","teilnehmer"],["side","end"],["color","primary",3,"click",4,"ngIf"],["color","primary",3,"click"],["name","arrow-forward-circle-outline","ios","md-arrow-forward-circle-outline"],["size","large","expand","block","color","primary",3,"click"],["slot","start","name","list"]],template:function(n,s){1&n&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-menu-toggle")(4,"ion-button"),e.nrm(5,"ion-icon",2),e.k0s()()(),e.j41(6,"ion-title")(7,"ion-grid",3)(8,"ion-row")(9,"ion-col")(10,"ion-label"),e.EFF(11),e.k0s()(),e.DNE(12,Q,3,1,"ion-col",4),e.k0s()()(),e.DNE(13,W,2,1,"ion-note",5),e.k0s(),e.DNE(14,K,1,1,"ion-searchbar",6),e.k0s(),e.j41(15,"ion-content"),e.DNE(16,q,2,1,"ion-grid",7)(17,ie,2,1,"ion-grid",7)(18,re,2,1,"ion-list",4),e.k0s(),e.DNE(19,le,4,0,"ion-footer",4)),2&n&&(e.R7$(11),e.JRh(s.title),e.R7$(),e.Y8G("ngIf",!s.competition),e.R7$(),e.Y8G("ngIf",s.competition),e.R7$(),e.Y8G("ngIf",s.scorelistAvailable()),e.R7$(2),e.Y8G("ngIf",s.items.length>0&&6===s.getColumnSpec()),e.R7$(),e.Y8G("ngIf",s.items.length>0&&6!==s.getColumnSpec()),e.R7$(),e.Y8G("ngIf",s.scorelistAvailable()),e.R7$(),e.Y8G("ngIf",s.scorelistAvailable()))},dependencies:[h.YU,h.Sq,h.bT,d.BC,d.vS,a.Jm,a.QW,a.hU,a.W9,a.M0,a.lO,a.eU,a.iq,a.uz,a.Dg,a.LU,a.CE,a.A7,a.he,a.nf,a.cA,a.JI,a.ln,a.S1,a.Nm,a.Ip,a.BC,a.ai,a.Je,a.Gw,b.v,z,h.vh],encapsulation:2})}return i})();var ce=c(5079);const me=[{path:"",component:ae}];let ue=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=e.$C({type:i});static \u0275inj=e.G2t({imports:[h.MD,d.YN,a.bv,v.iI.forChild(me),ce.h]})}return i})()}}]);