import{B as r,Ba as J,Bb as Ie,C as o,D as p,E as v,Ea as U,Fa as Z,G as S,H as g,Ha as Q,Ja as X,Ka as $,N as C,Na as ee,O as d,Oa as te,P as y,Pa as ie,Q as k,Qa as ne,Ra as re,S as T,Sa as ae,T as f,Ta as oe,U as b,Ua as le,V as I,Y as F,Ya as se,Z as V,Za as de,ab as ce,ba as O,ca as L,db as ge,ea as W,fb as me,ga as N,gb as he,kb as ue,lb as pe,m as E,ma as B,nb as _e,o as h,p as u,qa as D,r as M,rb as fe,sa as G,t as l,ta as j,u as w,ua as q,ub as be,v as P,va as z,w as R,wa as H,wb as x,x as _,xa as K,z as s,za as Y}from"./chunk-SCHL4OOB.js";import"./chunk-RTI2IBQE.js";import"./chunk-YPCCWTCR.js";import"./chunk-IXGCB5RR.js";import"./chunk-LOHYXAXQ.js";import"./chunk-N7UIYTQY.js";import"./chunk-HC6MZPB3.js";import"./chunk-J5OMF6R4.js";import"./chunk-KWW2H4SN.js";import"./chunk-7HA5TF5T.js";import"./chunk-ADN7P72M.js";import"./chunk-426OJ4HC.js";import"./chunk-RPQZFOYD.js";import"./chunk-GIGBYVJT.js";import"./chunk-MM5QLNJM.js";import"./chunk-H3GX5QFY.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-YPW7SQSE.js";import"./chunk-MCRJI3T3.js";import"./chunk-PL2JVG7G.js";import"./chunk-ACERUE7O.js";import"./chunk-2R6CW7ES.js";function Ae(n,m){n&1&&(r(0,"ion-label"),d(1," Athlet / Athletin "),o())}function Ce(n,m){if(n&1&&(r(0,"ion-select-option",16)(1,"ion-avatar",5),p(2,"img",10),o(),r(3,"ion-label"),d(4),p(5,"br"),r(6,"small"),d(7),F(8,"date"),o()()()),n&2){let e=m.$implicit;s("value",e.athletId),l(4),T("",e.name,", ",e.vorname," (",e.geschlecht,")"),l(3),k(" (",V(8,5,e.gebdat),")")}}function ke(n,m){if(n&1){let e=v();r(0,"ion-select",19),I("ngModelChange",function(i){h(e);let a=g(2);return b(a.selectedClubAthletId,i)||(a.selectedClubAthletId=i),u(i)}),_(1,Ce,9,7,"ion-select-option",20),o()}if(n&2){let e=g(2);f("ngModel",e.selectedClubAthletId),l(),s("ngForOf",e.clubAthletList)}}function Se(n,m){n&1&&(r(0,"ion-item-divider")(1,"ion-avatar",3),p(2,"img",21),o(),r(3,"ion-label"),d(4,"Einteilung"),o()())}function ye(n,m){if(n&1&&(r(0,"ion-select-option",16),d(1),o()),n&2){let e=m.$implicit;s("value",e.id),l(),y(e.name)}}function Ee(n,m){if(n&1){let e=v();r(0,"ion-item")(1,"ion-avatar",3),d(2," \xA0 "),o(),r(3,"ion-select",22),I("ngModelChange",function(i){h(e);let a=g(2);return b(a.registration.programId,i)||(a.registration.programId=i),u(i)}),_(4,ye,2,2,"ion-select-option",20),o()()}if(n&2){let e=g(2);l(3),f("ngModel",e.registration.programId),l(),s("ngForOf",e.filterPGMsForAthlet(e.registration))}}function Me(n,m){n&1&&(r(0,"ion-item-divider")(1,"ion-avatar",3),p(2,"img",23),o(),r(3,"ion-label"),d(4,"Team-/Mannschaftszuweisung"),o()())}function Pe(n,m){if(n&1&&(r(0,"ion-row"),d(1),o()),n&2){let e=m.$implicit;l(),k("f\xFCr ",e,"")}}function Re(n,m){if(n&1&&(r(0,"ion-select-option",16),d(1),o()),n&2){let e=m.$implicit,t=g(3);s("value",e.index),l(),y(t.mapTeam(e.index))}}function Te(n,m){if(n&1){let e=v();r(0,"ion-item"),p(1,"ion-avatar",3),r(2,"ion-grid",24),_(3,Pe,2,1,"ion-row",25),r(4,"ion-row")(5,"ion-select",26),I("ngModelChange",function(i){h(e);let a=g(2);return b(a.registration.team,i)||(a.registration.team=i),u(i)}),r(6,"ion-select-option",16),d(7,"Keine Teamzuordnung"),o(),_(8,Re,2,2,"ion-select-option",20),o()()()()}if(n&2){let e=g(2);l(3),s("ngForOf",e.teamrules),l(2),f("ngModel",e.registration.team),l(),s("value",0),l(2),s("ngForOf",e.teams)}}function Fe(n,m){if(n&1){let e=v();r(0,"ion-content")(1,"form",9,0),S("ngSubmit",function(){h(e);let i=C(2),a=g();return u(a.save(i))})("keyup.enter",function(){h(e);let i=C(2),a=g();return u(a.save(i))}),r(3,"ion-list")(4,"ion-item-divider")(5,"ion-avatar",3),p(6,"img",10),o(),_(7,Ae,2,0,"ion-label",7)(8,ke,2,2,"ion-select",11),o(),r(9,"ion-item")(10,"ion-avatar",3),d(11," \xA0 "),o(),r(12,"ion-input",12),I("ngModelChange",function(i){h(e);let a=g();return b(a.registration.name,i)||(a.registration.name=i),u(i)}),o()(),r(13,"ion-item")(14,"ion-avatar",3),d(15," \xA0 "),o(),r(16,"ion-input",13),I("ngModelChange",function(i){h(e);let a=g();return b(a.registration.vorname,i)||(a.registration.vorname=i),u(i)}),o()(),r(17,"ion-item")(18,"ion-avatar",3),d(19," \xA0 "),o(),r(20,"ion-input",14),I("ngModelChange",function(i){h(e);let a=g();return b(a.registration.gebdat,i)||(a.registration.gebdat=i),u(i)}),o()(),r(21,"ion-item")(22,"ion-avatar",3),d(23," \xA0 "),o(),r(24,"ion-select",15),I("ngModelChange",function(i){h(e);let a=g();return b(a.registration.geschlecht,i)||(a.registration.geschlecht=i),u(i)}),r(25,"ion-select-option",16),d(26,"weiblich"),o(),r(27,"ion-select-option",16),d(28,"m\xE4nnlich"),o()()(),_(29,Se,5,0,"ion-item-divider",7)(30,Ee,5,2,"ion-item",7)(31,Me,5,0,"ion-item-divider",7)(32,Te,9,4,"ion-item",7),o(),r(33,"ion-list")(34,"ion-button",17,1),p(36,"ion-icon",18),d(37,"Speichern"),o()()()()}if(n&2){let e=C(2),t=g();l(7),s("ngIf",t.registration.id>0),l(),s("ngIf",t.registration.id===0&&t.clubAthletList.length>0),l(4),s("disabled",!1),f("ngModel",t.registration.name),l(4),s("disabled",!1),f("ngModel",t.registration.vorname),l(4),s("disabled",!1),f("ngModel",t.registration.gebdat),l(4),f("ngModel",t.registration.geschlecht),l(),s("value","W"),l(2),s("value","M"),l(2),s("ngIf",t.needsPGMChoice()),l(),s("ngIf",t.needsPGMChoice()),l(),s("ngIf",t.teamsAllowed()),l(),s("ngIf",t.teamsAllowed()),l(2),s("disabled",t.waiting||!t.isFormValid()||!e.valid||e.untouched)}}function Ve(n,m){if(n&1){let e=v();r(0,"ion-button",27,2),S("click",function(){h(e);let i=g();return u(i.delete())}),p(2,"ion-icon",28),d(3,"Anmeldung l\xF6schen"),o()}if(n&2){let e=g();s("disabled",e.waiting)}}var we=(()=>{class n{navCtrl;route;backendService;alertCtrl;zone;constructor(e,t,i,a,c){this.navCtrl=e,this.route=t,this.backendService=i,this.alertCtrl=a,this.zone=c}waiting=!1;registration;wettkampf;wettkampfFull;regId;athletId;wkId;wkPgms;teams;wettkampfId;clubAthletList;clubAthletListCurrent;_selectedClubAthletId;ngOnInit(){this.waiting=!0,this.wkId=this.route.snapshot.paramMap.get("wkId"),this.regId=parseInt(this.route.snapshot.paramMap.get("regId")),this.athletId=parseInt(this.route.snapshot.paramMap.get("athletId")),this.backendService.getCompetitions().subscribe(e=>{let t=e.find(i=>i.uuid===this.wkId);this.wettkampfId=parseInt(t.id),this.backendService.loadProgramsForCompetition(t.uuid).subscribe(i=>{this.wkPgms=i,this.backendService.loadTeamsListForClub(this.wkId,this.regId).subscribe(a=>{this.teams=a.filter(c=>c.name?.trim().length>0),this.backendService.loadAthletListForClub(this.wkId,this.regId).subscribe(c=>{this.clubAthletList=c,this.backendService.loadAthletRegistrations(this.wkId,this.regId).subscribe(A=>{this.clubAthletListCurrent=A,this.athletId?this.updateUI(A.find(ve=>ve.id===this.athletId)):this.updateUI({id:0,vereinregistrationId:this.regId,name:"",vorname:"",geschlecht:"W",gebdat:void 0,programId:void 0,team:0,registrationTime:0})})})})})})}get selectedClubAthletId(){return this._selectedClubAthletId}set selectedClubAthletId(e){this._selectedClubAthletId=e,this.registration=this.clubAthletList.find(t=>t.athletId===e)}get teamrules(){return(this.wettkampfFull.teamrule||"").split(",")}needsPGMChoice(){let e=[...this.wkPgms][0];return!(e.aggregate==1&&e.riegenmode>1)}alter(e){if(this.wettkampfFull.altersklassen?.trim().length==0){let t=new Date(x(e.gebdat)).getFullYear();return new Date(this.wettkampfFull.datum).getFullYear()-t}else{let t=Math.abs(new Date(this.wettkampfFull.datum).getTime()-new Date(e.gebdat).getTime());return Math.floor(t/(1e3*3600*24)/365.25)}}similarRegistration(e,t){return e.athletId>0&&t.athletId>0&&e.athletId===t.athletId||e.name===t.name&&e.vorname===t.vorname&&e.gebdat===t.gebdat&&e.geschlecht===t.geschlecht}alternatives(e){return this.clubAthletListCurrent?.filter(t=>this.similarRegistration(t,e)&&t.id!=e.id)||[]}getAthletPgm(e){return this.wkPgms.find(t=>t.id===e.programId)||Object.assign({parent:0})}filterPGMsForAthlet(e){let t=this.alter(e),i=this.alternatives(e);return this.wkPgms.filter(a=>(a.alterVon||0)<=t&&(a.alterBis||100)>=t&&i.filter(c=>c.programId===a.id||this.getAthletPgm(c).parentId===a.parentId).length===0)}teamsAllowed(){return this.wettkampfFull.teamrule?.length>0&&this.wettkampfFull.teamrule!=="Keine Teams"}mapTeam(e){return[...this.teams.filter(t=>t.index==e).map(t=>t.index>0?t.name+" "+t.index:t.name),""][0]}editable(){return this.backendService.loggedIn}updateUI(e){this.zone.run(()=>{this.waiting=!1,this.wettkampf=this.backendService.competitionName,this.wettkampfFull=this.backendService.currentCompetition(),this.registration=Object.assign({},e),this.registration.gebdat=x(this.registration.gebdat),this.registration.team||(this.registration.team=0)})}isFormValid(){return!this.registration?.programId&&!this.needsPGMChoice()&&(this.registration.programId=this.filterPGMsForAthlet(this.registration)[0]?.id),!!this.registration.gebdat&&!!this.registration.geschlecht&&this.registration.geschlecht.length>0&&!!this.registration.name&&this.registration.name.length>0&&!!this.registration.vorname&&this.registration.vorname.length>0&&!!this.registration.programId&&this.registration.programId>0&&(!this.teamsAllowed()||(!!this.registration.team||this.registration.team===0)&&!isNaN(this.registration.team))}checkPersonOverride(e){if(e.athletId){let t=[...this.clubAthletListCurrent,...this.clubAthletList].find(i=>i.athletId===e.athletId);if(t.geschlecht!==e.geschlecht||new Date(x(t.gebdat)).toJSON()!==new Date(x(e.gebdat)).toJSON()||t.name!==e.name||t.vorname!==e.vorname)return!0}return!1}save(e){if(!e.valid)return;let t=Object.assign({},this.registration,{gebdat:new Date(e.value.gebdat).toJSON(),team:e.value.team?e.value.team:0,athletId:this.registration.athletId>0?this.registration.athletId:0});this.athletId===0||t.id===0?(this.needsPGMChoice()||this.filterPGMsForAthlet(this.registration).filter(i=>i.id!==t.programId).forEach(i=>{this.backendService.createAthletRegistration(this.wkId,this.regId,Object.assign({},t,{programId:i.id}))}),this.backendService.createAthletRegistration(this.wkId,this.regId,t).subscribe(()=>{this.navCtrl.pop()})):this.checkPersonOverride(t)?this.alertCtrl.create({header:"Achtung",subHeader:"Person \xFCberschreiben vs korrigieren",message:"Es wurden \xC4nderungen an den Personen-Feldern vorgenommen. Diese sind ausschliesslich f\xFCr Korrekturen zul\xE4ssig. Die Identit\xE4t der Person darf dadurch nicht ge\xE4ndert werden!",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"Korektur durchf\xFChren",handler:()=>{this.backendService.saveAthletRegistration(this.wkId,this.regId,t).subscribe(()=>{this.clubAthletListCurrent.filter(c=>this.similarRegistration(this.registration,c)).filter(c=>c.id!==this.registration.id).forEach(c=>{let A=Object.assign({},t,{id:c.id,registrationTime:c.registrationTime,programId:c.programId});this.backendService.saveAthletRegistration(this.wkId,this.regId,A)}),this.navCtrl.pop()})}}]}).then(c=>c.present()):this.backendService.saveAthletRegistration(this.wkId,this.regId,t).subscribe(()=>{this.navCtrl.pop()})}delete(){this.alertCtrl.create({header:"Achtung",subHeader:"L\xF6schen der Athlet-Anmeldung am Wettkampf",message:"Hiermit wird die Anmeldung von "+this.registration.name+", "+this.registration.vorname+" am Wettkampf gel\xF6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.needsPGMChoice()||this.clubAthletListCurrent.filter(t=>this.similarRegistration(this.registration,t)).filter(t=>t.id!==this.registration.id).forEach(t=>{this.backendService.deleteAthletRegistration(this.wkId,this.regId,t)}),this.backendService.deleteAthletRegistration(this.wkId,this.regId,this.registration).subscribe(()=>{this.navCtrl.pop()})}}]}).then(t=>t.present())}static \u0275fac=function(t){return new(t||n)(w(J),w(B),w(Ie),w(fe),w(M))};static \u0275cmp=P({type:n,selectors:[["app-reg-athlet-editor"]],standalone:!1,decls:14,vars:3,consts:[["athletRegistrationForm","ngForm"],["btnSaveNext",""],["btnDelete",""],["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[4,"ngIf"],["size","large","expand","block","color","danger",3,"disabled","click",4,"ngIf"],[3,"ngSubmit","keyup.enter"],["src","assets/imgs/athlete.png"],["label","Athlet / Athletin","placeholder","Auswahl aus Liste","name","clubAthletid","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["label","Name","required","","placeholder","Name","type","text","name","name","required","",3,"ngModelChange","disabled","ngModel"],["label","Vorname","required","","placeholder","Vorname","type","text","name","vorname","required","",3,"ngModelChange","disabled","ngModel"],["label","Geburtsdatum","required","","placeholder","Geburtsdatum","type","date","display-timezone","utc","name","gebdat","required","",3,"ngModelChange","disabled","ngModel"],["label","Geschlecht","required","","placeholder","bitte ausw\xE4hlen","name","geschlecht","okText","Okay","cancelText","Abbrechen","required","",3,"ngModelChange","ngModel"],[3,"value"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["slot","start","name",""],["label","Athlet / Athletin","placeholder","Auswahl aus Liste","name","clubAthletid","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["src","assets/imgs/wettkampf.png"],["label","Programm/Kategorie","required","","placeholder","bitte ausw\xE4hlen","name","programId","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["src","assets/imgs/verein.png"],["no-padding",""],[4,"ngFor","ngForOf"],["label","Team","placeholder","Team","name","team","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["size","large","expand","block","color","danger",3,"click","disabled"],["slot","start","name","trash"]],template:function(t,i){t&1&&(r(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",3),p(3,"ion-back-button",4),o(),r(4,"ion-title"),d(5,"Anmeldung Athlet/Athletin"),o(),r(6,"ion-note",5)(7,"div",6),d(8),o()()()(),_(9,Fe,38,16,"ion-content",7),r(10,"ion-footer")(11,"ion-toolbar")(12,"ion-list"),_(13,Ve,4,1,"ion-button",8),o()()()),t&2&&(l(8),k("f\xFCr ",i.wettkampf,""),l(),s("ngIf",i.registration),l(4),s("ngIf",i.athletId>0))},dependencies:[O,L,H,G,j,K,z,q,Q,X,$,ee,te,ie,ne,re,ae,oe,le,se,de,ce,ge,me,he,ue,pe,U,Z,_e,W],styles:[".teamlabel[_ngcontent-%COMP%]{padding-top:10p}"]})}return n})();var Oe=[{path:"",component:we}],Je=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=R({type:n});static \u0275inj=E({imports:[N,Y,be,D.forChild(Oe)]})}return n})();export{Je as RegAthletEditorPageModule};
