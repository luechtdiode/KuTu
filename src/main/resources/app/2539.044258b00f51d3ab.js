"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2539],{58:(J,p,u)=>{u.r(p),u.d(p,{WertungEditorPageModule:()=>E});var d=u(6895),g=u(433),h=u(5472),r=u(502),m=u(5861);const _=(0,u(7423).fo)("Keyboard");var e=u(8274),v=u(600);function f(o,l){if(1&o&&(e.TgZ(0,"ion-label"),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Oqu(t.title)}}function w(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-input",5,6),e.NdJ("ngModelChange",function(i){e.CHM(t);const s=e.oxw();return e.KtG(s.singleValueContainer.value=i)}),e.qZA()}if(2&o){const t=e.oxw();e.MGl("name","",t.valueTitle,"0"),e.Q6J("disabled",t.waiting)("ngModel",t.singleValueContainer.value)}}function C(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-button",7),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.add())}),e._UZ(1,"ion-icon",8),e.qZA()}}function x(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-row")(1,"ion-col",13),e._uU(2),e.qZA(),e.TgZ(3,"ion-col",14),e._UZ(4,"div",15),e.TgZ(5,"ion-input",16),e.NdJ("ionChange",function(i){const a=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onChange(i,a))})("ionBlur",function(i){const a=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.onBlur(i,a))}),e.qZA()(),e.TgZ(6,"ion-col",17)(7,"ion-button",18),e.NdJ("click",function(){const s=e.CHM(t).index,a=e.oxw(2);return e.KtG(a.remove(s))}),e._UZ(8,"ion-icon",19),e.qZA()()()}if(2&o){const t=l.$implicit,n=l.index,i=e.oxw(2);e.xp6(2),e.hij("",n+1,". Wertung"),e.xp6(3),e.hYB("name","",i.valueTitle,"",n,""),e.Q6J("disabled",i.waiting)("ngModel",t.value)}}function M(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-grid",9)(1,"ion-row",10)(2,"ion-col"),e._uU(3),e.qZA()(),e.YNc(4,x,9,5,"ion-row",11),e.TgZ(5,"ion-row",10)(6,"ion-col")(7,"ion-button",12),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.add())}),e._UZ(8,"ion-icon",8),e.qZA()()()()}if(2&o){const t=e.oxw();e.xp6(3),e.AsE("",t.title," - \xf8 ",t.calcAvg(),""),e.xp6(1),e.Q6J("ngForOf",t.singleValues)}}let k=(()=>{class o{constructor(){this.avgValue=new e.vpe,this.singleValues=[]}ngOnInit(){this.singleValues=[{value:this.singleValue}]}get title(){return this.valueTitle}get singleValueContainer(){return this.singleValues[0]}add(){this.singleValues=[...this.singleValues,{value:0}]}remove(t){t>-1&&this.singleValues.splice(t,1)}onChange(t,n){n.value=t.target.value}onBlur(t,n){n.value=Number(t.target.value).toFixed(3)}calcAvg(){const t=this.singleValues.filter(i=>!!i.value).map(i=>Number(i.value)).filter(i=>i>0),n=Number((t.reduce((i,s)=>i+s,0)/t.length).toFixed(3));return this.avgValue.emit(n),n}}return o.\u0275fac=function(t){return new(t||o)},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-wertung-avg-calc"]],inputs:{hidden:"hidden",readonly:"readonly",waiting:"waiting",valueTitle:"valueTitle",valueDescription:"valueDescription",singleValue:"singleValue"},outputs:{avgValue:"avgValue"},decls:5,vars:5,consts:[[3,"hidden"],[4,"ngIf"],["autofocus","","placeholder","Notenwert im Format ##.## (2-3 Nachkommastellen mit Dezimalpunkt)","type","number","step","0.050","min","0.000","max","100.000","required","",3,"disabled","ngModel","name","ngModelChange",4,"ngIf"],["slot","end","expand","block","color","secondary",3,"click",4,"ngIf"],["class","table","no-padding","",4,"ngIf"],["autofocus","","placeholder","Notenwert im Format ##.## (2-3 Nachkommastellen mit Dezimalpunkt)","type","number","step","0.050","min","0.000","max","100.000","required","",3,"disabled","ngModel","name","ngModelChange"],["enote",""],["slot","end","expand","block","color","secondary",3,"click"],["name","add-circle-outline"],["no-padding","",1,"table"],[1,"table-header"],[4,"ngFor","ngForOf"],["expand","block","color","secondary",3,"click"],[1,"number"],["id","input-group","no-padding",""],["id","validity"],["placeholder","Notenwert im Format ##.## (2-3 Nachkommastellen mit Dezimalpunkt)","type","number","step","0.050","min","0.000","max","100.000","required","",3,"name","disabled","ngModel","ionChange","ionBlur"],[1,"table-subject"],["color","danger",3,"click"],["name","trash-outline"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-item",0),e.YNc(1,f,2,1,"ion-label",1),e.YNc(2,w,2,3,"ion-input",2),e.YNc(3,C,2,0,"ion-button",3),e.YNc(4,M,9,3,"ion-grid",4),e.qZA()),2&t&&(e.Q6J("hidden",n.hidden),e.xp6(1),e.Q6J("ngIf",n.singleValues.length<2),e.xp6(1),e.Q6J("ngIf",n.singleValues.length<2),e.xp6(1),e.Q6J("ngIf",n.singleValues.length<2),e.xp6(1),e.Q6J("ngIf",n.singleValues.length>1))},dependencies:[d.sg,d.O5,g.JJ,g.Q7,g.On,r.YG,r.wI,r.jY,r.gu,r.pK,r.Ie,r.Q$,r.Nd,r.as],styles:[".table[_ngcontent-%COMP%]{background-color:var(--ion-background-color);height:100%;overflow:hidden;overflow-y:auto}.table[_ngcontent-%COMP%]   .table-header[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   .table-subject[_ngcontent-%COMP%]{color:var(--ion-color-primary);font-weight:700}.table[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-wrap:nowrap}.table[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col.table-subject[_ngcontent-%COMP%]{flex:0 0 1.5em}.table[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]   ion-col.number[_ngcontent-%COMP%]{flex:0 0 6em;letter-spacing:.5px}@media all and (min-height: 720px){.table[_ngcontent-%COMP%]   ion-row[_ngcontent-%COMP%]{margin:10px}}#input-group[_ngcontent-%COMP%]{height:70%;overflow:hidden}#input-group[_ngcontent-%COMP%]   #validity[_ngcontent-%COMP%]{width:0;height:0;position:absolute;top:0%;right:0%;border-left:15px solid transparent;border-top:15px solid transparent}#input-group[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{height:100%;width:100%;outline:none;text-align:right;border:1px solid #a9a9a9}#input-group.valid[_ngcontent-%COMP%]   #validity[_ngcontent-%COMP%]{border-left:15px solid transparent;border-top:15px solid var(--ion-color-success)}#input-group.valid[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{border:1px solid var(--ion-color-success)}#input-group.invalid[_ngcontent-%COMP%]   #validity[_ngcontent-%COMP%]{border-left:15px solid transparent;border-top:15px solid var(--ion-color-danger)}#input-group.invalid[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{border:1px solid var(--ion-color-danger)}"]}),o})();const O=["wertungsform"],I=["enote"],Z=["dnote"];function T(o,l){1&o&&(e.TgZ(0,"ion-item"),e._uU(1," Ung\xfcltige Eingabe. Die Werte m\xfcssen im Format ##.## (2-3 Nachkommastellen mit Dezimalpunkt) eingegeben werden. "),e.qZA())}function P(o,l){if(1&o&&(e.TgZ(0,"ion-button",13,14),e._UZ(2,"ion-icon",15),e._uU(3,"Speichern & Weiter"),e.qZA()),2&o){const t=e.oxw(),n=e.MAs(13);e.Q6J("disabled",t.waiting||!n.valid)}}function A(o,l){if(1&o){const t=e.EpF();e.TgZ(0,"ion-button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(),s=e.MAs(13);return e.KtG(i.saveClose(s))}),e._UZ(1,"ion-icon",17),e._uU(2,"Speichern"),e.qZA()}if(2&o){const t=e.oxw(),n=e.MAs(13);e.Q6J("disabled",t.waiting||!n.valid)}}let y=(()=>{class o{constructor(t,n,i,s,a,c,U){this.navCtrl=t,this.route=n,this.alertCtrl=i,this.toastController=s,this.backendService=a,this.platform=c,this.zone=U,this.waiting=!1,this.isDNoteUsed=!0,this.durchgang=a.durchgang,this.step=a.step,this.geraetId=a.geraet;const V=parseInt(this.route.snapshot.paramMap.get("itemId"));this.updateUI(a.wertungen.find(F=>F.id===V)),this.isDNoteUsed=this.item.isDNoteUsed}ionViewWillLeave(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0)}ionViewWillEnter(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.subscription=this.backendService.wertungUpdated.subscribe(t=>{console.log("incoming wertung from service",t),t.wertung.athletId===this.wertung.athletId&&t.wertung.wettkampfdisziplinId===this.wertung.wettkampfdisziplinId&&t.wertung.endnote!==this.wertung.endnote&&(console.log("updateing wertung from service"),this.item.wertung=Object.assign({},t.wertung),this.itemOriginal.wertung=Object.assign({},t.wertung),this.wertung=Object.assign({noteD:0,noteE:0,endnote:0},this.item.wertung))}),this.platform.ready().then(()=>{setTimeout(()=>{_.show&&(_.show(),console.log("keyboard called")),this.isDNoteUsed&&this.dnote?(this.dnote.setFocus(),console.log("dnote focused")):this.enote&&(this.enote.setFocus(),console.log("enote focused"))},400)})}editable(){return this.backendService.loggedIn}updateUI(t){this.zone.run(()=>{this.waiting=!1,this.item=Object.assign({},t),this.itemOriginal=Object.assign({},t),this.wertung=Object.assign({noteD:0,noteE:0,endnote:0},this.itemOriginal.wertung),this.ionViewWillEnter()})}ensureInitialValues(t){return Object.assign(this.wertung,t)}saveClose(t){!t.valid||(this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(t.value)).subscribe({next:n=>{this.updateUI(n),this.navCtrl.pop()},error:n=>{this.updateUI(this.itemOriginal),console.log(n)}}))}save(t){!t.valid||(this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(t.value)).subscribe({next:n=>{this.updateUI(n)},error:n=>{this.updateUI(this.itemOriginal),console.log(n)}}))}saveNext(t){!t.valid||(this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(t.value)).subscribe({next:n=>{this.waiting=!1;const i=this.backendService.wertungen.findIndex(a=>a.wertung.id===n.wertung.id);i<0&&console.log("unexpected wertung - id matches not with current wertung: "+n.wertung.id);let s=i+1;if(i<0)s=0;else if(i>=this.backendService.wertungen.length-1){if(0===this.backendService.wertungen.filter(a=>void 0===a.wertung.endnote).length)return this.navCtrl.pop(),void this.toastSuggestCompletnessCheck();s=this.backendService.wertungen.findIndex(a=>void 0===a.wertung.endnote),this.toastMissingResult(t,this.backendService.wertungen[s].vorname+" "+this.backendService.wertungen[s].name)}t.resetForm(),this.updateUI(this.backendService.wertungen[s])},error:n=>{this.updateUI(this.itemOriginal),console.log(n)}}))}nextEmptyOrFinish(t){const n=this.backendService.wertungen.findIndex(i=>i.wertung.id===this.wertung.id);if(0===this.backendService.wertungen.filter((i,s)=>s>n&&void 0===i.wertung.endnote).length)return this.navCtrl.pop(),void this.toastSuggestCompletnessCheck();{const i=this.backendService.wertungen.findIndex((s,a)=>a>n&&void 0===s.wertung.endnote);this.toastMissingResult(t,this.backendService.wertungen[i].vorname+" "+this.backendService.wertungen[i].name),t.resetForm(),this.updateUI(this.backendService.wertungen[i])}}geraetName(){return this.backendService.geraete?this.backendService.geraete.find(t=>t.id===this.geraetId).name:""}toastSuggestCompletnessCheck(){var t=this;return(0,m.Z)(function*(){(yield t.toastController.create({header:"Qualit\xe4tskontrolle",message:"Es sind jetzt alle Resultate erfasst. Bitte ZU ZWEIT die Resultate pr\xfcfen und abschliessen!",animated:!0,position:"middle",buttons:[{text:"OK, gelesen.",icon:"checkmark-circle",role:"cancel",handler:()=>{console.log("OK, gelesen. clicked")}}]})).present()})()}toastMissingResult(t,n){var i=this;return(0,m.Z)(function*(){(yield i.alertCtrl.create({header:"Achtung",subHeader:"Fehlendes Resultat!",message:"Nach der Erfassung der letzten Wertung in dieser Riege scheint es noch leere Wertungen zu geben. Bitte pr\xfcfen, ob "+n.toUpperCase()+" geturnt hat.",buttons:[{text:"Nicht geturnt",role:"edit",handler:()=>{i.nextEmptyOrFinish(t)}},{text:"Korrigieren",role:"cancel",handler:()=>{console.log("Korrigieren clicked")}}]})).present()})()}}return o.\u0275fac=function(t){return new(t||o)(e.Y36(r.SH),e.Y36(h.gz),e.Y36(r.Br),e.Y36(r.yF),e.Y36(v.v),e.Y36(r.t4),e.Y36(e.R0b))},o.\u0275cmp=e.Xpm({type:o,selectors:[["app-wertung-editor"]],viewQuery:function(t,n){if(1&t&&(e.Gf(O,5),e.Gf(I,5),e.Gf(Z,5)),2&t){let i;e.iGM(i=e.CRH())&&(n.form=i.first),e.iGM(i=e.CRH())&&(n.enote=i.first),e.iGM(i=e.CRH())&&(n.dnote=i.first)}},decls:26,vars:15,consts:[["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[1,"riege"],[3,"ngSubmit","keyup.enter"],["wertungsform","ngForm"],[3,"hidden","waiting","valueTitle","singleValue","avgValue"],["type","number","readonly","","name","endnote",3,"ngModel"],["endnote",""],[4,"ngIf"],["size","large","expand","block","type","submit","color","success",3,"disabled",4,"ngIf"],["size","large","expand","block","color","secondary",3,"disabled","click",4,"ngIf"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["btnSaveNext",""],["slot","start","name","arrow-forward-circle-outline"],["size","large","expand","block","color","secondary",3,"disabled","click"],["slot","start","name","checkmark-circle"]],template:function(t,n){if(1&t){const i=e.EpF();e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.qZA(),e.TgZ(6,"ion-note",2)(7,"div",3),e._uU(8),e.qZA(),e.TgZ(9,"div",4),e._uU(10),e.qZA()()()(),e.TgZ(11,"ion-content")(12,"form",5,6),e.NdJ("ngSubmit",function(){e.CHM(i);const a=e.MAs(13);return e.KtG(n.saveNext(a))})("keyup.enter",function(){e.CHM(i);const a=e.MAs(13);return e.KtG(n.saveNext(a))}),e.TgZ(14,"ion-list")(15,"app-wertung-avg-calc",7),e.NdJ("avgValue",function(){return n.wertung.noteD}),e.qZA(),e.TgZ(16,"app-wertung-avg-calc",7),e.NdJ("avgValue",function(){return n.wertung.noteE}),e.qZA(),e.TgZ(17,"ion-item")(18,"ion-label"),e._uU(19,"Endnote"),e.qZA(),e._UZ(20,"ion-input",8,9),e.qZA()(),e.TgZ(22,"ion-list"),e.YNc(23,T,2,0,"ion-item",10),e.YNc(24,P,4,1,"ion-button",11),e.YNc(25,A,3,1,"ion-button",12),e.qZA()()()}if(2&t){const i=e.MAs(13);e.xp6(5),e.Oqu(n.geraetName()),e.xp6(3),e.Oqu(n.item.vorname+" "+n.item.name),e.xp6(2),e.Oqu(n.wertung.riege),e.xp6(5),e.Q6J("hidden",!n.isDNoteUsed)("waiting",n.waiting)("valueTitle","D-Note")("singleValue",n.wertung.noteD),e.xp6(1),e.Q6J("hidden",!1)("waiting",n.waiting)("valueTitle","E-Note")("singleValue",n.wertung.noteE),e.xp6(4),e.Q6J("ngModel",n.wertung.endnote),e.xp6(3),e.Q6J("ngIf",!i.valid),e.xp6(1),e.Q6J("ngIf",n.editable()),e.xp6(1),e.Q6J("ngIf",n.editable())}},dependencies:[d.O5,g._Y,g.JJ,g.JL,g.On,g.F,r.oU,r.YG,r.Sm,r.W2,r.Gu,r.gu,r.pK,r.Ie,r.Q$,r.q_,r.uN,r.wd,r.sr,r.as,r.cs,k],styles:[".riege[_ngcontent-%COMP%]{font-size:small;padding-right:16px;color:var(--ion-color-medium)}.athlet[_ngcontent-%COMP%]{font-size:larger;padding-right:16px;font-weight:bolder;color:var(--ion-color-primary)}"]}),o})();var W=u(5051);const N=[{path:"",component:y}];let E=(()=>{class o{}return o.\u0275fac=function(t){return new(t||o)},o.\u0275mod=e.oAB({type:o}),o.\u0275inj=e.cJS({imports:[d.ez,g.u5,r.Pc,h.Bz.forChild(N),W.K]}),o})()}}]);