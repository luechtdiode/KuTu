"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2833],{2833:(T,u,d)=>{d.r(u),d.d(u,{RegAthletEditorPageModule:()=>x});var g=d(177),h=d(4341),_=d(305),s=d(4742),c=d(8103),t=d(4438),p=d(2872),b=d(2350);function f(r,l){1&r&&(t.j41(0,"ion-label"),t.EFF(1," Athlet / Athletin "),t.k0s())}function k(r,l){if(1&r&&(t.j41(0,"ion-select-option",16)(1,"ion-avatar",5),t.nrm(2,"img",10),t.k0s(),t.j41(3,"ion-label"),t.EFF(4),t.nrm(5,"br"),t.j41(6,"small"),t.EFF(7),t.nI1(8,"date"),t.k0s()()()),2&r){const e=l.$implicit;t.Y8G("value",e.athletId),t.R7$(4),t.E5c("",e.name,", ",e.vorname," (",e.geschlecht,")"),t.R7$(3),t.SpI(" (",t.bMT(8,5,e.gebdat),")")}}function I(r,l){if(1&r){const e=t.RV6();t.j41(0,"ion-select",19),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG(2);return t.DH7(a.selectedClubAthletId,n)||(a.selectedClubAthletId=n),t.Njj(n)}),t.DNE(1,k,9,7,"ion-select-option",20),t.k0s()}if(2&r){const e=t.XpG(2);t.R50("ngModel",e.selectedClubAthletId),t.R7$(),t.Y8G("ngForOf",e.clubAthletList)}}function A(r,l){1&r&&(t.j41(0,"ion-item-divider")(1,"ion-avatar",3),t.nrm(2,"img",21),t.k0s(),t.j41(3,"ion-label"),t.EFF(4,"Einteilung"),t.k0s()())}function R(r,l){if(1&r&&(t.j41(0,"ion-select-option",16),t.EFF(1),t.k0s()),2&r){const e=l.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.name)}}function v(r,l){if(1&r){const e=t.RV6();t.j41(0,"ion-item")(1,"ion-avatar",3),t.EFF(2," \xa0 "),t.k0s(),t.j41(3,"ion-select",22),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG(2);return t.DH7(a.registration.programId,n)||(a.registration.programId=n),t.Njj(n)}),t.DNE(4,R,2,2,"ion-select-option",20),t.k0s()()}if(2&r){const e=t.XpG(2);t.R7$(3),t.R50("ngModel",e.registration.programId),t.R7$(),t.Y8G("ngForOf",e.filterPGMsForAthlet(e.registration))}}function F(r,l){1&r&&(t.j41(0,"ion-item-divider")(1,"ion-avatar",3),t.nrm(2,"img",23),t.k0s(),t.j41(3,"ion-label"),t.EFF(4,"Team-/Mannschaftszuweisung"),t.k0s()())}function C(r,l){if(1&r&&(t.j41(0,"ion-row"),t.EFF(1),t.k0s()),2&r){const e=l.$implicit;t.R7$(),t.SpI("f\xfcr ",e,"")}}function E(r,l){if(1&r&&(t.j41(0,"ion-select-option",16),t.EFF(1),t.k0s()),2&r){const e=l.$implicit,i=t.XpG(3);t.Y8G("value",e.index),t.R7$(),t.JRh(i.mapTeam(e.index))}}function j(r,l){if(1&r){const e=t.RV6();t.j41(0,"ion-item"),t.nrm(1,"ion-avatar",3),t.j41(2,"ion-grid",24),t.DNE(3,C,2,1,"ion-row",25),t.j41(4,"ion-row")(5,"ion-select",26),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG(2);return t.DH7(a.registration.team,n)||(a.registration.team=n),t.Njj(n)}),t.j41(6,"ion-select-option",16),t.EFF(7,"Keine Teamzuordnung"),t.k0s(),t.DNE(8,E,2,2,"ion-select-option",20),t.k0s()()()()}if(2&r){const e=t.XpG(2);t.R7$(3),t.Y8G("ngForOf",e.teamrules),t.R7$(2),t.R50("ngModel",e.registration.team),t.R7$(),t.Y8G("value",0),t.R7$(2),t.Y8G("ngForOf",e.teams)}}function w(r,l){if(1&r){const e=t.RV6();t.j41(0,"ion-content")(1,"form",9,0),t.bIt("ngSubmit",function(){t.eBV(e);const n=t.sdS(2),a=t.XpG();return t.Njj(a.save(n))})("keyup.enter",function(){t.eBV(e);const n=t.sdS(2),a=t.XpG();return t.Njj(a.save(n))}),t.j41(3,"ion-list")(4,"ion-item-divider")(5,"ion-avatar",3),t.nrm(6,"img",10),t.k0s(),t.DNE(7,f,2,0,"ion-label",7)(8,I,2,2,"ion-select",11),t.k0s(),t.j41(9,"ion-item")(10,"ion-avatar",3),t.EFF(11," \xa0 "),t.k0s(),t.j41(12,"ion-input",12),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.DH7(a.registration.name,n)||(a.registration.name=n),t.Njj(n)}),t.k0s()(),t.j41(13,"ion-item")(14,"ion-avatar",3),t.EFF(15," \xa0 "),t.k0s(),t.j41(16,"ion-input",13),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.DH7(a.registration.vorname,n)||(a.registration.vorname=n),t.Njj(n)}),t.k0s()(),t.j41(17,"ion-item")(18,"ion-avatar",3),t.EFF(19," \xa0 "),t.k0s(),t.j41(20,"ion-input",14),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.DH7(a.registration.gebdat,n)||(a.registration.gebdat=n),t.Njj(n)}),t.k0s()(),t.j41(21,"ion-item")(22,"ion-avatar",3),t.EFF(23," \xa0 "),t.k0s(),t.j41(24,"ion-select",15),t.mxI("ngModelChange",function(n){t.eBV(e);const a=t.XpG();return t.DH7(a.registration.geschlecht,n)||(a.registration.geschlecht=n),t.Njj(n)}),t.j41(25,"ion-select-option",16),t.EFF(26,"weiblich"),t.k0s(),t.j41(27,"ion-select-option",16),t.EFF(28,"m\xe4nnlich"),t.k0s()()(),t.DNE(29,A,5,0,"ion-item-divider",7)(30,v,5,2,"ion-item",7)(31,F,5,0,"ion-item-divider",7)(32,j,9,4,"ion-item",7),t.k0s(),t.j41(33,"ion-list")(34,"ion-button",17,1),t.nrm(36,"ion-icon",18),t.EFF(37,"Speichern"),t.k0s()()()()}if(2&r){const e=t.sdS(2),i=t.XpG();t.R7$(7),t.Y8G("ngIf",i.registration.id>0),t.R7$(),t.Y8G("ngIf",0===i.registration.id&&i.clubAthletList.length>0),t.R7$(4),t.Y8G("disabled",!1),t.R50("ngModel",i.registration.name),t.R7$(4),t.Y8G("disabled",!1),t.R50("ngModel",i.registration.vorname),t.R7$(4),t.Y8G("disabled",!1),t.R50("ngModel",i.registration.gebdat),t.R7$(4),t.R50("ngModel",i.registration.geschlecht),t.R7$(),t.Y8G("value","W"),t.R7$(2),t.Y8G("value","M"),t.R7$(2),t.Y8G("ngIf",i.needsPGMChoice()),t.R7$(),t.Y8G("ngIf",i.needsPGMChoice()),t.R7$(),t.Y8G("ngIf",i.teamsAllowed()),t.R7$(),t.Y8G("ngIf",i.teamsAllowed()),t.R7$(2),t.Y8G("disabled",i.waiting||!i.isFormValid()||!e.valid||e.untouched)}}function M(r,l){if(1&r){const e=t.RV6();t.j41(0,"ion-button",27,2),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.delete())}),t.nrm(2,"ion-icon",28),t.EFF(3,"Anmeldung l\xf6schen"),t.k0s()}if(2&r){const e=t.XpG();t.Y8G("disabled",e.waiting)}}const G=[{path:"",component:(()=>{class r{navCtrl;route;backendService;alertCtrl;zone;constructor(e,i,n,a,o){this.navCtrl=e,this.route=i,this.backendService=n,this.alertCtrl=a,this.zone=o}waiting=!1;registration;wettkampf;wettkampfFull;regId;athletId;wkId;wkPgms;teams;wettkampfId;clubAthletList;clubAthletListCurrent;_selectedClubAthletId;ngOnInit(){this.waiting=!0,this.wkId=this.route.snapshot.paramMap.get("wkId"),this.regId=parseInt(this.route.snapshot.paramMap.get("regId")),this.athletId=parseInt(this.route.snapshot.paramMap.get("athletId")),this.backendService.getCompetitions().subscribe(e=>{const i=e.find(n=>n.uuid===this.wkId);this.wettkampfId=parseInt(i.id),this.backendService.loadProgramsForCompetition(i.uuid).subscribe(n=>{this.wkPgms=n,this.backendService.loadTeamsListForClub(this.wkId,this.regId).subscribe(a=>{this.teams=a.filter(o=>o.name?.trim().length>0),this.backendService.loadAthletListForClub(this.wkId,this.regId).subscribe(o=>{this.clubAthletList=o,this.backendService.loadAthletRegistrations(this.wkId,this.regId).subscribe(m=>{this.clubAthletListCurrent=m,this.updateUI(this.athletId?m.find(P=>P.id===this.athletId):{id:0,vereinregistrationId:this.regId,name:"",vorname:"",geschlecht:"W",gebdat:void 0,programId:void 0,team:0,registrationTime:0})})})})})})}get selectedClubAthletId(){return this._selectedClubAthletId}set selectedClubAthletId(e){this._selectedClubAthletId=e,this.registration=this.clubAthletList.find(i=>i.athletId===e)}get teamrules(){return(this.wettkampfFull.teamrule||"").split(",")}needsPGMChoice(){const e=[...this.wkPgms][0];return!(1==e.aggregate&&e.riegenmode>1)}alter(e){if(0==this.wettkampfFull.altersklassen?.trim().length){const i=new Date((0,c.HN)(e.gebdat)).getFullYear();return new Date(this.wettkampfFull.datum).getFullYear()-i}{let i=Math.abs(new Date(this.wettkampfFull.datum).getTime()-new Date(e.gebdat).getTime());return Math.floor(i/864e5/365.25)}}similarRegistration(e,i){return e.athletId>0&&i.athletId>0&&e.athletId===i.athletId||e.name===i.name&&e.vorname===i.vorname&&e.gebdat===i.gebdat&&e.geschlecht===i.geschlecht}alternatives(e){return this.clubAthletListCurrent?.filter(i=>this.similarRegistration(i,e)&&i.id!=e.id)||[]}getAthletPgm(e){return this.wkPgms.find(i=>i.id===e.programId)||Object.assign({parent:0})}filterPGMsForAthlet(e){const i=this.alter(e),n=this.alternatives(e);return this.wkPgms.filter(a=>(a.alterVon||0)<=i&&(a.alterBis||100)>=i&&0===n.filter(o=>o.programId===a.id||this.getAthletPgm(o).parentId===a.parentId).length)}teamsAllowed(){return this.wettkampfFull.teamrule?.length>0&&"Keine Teams"!==this.wettkampfFull.teamrule}mapTeam(e){return[...this.teams.filter(i=>i.index==e).map(i=>i.index>0?i.name+" "+i.index:i.name),""][0]}editable(){return this.backendService.loggedIn}updateUI(e){this.zone.run(()=>{this.waiting=!1,this.wettkampf=this.backendService.competitionName,this.wettkampfFull=this.backendService.currentCompetition(),this.registration=Object.assign({},e),this.registration.gebdat=(0,c.HN)(this.registration.gebdat),this.registration.team||(this.registration.team=0)})}isFormValid(){return!this.registration?.programId&&!this.needsPGMChoice()&&(this.registration.programId=this.filterPGMsForAthlet(this.registration)[0]?.id),!!this.registration.gebdat&&!!this.registration.geschlecht&&this.registration.geschlecht.length>0&&!!this.registration.name&&this.registration.name.length>0&&!!this.registration.vorname&&this.registration.vorname.length>0&&!!this.registration.programId&&this.registration.programId>0&&(!this.teamsAllowed()||(!!this.registration.team||0===this.registration.team)&&!isNaN(this.registration.team))}checkPersonOverride(e){if(e.athletId){const i=[...this.clubAthletListCurrent,...this.clubAthletList].find(n=>n.athletId===e.athletId);if(i.geschlecht!==e.geschlecht||new Date((0,c.HN)(i.gebdat)).toJSON()!==new Date((0,c.HN)(e.gebdat)).toJSON()||i.name!==e.name||i.vorname!==e.vorname)return!0}return!1}save(e){if(!e.valid)return;const i=Object.assign({},this.registration,{gebdat:new Date(e.value.gebdat).toJSON(),team:e.value.team?e.value.team:0,athletId:this.registration.athletId>0?this.registration.athletId:0});0===this.athletId||0===i.id?(this.needsPGMChoice()||this.filterPGMsForAthlet(this.registration).filter(n=>n.id!==i.programId).forEach(n=>{this.backendService.createAthletRegistration(this.wkId,this.regId,Object.assign({},i,{programId:n.id}))}),this.backendService.createAthletRegistration(this.wkId,this.regId,i).subscribe(()=>{this.navCtrl.pop()})):this.checkPersonOverride(i)?this.alertCtrl.create({header:"Achtung",subHeader:"Person \xfcberschreiben vs korrigieren",message:"Es wurden \xc4nderungen an den Personen-Feldern vorgenommen. Diese sind ausschliesslich f\xfcr Korrekturen zul\xe4ssig. Die Identit\xe4t der Person darf dadurch nicht ge\xe4ndert werden!",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"Korektur durchf\xfchren",handler:()=>{this.backendService.saveAthletRegistration(this.wkId,this.regId,i).subscribe(()=>{this.clubAthletListCurrent.filter(o=>this.similarRegistration(this.registration,o)).filter(o=>o.id!==this.registration.id).forEach(o=>{const m=Object.assign({},i,{id:o.id,registrationTime:o.registrationTime,programId:o.programId});this.backendService.saveAthletRegistration(this.wkId,this.regId,m)}),this.navCtrl.pop()})}}]}).then(o=>o.present()):this.backendService.saveAthletRegistration(this.wkId,this.regId,i).subscribe(()=>{this.navCtrl.pop()})}delete(){this.alertCtrl.create({header:"Achtung",subHeader:"L\xf6schen der Athlet-Anmeldung am Wettkampf",message:"Hiermit wird die Anmeldung von "+this.registration.name+", "+this.registration.vorname+" am Wettkampf gel\xf6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.needsPGMChoice()||this.clubAthletListCurrent.filter(i=>this.similarRegistration(this.registration,i)).filter(i=>i.id!==this.registration.id).forEach(i=>{this.backendService.deleteAthletRegistration(this.wkId,this.regId,i)}),this.backendService.deleteAthletRegistration(this.wkId,this.regId,this.registration).subscribe(()=>{this.navCtrl.pop()})}}]}).then(i=>i.present())}static \u0275fac=function(i){return new(i||r)(t.rXU(p.q9),t.rXU(_.nX),t.rXU(b.m),t.rXU(s.hG),t.rXU(t.SKi))};static \u0275cmp=t.VBU({type:r,selectors:[["app-reg-athlet-editor"]],standalone:!1,decls:14,vars:3,consts:[["athletRegistrationForm","ngForm"],["btnSaveNext",""],["btnDelete",""],["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[4,"ngIf"],["size","large","expand","block","color","danger",3,"disabled","click",4,"ngIf"],[3,"ngSubmit","keyup.enter"],["src","assets/imgs/athlete.png"],["label","Athlet / Athletin","placeholder","Auswahl aus Liste","name","clubAthletid","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["label","Name","required","","placeholder","Name","type","text","name","name","required","",3,"ngModelChange","disabled","ngModel"],["label","Vorname","required","","placeholder","Vorname","type","text","name","vorname","required","",3,"ngModelChange","disabled","ngModel"],["label","Geburtsdatum","required","","placeholder","Geburtsdatum","type","date","display-timezone","utc","name","gebdat","required","",3,"ngModelChange","disabled","ngModel"],["label","Geschlecht","required","","placeholder","bitte ausw\xe4hlen","name","geschlecht","okText","Okay","cancelText","Abbrechen","required","",3,"ngModelChange","ngModel"],[3,"value"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["slot","start","name",""],["label","Athlet / Athletin","placeholder","Auswahl aus Liste","name","clubAthletid","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["src","assets/imgs/wettkampf.png"],["label","Programm/Kategorie","required","","placeholder","bitte ausw\xe4hlen","name","programId","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["src","assets/imgs/verein.png"],["no-padding",""],[4,"ngFor","ngForOf"],["label","Team","placeholder","Team","name","team","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["size","large","expand","block","color","danger",3,"click","disabled"],["slot","start","name","trash"]],template:function(i,n){1&i&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",3),t.nrm(3,"ion-back-button",4),t.k0s(),t.j41(4,"ion-title"),t.EFF(5,"Anmeldung Athlet/Athletin"),t.k0s(),t.j41(6,"ion-note",5)(7,"div",6),t.EFF(8),t.k0s()()()(),t.DNE(9,w,38,16,"ion-content",7),t.j41(10,"ion-footer")(11,"ion-toolbar")(12,"ion-list"),t.DNE(13,M,4,1,"ion-button",8),t.k0s()()()),2&i&&(t.R7$(8),t.SpI("f\xfcr ",n.wettkampf,""),t.R7$(),t.Y8G("ngIf",n.registration),t.R7$(4),t.Y8G("ngIf",n.athletId>0))},dependencies:[g.Sq,g.bT,h.qT,h.BC,h.cb,h.YS,h.vS,h.cV,s.mC,s.Jm,s.QW,s.W9,s.M0,s.lO,s.eU,s.iq,s.$w,s.uz,s.Dg,s.he,s.nf,s.JI,s.ln,s.Nm,s.Ip,s.BC,s.ai,s.Je,s.Gw,s.el,g.vh],styles:[".teamlabel[_ngcontent-%COMP%]{padding-top:10p}"]})}return r})()}];let x=(()=>{class r{static \u0275fac=function(i){return new(i||r)};static \u0275mod=t.$C({type:r});static \u0275inj=t.G2t({imports:[g.MD,h.YN,s.bv,_.iI.forChild(G)]})}return r})()}}]);