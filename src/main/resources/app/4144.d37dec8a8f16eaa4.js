"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4144],{4144:(Y,h,a)=>{a.r(h),a.d(h,{RegistrationPageModule:()=>E});var g=a(6814),d=a(95),_=a(335),r=a(3582),f=a(5861),b=a(8645),v=a(5619),C=a(2096),x=a(2181),A=a(7398),y=a(3620),k=a(3997),T=a(9397),Z=a(4664),R=a(3020),p=a(8180),e=a(2029),m=a(4414),S=a(9253);let I=(()=>{class s{clubregistration;status;selected=new e.vpe;constructor(){}ngOnInit(){}static \u0275fac=function(i){return new(i||s)};static \u0275cmp=e.Xpm({type:s,selectors:[["clublist-item"]],inputs:{clubregistration:"clubregistration",status:"status"},outputs:{selected:"selected"},decls:10,vars:5,consts:[[3,"click"],["slot","start"],["src","assets/imgs/verein.png"],["slot","end"]],template:function(i,n){1&i&&(e.TgZ(0,"ion-item",0),e.NdJ("click",function(){return n.selected?n.selected.emit(n.clubregistration):{}}),e.TgZ(1,"ion-avatar",1),e._UZ(2,"img",2),e.qZA(),e.TgZ(3,"ion-label"),e._uU(4),e._UZ(5,"br"),e.TgZ(6,"small"),e._uU(7),e.qZA()(),e.TgZ(8,"ion-note",3),e._uU(9),e.qZA()()),2&i&&(e.xp6(4),e.AsE("",n.clubregistration.vereinname,", ",n.clubregistration.verband,""),e.xp6(3),e.AsE("(",n.clubregistration.respVorname," ",n.clubregistration.respName,")"),e.xp6(2),e.hij(" Status ",n.status," "))},dependencies:[r.BJ,r.Ie,r.Q$,r.uN]})}return s})();function M(s,l){if(1&s&&(e.TgZ(0,"ion-select-option",10),e._uU(1),e.ALo(2,"date"),e.qZA()),2&s){const t=l.$implicit;e.Q6J("value",t.uuid),e.xp6(1),e.hij(" ",t.titel+" "+e.xi3(2,2,t.datum,"dd-MM-yy"),"")}}function w(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"ion-select",8),e.NdJ("ngModelChange",function(n){e.CHM(t);const o=e.oxw();return e.KtG(o.competition=n)}),e.YNc(1,M,3,5,"ion-select-option",9),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("ngModel",t.competition),e.xp6(1),e.Q6J("ngForOf",t.getCompetitions())}}function L(s,l){1&s&&(e.TgZ(0,"ion-item")(1,"ion-label"),e._uU(2,"loading ..."),e.qZA(),e._UZ(3,"ion-spinner"),e.qZA())}function P(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item-option",19),e.NdJ("click",function(){e.CHM(t),e.oxw();const n=e.MAs(1),o=e.oxw(2);return e.KtG(o.logout(n))}),e._UZ(1,"ion-icon",16),e._uU(2," Abmelden "),e.qZA()}}function F(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item-option",20),e.NdJ("click",function(){e.CHM(t);const n=e.oxw().$implicit,o=e.MAs(1),c=e.oxw(2);return e.KtG(c.delete(n,o))}),e._UZ(1,"ion-icon",16),e._uU(2," L\xf6schen "),e.qZA()}}function N(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item-sliding",null,12)(2,"clublist-item",13),e.NdJ("click",function(){const o=e.CHM(t).$implicit,c=e.MAs(1),u=e.oxw(2);return e.KtG(u.itemTapped(o,c))}),e.qZA(),e.TgZ(3,"ion-item-options",14)(4,"ion-item-option",15),e.NdJ("click",function(){const o=e.CHM(t).$implicit,c=e.MAs(1),u=e.oxw(2);return e.KtG(u.login(o,c))}),e._UZ(5,"ion-icon",16),e._uU(6),e.qZA(),e.YNc(7,P,3,0,"ion-item-option",17),e.YNc(8,F,3,0,"ion-item-option",18),e.qZA()()}if(2&s){const t=l.$implicit,i=e.oxw(2);e.xp6(2),e.Q6J("clubregistration",t)("status",i.getStatus(t)),e.xp6(4),e.hij(" ",i.isLoggedIn(t)?"Bearbeiten":"Login"," "),e.xp6(1),e.Q6J("ngIf",i.isLoggedIn(t)),e.xp6(1),e.Q6J("ngIf",i.isLoggedIn(t))}}function U(s,l){if(1&s&&(e.TgZ(0,"ion-content")(1,"ion-list"),e.YNc(2,L,4,0,"ion-item",5),e.ALo(3,"async"),e.YNc(4,N,9,5,"ion-item-sliding",11),e.qZA()()),2&s){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",e.lcZ(3,2,t.isBusy)),e.xp6(2),e.Q6J("ngForOf",t.filteredStartList)}}function J(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"ion-button",21),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.createRegistration())}),e._UZ(1,"ion-icon",22),e._uU(2," Neue Anmeldung... "),e.qZA()}}function Q(s,l){if(1&s){const t=e.EpF();e.TgZ(0,"ion-button",23,24),e.NdJ("click",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.logout(null))}),e.ALo(2,"async"),e._UZ(3,"ion-icon",25),e._uU(4,"Vereins-Login Abmelden"),e.qZA()}if(2&s){const t=e.oxw();e.Q6J("disabled",e.lcZ(2,1,t.isBusy))}}const B=[{path:"",component:(()=>{class s{navCtrl;route;backendService;toastController;alertCtrl;sClubRegistrationList;sFilteredRegistrationList;sMyQuery;sSyncActions=[];tMyQueryStream=new b.x;sFilterTask=void 0;busy=new v.X(!1);constructor(t,i,n,o,c){this.navCtrl=t,this.route=i,this.backendService=n,this.toastController=o,this.alertCtrl=c,this.backendService.competitions||this.backendService.getCompetitions()}ngOnInit(){this.busy.next(!0);const t=this.route.snapshot.paramMap.get("wkId");t?this.competition=t:this.backendService.competition&&(this.competition=this.backendService.competition)}ionViewWillEnter(){this.getSyncActions()}get stationFreezed(){return this.backendService.stationFreezed}set competition(t){(!this.clubregistrations||t!==this.backendService.competition)&&(this.busy.next(!0),this.clubregistrations=[],this.backendService.getClubRegistrations(t).subscribe(i=>{this.getSyncActions(),this.clubregistrations=i,this.busy.next(!1),this.tMyQueryStream.pipe((0,x.h)(o=>!!o&&!!o.target),(0,A.U)(o=>o.target.value||"*"),(0,y.b)(300),(0,k.x)(),(0,T.b)(o=>this.busy.next(!0)),(0,Z.w)(this.runQuery(i)),(0,R.B)()).subscribe(o=>{this.sFilteredRegistrationList=o,this.busy.next(!1)})}))}get competition(){return this.backendService.competition||""}set clubregistrations(t){this.sClubRegistrationList=t,this.reloadList(this.sMyQuery)}get clubregistrations(){return this.sClubRegistrationList}get filteredStartList(){return this.sFilteredRegistrationList||this.sClubRegistrationList}get isBusy(){return this.busy}getSyncActions(){this.backendService.loadRegistrationSyncActions().pipe((0,p.q)(1)).subscribe(t=>{this.sSyncActions=t})}getStatus(t){return this.sSyncActions?this.sSyncActions.find(i=>i.verein.id===t.id)?"Abgleich ausstehend":"Nachgef\xfchrt":"n/a"}runQuery(t){return i=>{const n=i.trim(),o=[];return n&&t&&t.forEach(c=>{this.filter(n)(c)&&o.push(c)}),(0,C.of)(o)}}reloadList(t){this.tMyQueryStream.next(t)}itemTapped(t,i){i.getOpenAmount().then(n=>{n>0?i.close():i.open("end")})}isLoggedIn(t){return this.backendService.loggedIn&&this.backendService.authenticatedClubId===t.id+""}isLoggedInAsClub(){return this.backendService.loggedIn&&!!this.backendService.authenticatedClubId}logout(t){t&&t.close(),this.alertCtrl.create({header:"Achtung",message:"F\xfcr sp\xe4tere Bearbeitungen an der Registrierung des Vereins am Wettkampf ist ein erneutes Login notwendig.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.clublogout()}}]}).then(n=>n.present())}delete(t,i){i.close(),this.alertCtrl.create({header:"Achtung",subHeader:"L\xf6schen der Vereins-Registrierung und dessen Anmeldungen am Wettkampf",message:"Hiermit wird die Vereinsanmeldung am Wettkampf komplett gel\xf6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.deleteClubRegistration(this.competition,t.id)}}]}).then(o=>o.present())}showPasswordResetSuccess(){var t=this;return(0,f.Z)(function*(){(yield t.toastController.create({header:"Passwort-Reset",message:"Es wurde eine EMail mit dem Reset-Link versendet!",animated:!0,position:"middle",buttons:[{text:"OK",role:"cancel"}]})).present()})()}login(t,i){i.close(),this.isLoggedIn(t)?this.navCtrl.navigateForward(`registration/${this.competition}/${t.id}`):this.alertCtrl.create({header:"Vereins-Login",message:`Login f\xfcr die Bearbeitung der Vereinsanmeldung am Wettkampf ${this.competitionName()}`,inputs:[{name:"username",label:"Vereinsname",placeholder:"Vereinsname",value:`${t.vereinname} (${t.verband})`,type:"text"},{name:"pw",label:"Passwort",placeholder:"Passwort",type:"password"}],buttons:[{text:"Abbrechen",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Login",handler:o=>!!(o.pw&&o.pw.trim().length>0)&&(this.backendService.clublogin(t.id,o.pw).pipe((0,p.q)(1)).subscribe({next:c=>{this.navCtrl.navigateForward(`registration/${this.competition}/${t.id}`)},error:c=>{401===c.status&&this.alertCtrl.create({header:"Vereins-Login Fehlgeschlagen",message:`Soll f\xfcr diese Vereinsanmeldung am Wettkampf ${this.competitionName()} ein Passwort-Reset Vorgang gestartet werden?`,inputs:[],buttons:[{text:"Abbrechen",role:"cancel",handler:()=>(console.log("Cancel clicked"),!1)},{text:"Passwort-Reset",handler:()=>(this.backendService.resetRegistration(t.id).pipe((0,p.q)(1)).subscribe(()=>{this.showPasswordResetSuccess()}),!0)}]}).then(O=>{O.present()})}}),!0)}]}).then(o=>{o.onkeypress=c=>{"Enter"===c.code&&o.getElementsByClassName("ion-activatable")[1].click()},o.present()})}createRegistration(){this.navCtrl.navigateForward(`registration/${this.competition}/0`)}getCompetitions(){return this.backendService.competitions||[]}competitionName(){return this.backendService.competitionName}filter(t){const i=t.toUpperCase().split(" ");return n=>"*"===t.trim()||i.filter(o=>{if(n.vereinname.toUpperCase().indexOf(o)>-1||n.verband.toUpperCase().indexOf(o)>-1||n.mail.toUpperCase().indexOf(o)>-1||n.respName.toUpperCase().indexOf(o)>-1||n.respVorname.toUpperCase().indexOf(o)>-1)return!0}).length===i.length}static \u0275fac=function(i){return new(i||s)(e.Y36(m.SH),e.Y36(_.gz),e.Y36(S.v),e.Y36(m.yF),e.Y36(m.Br))};static \u0275cmp=e.Xpm({type:s,selectors:[["app-registration"]],decls:18,vars:5,consts:[["slot","start"],["slot","icon-only","name","menu"],["slot","end"],["placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["placeholder","Search","showCancelButton","never",3,"ngModel","ngModelChange","ionInput","ionCancel"],[4,"ngIf"],["size","large","expand","block","color","success",3,"click",4,"ngIf"],["size","large","expand","block","color","danger",3,"disabled","click",4,"ngIf"],["placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngFor","ngForOf"],["slidingClubRegistrationItem",""],[3,"clubregistration","status","click"],["side","end"],["color","primary",3,"click"],["name","arrow-forward-circle-outline","ios","md-arrow-forward-circle-outline"],["color","secondary",3,"click",4,"ngIf"],["color","danger",3,"click",4,"ngIf"],["color","secondary",3,"click"],["color","danger",3,"click"],["size","large","expand","block","color","success",3,"click"],["slot","start","name","add"],["size","large","expand","block","color","danger",3,"disabled","click"],["btnDelete",""],["slot","start","name","log-out"]],template:function(i,n){1&i&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-menu-toggle")(4,"ion-button"),e._UZ(5,"ion-icon",1),e.qZA()()(),e.TgZ(6,"ion-title")(7,"ion-label"),e._uU(8,"Wettkampf-Anmeldungen"),e.qZA()(),e.TgZ(9,"ion-buttons",2),e.YNc(10,w,2,2,"ion-select",3),e.qZA()(),e.TgZ(11,"ion-searchbar",4),e.NdJ("ngModelChange",function(c){return n.sMyQuery=c})("ionInput",function(c){return n.reloadList(c)})("ionCancel",function(c){return n.reloadList(c)}),e.qZA()(),e.YNc(12,U,5,4,"ion-content",5),e.TgZ(13,"ion-footer")(14,"ion-toolbar")(15,"ion-list"),e.YNc(16,J,3,0,"ion-button",6),e.YNc(17,Q,5,3,"ion-button",7),e.qZA()()()),2&i&&(e.xp6(10),e.Q6J("ngIf",n.getCompetitions().length>0),e.xp6(1),e.Q6J("ngModel",n.sMyQuery),e.xp6(1),e.Q6J("ngIf",n.competition&&n.clubregistrations),e.xp6(4),e.Q6J("ngIf",!n.isLoggedInAsClub()),e.xp6(1),e.Q6J("ngIf",n.isLoggedInAsClub()))},dependencies:[g.sg,g.O5,d.JJ,d.On,r.YG,r.Sm,r.W2,r.fr,r.Gu,r.gu,r.Ie,r.u8,r.IK,r.td,r.Q$,r.q_,r.zc,r.VI,r.t9,r.n0,r.PQ,r.wd,r.sr,r.QI,r.j9,I,g.Ov,g.uU]})}return s})()}];let E=(()=>{class s{static \u0275fac=function(i){return new(i||s)};static \u0275mod=e.oAB({type:s});static \u0275inj=e.cJS({imports:[g.ez,d.u5,r.Pc,_.Bz.forChild(B)]})}return s})()}}]);