(self.webpackChunkresultcatcher=self.webpackChunkresultcatcher||[]).push([[2880],{2880:(e,t,n)=>{"use strict";n.r(t),n.d(t,{WertungEditorPageModule:()=>f});var i=n(8583),s=n(665),r=n(881),o=n(2267),a=n(4762),d=n(8186),u=n(9075),c=n(4329),l=n(600);const g=["wertungsform"],h=["enote"],p=["dnote"];function b(e,t){if(1&e&&(d.TgZ(0,"ion-button",16,17),d._UZ(2,"ion-icon",18),d._uU(3,"Speichern & Weiter"),d.qZA()),2&e){const e=d.oxw(),t=d.MAs(13);d.Q6J("disabled",e.waiting||!t.valid)}}function m(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"ion-button",19),d.NdJ("click",function(){d.CHM(e);const t=d.oxw(),n=d.MAs(13);return t.saveClose(n)}),d._UZ(1,"ion-icon",20),d._uU(2,"Speichern"),d.qZA()}if(2&e){const e=d.oxw(),t=d.MAs(13);d.Q6J("disabled",e.waiting||!t.valid)}}const w=[{path:"",component:(()=>{class e{constructor(e,t,n,i,s,r,o,a,d){this.navCtrl=e,this.route=t,this.sanitizer=n,this.alertCtrl=i,this.toastController=s,this.keyboard=r,this.backendService=o,this.platform=a,this.zone=d,this.waiting=!1,this.isDNoteUsed=!0,this.durchgang=o.durchgang,this.step=o.step,this.geraetId=o.geraet;const u=parseInt(this.route.snapshot.paramMap.get("itemId"));this.updateUI(o.wertungen.find(e=>e.id===u)),this.isDNoteUsed=this.item.isDNoteUsed}ionViewWillLeave(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0)}ionViewWillEnter(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.subscription=this.backendService.wertungUpdated.subscribe(e=>{console.log("incoming wertung from service",e),e.wertung.athletId===this.wertung.athletId&&e.wertung.wettkampfdisziplinId===this.wertung.wettkampfdisziplinId&&e.wertung.endnote!==this.wertung.endnote&&(console.log("updateing wertung from service"),this.item.wertung=Object.assign({},e.wertung),this.itemOriginal.wertung=Object.assign({},e.wertung),this.wertung=Object.assign({noteD:0,noteE:0,endnote:0},this.item.wertung))}),this.platform.ready().then(()=>{setTimeout(()=>{this.keyboard.show&&(this.keyboard.show(),console.log("keyboard called")),this.isDNoteUsed&&this.dnote?(this.dnote.setFocus(),console.log("dnote focused")):this.enote&&(this.enote.setFocus(),console.log("enote focused"))},400)})}editable(){return this.backendService.loggedIn}updateUI(e){this.zone.run(()=>{this.waiting=!1,this.item=Object.assign({},e),this.itemOriginal=Object.assign({},e),this.wertung=Object.assign({noteD:0,noteE:0,endnote:0},this.itemOriginal.wertung),this.ionViewWillEnter()})}ensureInitialValues(e){return Object.assign(this.wertung,e)}saveClose(e){this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe(e=>{this.updateUI(e),this.navCtrl.pop()},e=>{this.updateUI(this.itemOriginal),console.log(e)})}save(e){this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe(e=>{this.updateUI(e)},e=>{this.updateUI(this.itemOriginal),console.log(e)})}saveNext(e){this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe(t=>{this.waiting=!1;const n=this.backendService.wertungen.findIndex(e=>e.wertung.id===t.wertung.id);n<0&&console.log("unexpected wertung - id matches not with current wertung: "+t.wertung.id);let i=n+1;if(n<0)i=0;else if(n>=this.backendService.wertungen.length-1){if(0===this.backendService.wertungen.filter(e=>void 0===e.wertung.endnote).length)return this.navCtrl.pop(),void this.toastSuggestCompletnessCheck();i=this.backendService.wertungen.findIndex(e=>void 0===e.wertung.endnote),this.toastMissingResult(e,this.backendService.wertungen[i].vorname+" "+this.backendService.wertungen[i].name)}e.resetForm(),this.updateUI(this.backendService.wertungen[i])},e=>{this.updateUI(this.itemOriginal),console.log(e)})}nextEmptyOrFinish(e){const t=this.backendService.wertungen.findIndex(e=>e.wertung.id===this.wertung.id);if(0===this.backendService.wertungen.filter((e,n)=>n>t&&void 0===e.wertung.endnote).length)return this.navCtrl.pop(),void this.toastSuggestCompletnessCheck();{const n=this.backendService.wertungen.findIndex((e,n)=>n>t&&void 0===e.wertung.endnote);this.toastMissingResult(e,this.backendService.wertungen[n].vorname+" "+this.backendService.wertungen[n].name),e.resetForm(),this.updateUI(this.backendService.wertungen[n])}}geraetName(){return this.backendService.geraete?this.backendService.geraete.find(e=>e.id===this.geraetId).name:""}toastSuggestCompletnessCheck(){return(0,a.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({header:"Qualit\xe4tskontrolle",message:"Es sind jetzt alle Resultate erfasst. Bitte ZU ZWEIT die Resultate pr\xfcfen und abschliessen!",animated:!0,position:"middle",buttons:[{text:"OK, gelesen.",icon:"checkmark-circle",role:"cancel",handler:()=>{console.log("OK, gelesen. clicked")}}]})).present()})}toastMissingResult(e,t){return(0,a.mG)(this,void 0,void 0,function*(){(yield this.alertCtrl.create({header:"Achtung",subHeader:"Fehlendes Resultat!",message:"Nach der Erfassung der letzten Wertung in dieser Riege scheint es noch leere Wertungen zu geben. Bitte pr\xfcfen, ob "+t.toUpperCase()+" geturnt hat.",buttons:[{text:"Nicht geturnt",role:"edit",handler:()=>{this.nextEmptyOrFinish(e)}},{text:"Korrigieren",role:"cancel",handler:()=>{console.log("Korrigieren clicked")}}]})).present()})}}return e.\u0275fac=function(t){return new(t||e)(d.Y36(o.SH),d.Y36(r.gz),d.Y36(u.H7),d.Y36(o.Br),d.Y36(o.yF),d.Y36(c.N1),d.Y36(l.v),d.Y36(o.t4),d.Y36(d.R0b))},e.\u0275cmp=d.Xpm({type:e,selectors:[["app-wertung-editor"]],viewQuery:function(e,t){if(1&e&&(d.Gf(g,5),d.Gf(h,5),d.Gf(p,5)),2&e){let e;d.iGM(e=d.CRH())&&(t.form=e.first),d.iGM(e=d.CRH())&&(t.enote=e.first),d.iGM(e=d.CRH())&&(t.dnote=e.first)}},decls:33,vars:13,consts:[["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[1,"riege"],[3,"ngSubmit","keyup.enter"],["wertungsform","ngForm"],[3,"hidden"],["autofocus","","type","number","name","noteD",3,"readonly","disabled","ngModel"],["dnote",""],["autofocus","","type","number","name","noteE","step","0.01","min","0","max","100","required","",3,"readonly","disabled","ngModel"],["enote",""],["readonly","","name","endnote",3,"ngModel"],["endnote",""],["size","large","expand","block","type","submit","color","success",3,"disabled",4,"ngIf"],["size","large","expand","block","color","secondary",3,"disabled","click",4,"ngIf"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["btnSaveNext",""],["slot","start","name","arrow-dropright-circle"],["size","large","expand","block","color","secondary",3,"disabled","click"],["slot","start","name","checkmark-circle"]],template:function(e,t){if(1&e){const e=d.EpF();d.TgZ(0,"ion-header"),d.TgZ(1,"ion-toolbar"),d.TgZ(2,"ion-buttons",0),d._UZ(3,"ion-back-button",1),d.qZA(),d.TgZ(4,"ion-title"),d._uU(5),d.qZA(),d.TgZ(6,"ion-note",2),d.TgZ(7,"div",3),d._uU(8),d.qZA(),d.TgZ(9,"div",4),d._uU(10),d.qZA(),d.qZA(),d.qZA(),d.qZA(),d.TgZ(11,"ion-content"),d.TgZ(12,"form",5,6),d.NdJ("ngSubmit",function(){d.CHM(e);const n=d.MAs(13);return t.saveNext(n)})("keyup.enter",function(){d.CHM(e);const n=d.MAs(13);return t.saveNext(n)}),d.TgZ(14,"ion-list"),d.TgZ(15,"ion-item",7),d.TgZ(16,"ion-label"),d._uU(17,"D-Note"),d.qZA(),d._UZ(18,"ion-input",8,9),d.qZA(),d.TgZ(20,"ion-item"),d.TgZ(21,"ion-label"),d._uU(22,"E-Note"),d.qZA(),d._UZ(23,"ion-input",10,11),d.qZA(),d.TgZ(25,"ion-item"),d.TgZ(26,"ion-label"),d._uU(27,"Endnote"),d.qZA(),d._UZ(28,"ion-input",12,13),d.qZA(),d.qZA(),d.TgZ(30,"ion-list"),d.YNc(31,b,4,1,"ion-button",14),d.YNc(32,m,3,1,"ion-button",15),d.qZA(),d.qZA(),d.qZA()}2&e&&(d.xp6(5),d.Oqu(t.geraetName()),d.xp6(3),d.Oqu(t.item.vorname+" "+t.item.name),d.xp6(2),d.Oqu(t.wertung.riege),d.xp6(5),d.Q6J("hidden",!t.isDNoteUsed),d.xp6(3),d.Q6J("readonly",!t.editable())("disabled",t.waiting)("ngModel",t.wertung.noteD),d.xp6(5),d.Q6J("readonly",!t.editable())("disabled",t.waiting)("ngModel",t.wertung.noteE),d.xp6(5),d.Q6J("ngModel",t.wertung.endnote),d.xp6(3),d.Q6J("ngIf",t.editable()),d.xp6(1),d.Q6J("ngIf",t.editable()))},directives:[o.Gu,o.sr,o.Sm,o.oU,o.cs,o.wd,o.uN,o.W2,s._Y,s.JL,s.F,o.q_,o.Ie,o.Q$,o.pK,o.as,s.JJ,s.On,s.Q7,o.j9,i.O5,o.YG,o.gu],styles:[".riege[_ngcontent-%COMP%]{font-size:small;color:var(--ion-color-medium)}.athlet[_ngcontent-%COMP%], .riege[_ngcontent-%COMP%]{padding-right:16px}.athlet[_ngcontent-%COMP%]{font-size:larger;font-weight:bolder;color:var(--ion-color-primary)}"]}),e})()}];let f=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=d.oAB({type:e}),e.\u0275inj=d.cJS({providers:[c.N1],imports:[[i.ez,s.u5,o.Pc,r.Bz.forChild(w)]]}),e})()}}]);