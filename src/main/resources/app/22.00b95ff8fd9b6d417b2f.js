(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{UK8Y:function(e,t,n){"use strict";n.r(t),n.d(t,"WertungEditorPageModule",function(){return w});var i=n("ofXK"),r=n("3Pt+"),o=n("tyNb"),s=n("TEn/"),c=n("mrSG"),a=n("cygB"),u=n("PLH8"),d=n("fXoL"),l=n("jhN1"),b=["wertungsform"],g=["enote"],h=["dnote"];function p(e,t){if(1&e&&(d.Lb(0,"ion-button",16,17),d.Jb(2,"ion-icon",18),d.lc(3,"Speichern & Weiter"),d.Kb()),2&e){var n=d.Vb(),i=d.ec(13);d.bc("disabled",n.waiting||!i.valid)}}function f(e,t){if(1&e){var n=d.Mb();d.Lb(0,"ion-button",19),d.Tb("click",function(){d.fc(n);var e=d.Vb(),t=d.ec(13);return e.saveClose(t)}),d.Jb(1,"ion-icon",20),d.lc(2,"Speichern"),d.Kb()}if(2&e){var i=d.Vb(),r=d.ec(13);d.bc("disabled",i.waiting||!r.valid)}}var v=[{path:"",component:function(){function e(e,t,n,i,r,o,s,c,a){this.navCtrl=e,this.route=t,this.sanitizer=n,this.alertCtrl=i,this.toastController=r,this.keyboard=o,this.backendService=s,this.platform=c,this.zone=a,this.waiting=!1,this.isDNoteUsed=!0,this.durchgang=s.durchgang,this.step=s.step,this.geraetId=s.geraet;var u=parseInt(this.route.snapshot.paramMap.get("itemId"));this.updateUI(s.wertungen.find(function(e){return e.id===u})),this.isDNoteUsed=this.item.isDNoteUsed}return e.prototype.ionViewWillLeave=function(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0)},e.prototype.ionViewWillEnter=function(){var e=this;this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.subscription=this.backendService.wertungUpdated.subscribe(function(t){console.log("incoming wertung from service",t),t.wertung.athletId===e.wertung.athletId&&t.wertung.wettkampfdisziplinId===e.wertung.wettkampfdisziplinId&&t.wertung.endnote!==e.wertung.endnote&&(console.log("updateing wertung from service"),e.item.wertung=Object.assign({},t.wertung),e.itemOriginal.wertung=Object.assign({},t.wertung),e.wertung=Object.assign({noteD:0,noteE:0,endnote:0},e.item.wertung))}),this.platform.ready().then(function(){setTimeout(function(){e.keyboard.show&&(e.keyboard.show(),console.log("keyboard called")),e.isDNoteUsed&&e.dnote?(e.dnote.setFocus(),console.log("dnote focused")):e.enote&&(e.enote.setFocus(),console.log("enote focused"))},400)})},e.prototype.editable=function(){return this.backendService.loggedIn},e.prototype.updateUI=function(e){var t=this;this.zone.run(function(){t.waiting=!1,t.item=Object.assign({},e),t.itemOriginal=Object.assign({},e),t.wertung=Object.assign({noteD:0,noteE:0,endnote:0},t.itemOriginal.wertung),t.ionViewWillEnter()})},e.prototype.ensureInitialValues=function(e){return Object.assign(this.wertung,e)},e.prototype.saveClose=function(e){var t=this;this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe(function(e){t.updateUI(e),t.navCtrl.pop()},function(e){t.updateUI(t.itemOriginal),console.log(e)})},e.prototype.save=function(e){var t=this;this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe(function(e){t.updateUI(e)},function(e){t.updateUI(t.itemOriginal),console.log(e)})},e.prototype.saveNext=function(e){var t=this;this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe(function(n){t.waiting=!1;var i=t.backendService.wertungen.findIndex(function(e){return e.wertung.id===n.wertung.id});i<0&&console.log("unexpected wertung - id matches not with current wertung: "+n.wertung.id);var r=i+1;if(i<0)r=0;else if(i>=t.backendService.wertungen.length-1){if(0===t.backendService.wertungen.filter(function(e){return void 0===e.wertung.endnote}).length)return t.navCtrl.pop(),void t.toastSuggestCompletnessCheck();r=t.backendService.wertungen.findIndex(function(e){return void 0===e.wertung.endnote}),t.toastMissingResult(e,t.backendService.wertungen[r].vorname+" "+t.backendService.wertungen[r].name)}e.resetForm(),t.updateUI(t.backendService.wertungen[r])},function(e){t.updateUI(t.itemOriginal),console.log(e)})},e.prototype.nextEmptyOrFinish=function(e){var t=this,n=this.backendService.wertungen.findIndex(function(e){return e.wertung.id===t.wertung.id});if(0===this.backendService.wertungen.filter(function(e,t){return t>n&&void 0===e.wertung.endnote}).length)return this.navCtrl.pop(),void this.toastSuggestCompletnessCheck();var i=this.backendService.wertungen.findIndex(function(e,t){return t>n&&void 0===e.wertung.endnote});this.toastMissingResult(e,this.backendService.wertungen[i].vorname+" "+this.backendService.wertungen[i].name),e.resetForm(),this.updateUI(this.backendService.wertungen[i])},e.prototype.geraetName=function(){var e=this;return this.backendService.geraete?this.backendService.geraete.find(function(t){return t.id===e.geraetId}).name:""},e.prototype.toastSuggestCompletnessCheck=function(){return Object(c.b)(this,void 0,void 0,function(){return Object(c.d)(this,function(e){switch(e.label){case 0:return[4,this.toastController.create({header:"Qualit\xe4tskontrolle",message:"Es sind jetzt alle Resultate erfasst. Bitte ZU ZWEIT die Resultate pr\xfcfen und abschliessen!",animated:!0,position:"middle",buttons:[{text:"OK, gelesen.",icon:"checkmark-circle",role:"cancel",handler:function(){console.log("OK, gelesen. clicked")}}]})];case 1:return e.sent().present(),[2]}})})},e.prototype.toastMissingResult=function(e,t){return Object(c.b)(this,void 0,void 0,function(){var n=this;return Object(c.d)(this,function(i){switch(i.label){case 0:return[4,this.alertCtrl.create({header:"Achtung",subHeader:"Fehlendes Resultat!",message:"Nach der Erfassung der letzten Wertung in dieser Riege scheint es noch leere Wertungen zu geben. Bitte pr\xfcfen, ob "+t.toUpperCase()+" geturnt hat.",buttons:[{text:"Nicht geturnt",role:"edit",handler:function(){n.nextEmptyOrFinish(e)}},{text:"Korrigieren",role:"cancel",handler:function(){console.log("Korrigieren clicked")}}]})];case 1:return i.sent().present(),[2]}})})},e.\u0275fac=function(t){return new(t||e)(d.Ib(s.N),d.Ib(o.a),d.Ib(l.b),d.Ib(s.b),d.Ib(s.S),d.Ib(u.a),d.Ib(a.a),d.Ib(s.P),d.Ib(d.A))},e.\u0275cmp=d.Cb({type:e,selectors:[["app-wertung-editor"]],viewQuery:function(e,t){var n;1&e&&(d.qc(b,!0),d.qc(g,!0),d.qc(h,!0)),2&e&&(d.dc(n=d.Ub())&&(t.form=n.first),d.dc(n=d.Ub())&&(t.enote=n.first),d.dc(n=d.Ub())&&(t.dnote=n.first))},decls:33,vars:13,consts:[["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[1,"riege"],[3,"ngSubmit","keyup.enter"],["wertungsform","ngForm"],[3,"hidden"],["autofocus","","type","number","name","noteD",3,"readonly","disabled","ngModel"],["dnote",""],["autofocus","","type","number","name","noteE","step","0.01","min","0","max","100","required","",3,"readonly","disabled","ngModel"],["enote",""],["readonly","","name","endnote",3,"ngModel"],["endnote",""],["size","large","expand","block","type","submit","color","success",3,"disabled",4,"ngIf"],["size","large","expand","block","color","secondary",3,"disabled","click",4,"ngIf"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["btnSaveNext",""],["slot","start","name","arrow-dropright-circle"],["size","large","expand","block","color","secondary",3,"disabled","click"],["slot","start","name","checkmark-circle"]],template:function(e,t){if(1&e){var n=d.Mb();d.Lb(0,"ion-header"),d.Lb(1,"ion-toolbar"),d.Lb(2,"ion-buttons",0),d.Jb(3,"ion-back-button",1),d.Kb(),d.Lb(4,"ion-title"),d.lc(5),d.Kb(),d.Lb(6,"ion-note",2),d.Lb(7,"div",3),d.lc(8),d.Kb(),d.Lb(9,"div",4),d.lc(10),d.Kb(),d.Kb(),d.Kb(),d.Kb(),d.Lb(11,"ion-content"),d.Lb(12,"form",5,6),d.Tb("ngSubmit",function(){d.fc(n);var e=d.ec(13);return t.saveNext(e)})("keyup.enter",function(){d.fc(n);var e=d.ec(13);return t.saveNext(e)}),d.Lb(14,"ion-list"),d.Lb(15,"ion-item",7),d.Lb(16,"ion-label"),d.lc(17,"D-Note"),d.Kb(),d.Jb(18,"ion-input",8,9),d.Kb(),d.Lb(20,"ion-item"),d.Lb(21,"ion-label"),d.lc(22,"E-Note"),d.Kb(),d.Jb(23,"ion-input",10,11),d.Kb(),d.Lb(25,"ion-item"),d.Lb(26,"ion-label"),d.lc(27,"Endnote"),d.Kb(),d.Jb(28,"ion-input",12,13),d.Kb(),d.Kb(),d.Lb(30,"ion-list"),d.kc(31,p,4,1,"ion-button",14),d.kc(32,f,3,1,"ion-button",15),d.Kb(),d.Kb(),d.Kb()}2&e&&(d.yb(5),d.mc(t.geraetName()),d.yb(3),d.mc(t.item.vorname+" "+t.item.name),d.yb(2),d.mc(t.wertung.riege),d.yb(5),d.bc("hidden",!t.isDNoteUsed),d.yb(3),d.bc("readonly",!t.editable())("disabled",t.waiting)("ngModel",t.wertung.noteD),d.yb(5),d.bc("readonly",!t.editable())("disabled",t.waiting)("ngModel",t.wertung.noteE),d.yb(5),d.bc("ngModel",t.wertung.endnote),d.yb(3),d.bc("ngIf",t.editable()),d.yb(1),d.bc("ngIf",t.editable()))},directives:[s.n,s.J,s.h,s.e,s.f,s.I,s.z,s.k,r.j,r.e,r.f,s.w,s.q,s.v,s.p,s.O,r.d,r.g,r.i,s.R,i.m,s.g,s.o],styles:[".riege[_ngcontent-%COMP%]{font-size:small;color:var(--ion-color-medium)}.athlet[_ngcontent-%COMP%], .riege[_ngcontent-%COMP%]{padding-right:16px}.athlet[_ngcontent-%COMP%]{font-size:larger;font-weight:bolder;color:var(--ion-color-primary)}"]}),e}()}],w=function(){function e(){}return e.\u0275mod=d.Gb({type:e}),e.\u0275inj=d.Fb({factory:function(t){return new(t||e)},providers:[u.a],imports:[[i.c,r.a,s.K,o.i.forChild(v)]]}),e}()}}]);