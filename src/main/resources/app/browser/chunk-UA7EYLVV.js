import{a as Oe,b as Fe,e as Ee,h as ze}from"./chunk-T4CFNL5Z.js";import{$a as ve,B as m,Ba as ne,Bb as Re,C as a,D as b,E as x,Ea as re,Fa as oe,G as C,H as p,Ja as se,Ka as ae,Ma as le,N as T,Na as ce,O as S,Oa as me,P as L,Pa as pe,Q as w,Qa as ue,Ra as de,T as M,Ta as ge,U as P,Ua as he,V as A,Va as _e,Wa as fe,X as R,Xa as be,Y as Q,Ya as xe,Za as Se,_ as q,a as E,aa as K,ab as Ce,b as z,ba as J,c as V,ca as H,d as y,db as ye,e as B,ea as Z,eb as Ie,f as N,fb as we,ga as X,gb as ke,h as $,i as D,j as G,kb as Te,lb as Le,m as W,o as h,p as _,qa as Y,sa as ee,sb as Me,t as o,u as I,ub as Pe,v as j,va as te,vb as Ae,w as U,x as u,y as k,z as l,za as ie}from"./chunk-SCHL4OOB.js";import"./chunk-RTI2IBQE.js";import"./chunk-YPCCWTCR.js";import"./chunk-IXGCB5RR.js";import"./chunk-LOHYXAXQ.js";import"./chunk-N7UIYTQY.js";import"./chunk-HC6MZPB3.js";import"./chunk-J5OMF6R4.js";import"./chunk-KWW2H4SN.js";import"./chunk-7HA5TF5T.js";import"./chunk-ADN7P72M.js";import"./chunk-426OJ4HC.js";import"./chunk-RPQZFOYD.js";import"./chunk-GIGBYVJT.js";import"./chunk-MM5QLNJM.js";import"./chunk-H3GX5QFY.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-YPW7SQSE.js";import"./chunk-MCRJI3T3.js";import"./chunk-PL2JVG7G.js";import"./chunk-ACERUE7O.js";import{g as F}from"./chunk-2R6CW7ES.js";var Ve=n=>({"gradient-border":n});function We(n,c){if(n&1&&(m(0,"ion-select-option",11),S(1),Q(2,"date"),a()),n&2){let e=c.$implicit;l("value",e.uuid),o(),w(" ",e.titel+" "+q(2,2,e.datum,"dd-MM-yy"),"")}}function je(n,c){if(n&1){let e=x();m(0,"ion-select",9),A("ngModelChange",function(i){h(e);let r=p(2);return P(r.competition,i)||(r.competition=i),_(i)}),u(1,We,3,5,"ion-select-option",10),a()}if(n&2){let e=p(2);M("ngModel",e.competition),o(),l("ngForOf",e.getCompetitions())}}function Ue(n,c){if(n&1&&(m(0,"ion-col")(1,"ion-item"),u(2,je,2,2,"ion-select",8),a()()),n&2){let e=p();o(2),l("ngIf",e.getCompetitions().length>0)}}function Qe(n,c){if(n&1&&(m(0,"ion-note",12),S(1),a()),n&2){let e=p();o(),w(" ",e.competitionName()," ")}}function qe(n,c){if(n&1){let e=x();m(0,"ion-searchbar",13),A("ngModelChange",function(i){h(e);let r=p();return P(r.sMyQuery,i)||(r.sMyQuery=i),_(i)}),C("ionInput",function(i){h(e);let r=p();return _(r.reloadList(i))})("ionCancel",function(i){h(e);let r=p();return _(r.reloadList(i))}),a()}if(n&2){let e=p();M("ngModel",e.sMyQuery)}}function Ke(n,c){if(n&1&&(m(0,"ion-col",16)(1,"div",17),b(2,"result-display",18),a()()),n&2){let e=c.$implicit,t=p(3);k("size-xl",t.getMaxColumnSpec()),o(),l("ngClass",R(5,Ve,t.isNew(e))),o(),l("item",e)("title",t.getTitle(e))("groupedBy",t.groupBy.PROGRAMM)}}function Je(n,c){if(n&1&&(m(0,"ion-row"),u(1,Ke,3,7,"ion-col",15),a()),n&2){let e=c.$implicit,t=p(2);o(),l("ngForOf",t.getWertungen(e))}}function He(n,c){if(n&1&&(m(0,"ion-grid",3),u(1,Je,2,1,"ion-row",14),a()),n&2){let e=p();o(),l("ngForOf",e.getProgramme())}}function Ze(n,c){if(n&1&&(m(0,"ion-col",20)(1,"div",17),b(2,"result-display",18),a()()),n&2){let e=c.$implicit,t=p(3);k("size-xl",t.getMaxColumnSpec()),o(),l("ngClass",R(5,Ve,t.isNew(e))),o(),l("item",e)("title",t.getTitle(e))("groupedBy",t.groupBy.PROGRAMM)}}function Xe(n,c){if(n&1&&(m(0,"ion-row"),u(1,Ze,3,7,"ion-col",19),a()),n&2){let e=c.$implicit,t=p(2);o(),l("ngForOf",t.getWertungen(e))}}function Ye(n,c){if(n&1&&(m(0,"ion-grid",3),u(1,Xe,2,1,"ion-row",14),a()),n&2){let e=p();o(),l("ngForOf",e.getProgramme())}}function et(n,c){if(n&1){let e=x();m(0,"ion-item-option",24),C("click",function(){h(e);let i=p().$implicit,r=T(1),s=p(3);return _(s.followAthlet(i,r))}),b(1,"ion-icon",25),S(2),a()}if(n&2){let e=p().$implicit;o(2),w(" Detail-Wertungen ",e.Athlet," ")}}function tt(n,c){if(n&1){let e=x();m(0,"ion-item-sliding",null,0)(2,"scorelist-item",21),C("click",function(){let i=h(e).$implicit,r=T(1),s=p(3);return _(s.scoreItemTapped(i,r))}),a(),m(3,"ion-item-options",22),u(4,et,3,1,"ion-item-option",23),a()()}if(n&2){let e=c.$implicit;o(2),l("teilnehmer",e),o(2),l("ngIf",e.athletID)}}function it(n,c){if(n&1&&(m(0,"div")(1,"ion-item-divider"),S(2),a(),u(3,tt,5,2,"ion-item-sliding",14),a()),n&2){let e=c.$implicit;o(2),L(e.title.text),o(),l("ngForOf",e.rows)}}function nt(n,c){if(n&1&&(m(0,"ion-list"),u(1,it,4,2,"div",14),a()),n&2){let e=p();o(),l("ngForOf",e.filteredScoreList)}}function rt(n,c){if(n&1){let e=x();m(0,"ion-footer")(1,"ion-toolbar")(2,"ion-button",26),C("click",function(){h(e);let i=p();return _(i.presentActionSheet())}),b(3,"ion-icon",27),a()()()}}var Be=(()=>{class n{navCtrl;backendService;actionSheetController;groupBy=Oe;items=[];lastItems;geraete=[];scorelinks=[];defaultPath=void 0;scoreblocks=[];sFilteredScoreList=[];sMyQuery;tMyQueryStream=new E;sFilterTask=void 0;busy=new z(!1);durchgangopen;subscriptions=[];constructor(e,t,i){this.navCtrl=e,this.backendService=t,this.actionSheetController=i,this.backendService.competitions||this.backendService.getCompetitions(),this.backendService.durchgangStarted.pipe(y(r=>r.filter(s=>s.wettkampfUUID===this.backendService.competition).length>0)).subscribe(r=>{this.durchgangopen=r})}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe())}ngOnInit(){this.subscriptions.push(this.backendService.competitionSubject.subscribe(e=>{this.backendService.activateNonCaptionMode(this.backendService.competition).subscribe(t=>{this.geraete=t||[],this.sortItems()}),this.subscriptions.push(this.backendService.newLastResults.subscribe(t=>{this.lastItems=this.items.map(i=>i.id*this.geraete.length+i.geraet),this.items=[],t&&t.results&&Object.keys(t.results).forEach(i=>{this.items.push(t.results[i])}),this.sortItems(),this.scorelistAvailable()?this.backendService.getScoreLists().subscribe(i=>{let r=this.competitionContainer(),s="";r.altersklassen&&r.altersklassen.trim().length>0?s=":Wettkampf%20Altersklassen":r.jahrgangsklassen&&r.jahrgangsklassen.trim().length>0&&(s=":Wettkampf%20JG-Altersklassen");let d=`/api/scores/${r.uuid}/query?groupby=Kategorie${s}:Geschlecht`;if(i){let f=Object.values(i).filter(v=>v.name!="Zwischenresultate").sort((v,De)=>v.name.localeCompare(De.name)),O={name:"Generische Rangliste",published:!0,"published-date":"","scores-href":d,"scores-query":d},Ne={name:"Generische Team-Rangliste",published:!0,"published-date":"","scores-href":d+"&kind=Teamrangliste","scores-query":d+"&kind=Teamrangliste"};this.scorelinks=this.teamsAllowed(r)?[...f,Ne,O]:[...f,O];let $e=this.scorelinks.filter(v=>""+v.published=="true");this.refreshScoreList($e[0])}}):this.title="Aktuelle Resultate"}))}))}teamsAllowed(e){return e.teamrule?.trim().length>0&&e.teamrule!=="Keine Teams"}_title="Aktuelle Resultate";get title(){return this._title}set title(e){this._title=e}refreshScoreList(e){let t=e["scores-href"];e.published||(t=e["scores-query"]),t.startsWith("/")&&(t=t.substring(1)),t=t.replace("html",""),this.title=e.name,this.defaultPath=t,this.backendService.getScoreList(this.defaultPath).pipe(y(i=>i.title&&i.scoreblocks?i.scoreblocks:[])).subscribe(i=>{this.scoreblocks=i;let r=this.tMyQueryStream.pipe(B(s=>!!s&&!!s.target&&!!s.target.value),y(s=>s.target.value),N(1e3),$(),D());r.subscribe(()=>{this.busy.next(!0)}),r.pipe(G(this.runQuery(i))).subscribe(s=>{this.sFilteredScoreList=s,this.busy.next(!1)})})}sortItems(){let e=(t,i)=>{let r=t.programm.localeCompare(i.programm);return r===0&&(r=this.geraetOrder(t.geraet)-this.geraetOrder(i.geraet)),r};this.items=this.items.filter(t=>t.wertung.endnote!==void 0).sort(e)}isNew(e){return this.lastItems.filter(t=>t===e.id*this.geraete.length+e.geraet).length===0}get stationFreezed(){return this.backendService.stationFreezed}set competition(e){this.stationFreezed||(this.backendService.getDurchgaenge(e),this.backendService.activateNonCaptionMode(this.backendService.competition).subscribe(t=>{this.geraete=t||[],this.sortItems()}))}get competition(){return this.backendService.competition||""}getCompetitions(){return this.backendService.competitions||[]}competitionContainer(){let e={titel:"",datum:new Date,auszeichnung:void 0,auszeichnungendnote:void 0,id:void 0,uuid:void 0,programmId:0,teamrule:""};if(!this.backendService.competitions)return e;let t=this.backendService.competitions.filter(i=>i.uuid===this.backendService.competition);return t.length===1?t[0]:e}competitionName(){let e=this.competitionContainer();return e.titel===""?"":e.titel+", am "+(e.datum+"T").split("T")[0].split("-").reverse().join("-")}geraetOrder(e){return this.geraete?this.geraete.findIndex(t=>t.id===e):0}geraetText(e){if(!this.geraete)return"";let t=this.geraete.filter(i=>i.id===e).map(i=>i.name);return t.length===1?t[0]:""}getColumnSpec(){return this.geraete?.length||0}getMaxColumnSpec(){return Math.min(12,Math.max(1,Math.floor(12/this.geraete.length+.5)))}getTitle(e){return e.programm+" - "+this.geraetText(e.geraet)}onlyUnique(e,t,i){return i.indexOf(e)===t}getProgramme(){return this.items.map(e=>e.programm).filter(this.onlyUnique)}getWertungen(e){return this.items.filter(t=>t.programm===e)}scorelistAvailable(){return!this.durchgangopen&&this.items?.length===0&&new Date(this.competitionContainer().datum).getTime()<new Date(Date.now()-3600*1e3*24).getTime()}get filteredScoreList(){return this.sFilteredScoreList&&this.sFilteredScoreList.length>0?this.sFilteredScoreList:this.getScoreListItems()}get isBusy(){return this.busy}runQuery(e){return t=>{let i=t.trim(),r=[];return i&&e&&e.forEach(s=>{let d=this.filter(i),g=s.rows.filter(f=>d(f,s));if(g.length>0){let f={title:s.title,rows:g};r=[...r,f]}}),V(r)}}filter(e){let t=e.toUpperCase(),i=t.split(" ");return(r,s)=>s.title.text.toUpperCase().indexOf(t)>-1?!0:i.filter(d=>[r,...r.rows].find(g=>{if(g.Athlet?.toUpperCase().indexOf(d)>-1||g["Team/Athlet"]?.toUpperCase().indexOf(d)>-1||g.Team?.toUpperCase().indexOf(d)>-1||g.Verein?.toUpperCase().indexOf(d)>-1||g.Jahrgang?.toUpperCase()===d||s.title.text.toUpperCase().replace("."," ").replace(","," ").split(" ").indexOf(d)>-1)return!0})).length===i.length}reloadList(e){this.tMyQueryStream.next(e)}makeGenericScoreListLink(){return`${Ae}${this.defaultPath}&html`}getScoreListItems(){return this.scoreblocks}scoreItemTapped(e,t){t.getOpenAmount().then(i=>{i>0?t.close():t.open("end")})}followAthlet(e,t){t.close(),e.athletID&&this.navCtrl.navigateForward(`athlet-view/${this.backendService.competition}/${e.athletID}`)}open(){window.open(this.makeGenericScoreListLink(),"_blank")}isShareAvailable(){return!!navigator&&!!navigator.share}share(){let e="GeTu",t={1:"Athletik",11:"KuTu",20:"GeTu",31:"KuTu"},i=this.competitionContainer();i.titel!==""&&(e=t[i.programmId]);let r=`${this.competitionName()} #${e}-${i.titel.replace(","," ").split(" ").join("_")}`;this.isShareAvailable()&&navigator.share({title:`${e} Rangliste`,text:r,url:this.makeGenericScoreListLink()}).then(function(){console.log("Article shared")}).catch(function(s){console.log(s.message)})}presentActionSheet(){return F(this,null,function*(){let e=[...this.scorelinks.map(r=>""+r.published=="true"?{text:`${r.name} anzeigen ...`,icon:"document",handler:()=>{this.refreshScoreList(r)}}:{text:`${r.name} (unver\xF6ffentlicht)`,icon:"today-outline",handler:()=>{this.refreshScoreList(r)}}),{text:"Rangliste \xF6ffnen ...",icon:"open",handler:()=>{this.open()}}];this.isShareAvailable()&&(e=[...e,{text:"Teilen / Share ...",icon:"share",handler:()=>{this.share()}}]);let t={header:"Aktionen",cssClass:"my-actionsheet-class",buttons:e};yield(yield this.actionSheetController.create(t)).present()})}static \u0275fac=function(t){return new(t||n)(I(ne),I(Re),I(Me))};static \u0275cmp=j({type:n,selectors:[["app-last-results"]],standalone:!1,decls:20,vars:8,consts:[["slidingAthletScoreItem",""],["slot","start"],["slot","icon-only","name","menu"],["no-padding",""],[4,"ngIf"],["slot","end",4,"ngIf"],["placeholder","Search","showCancelButton","never",3,"ngModel","ngModelChange","ionInput","ionCancel",4,"ngIf"],["no-padding","",4,"ngIf"],["label","Wettkampf","placeholder","Bitte ausw\xE4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["label","Wettkampf","placeholder","Bitte ausw\xE4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","end"],["placeholder","Search","showCancelButton","never",3,"ngModelChange","ionInput","ionCancel","ngModel"],[4,"ngFor","ngForOf"],["class","align-self-start","size-xs","12","size-md","6","size-lg","3",4,"ngFor","ngForOf"],["size-xs","12","size-md","6","size-lg","3",1,"align-self-start"],[3,"ngClass"],[3,"item","title","groupedBy"],["class","align-self-start","size-xs","12","size-sm","6","size-md","4","size-lg","3",4,"ngFor","ngForOf"],["size-xs","12","size-sm","6","size-md","4","size-lg","3",1,"align-self-start"],[3,"click","teilnehmer"],["side","end"],["color","primary",3,"click",4,"ngIf"],["color","primary",3,"click"],["name","arrow-forward-circle-outline","ios","md-arrow-forward-circle-outline"],["size","large","expand","block","color","primary",3,"click"],["slot","start","name","list"]],template:function(t,i){t&1&&(m(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-menu-toggle")(4,"ion-button"),b(5,"ion-icon",2),a()()(),m(6,"ion-title")(7,"ion-grid",3)(8,"ion-row")(9,"ion-col")(10,"ion-label"),S(11),a()(),u(12,Ue,3,1,"ion-col",4),a()()(),u(13,Qe,2,1,"ion-note",5),a(),u(14,qe,1,1,"ion-searchbar",6),a(),m(15,"ion-content"),u(16,He,2,1,"ion-grid",7)(17,Ye,2,1,"ion-grid",7)(18,nt,2,1,"ion-list",4),a(),u(19,rt,4,0,"ion-footer",4)),t&2&&(o(11),L(i.title),o(),l("ngIf",!i.competition),o(),l("ngIf",i.competition),o(),l("ngIf",i.scorelistAvailable()),o(2),l("ngIf",i.items.length>0&&i.getColumnSpec()===6),o(),l("ngIf",i.items.length>0&&i.getColumnSpec()!==6),o(),l("ngIf",i.scorelistAvailable()),o(),l("ngIf",i.scorelistAvailable()))},dependencies:[K,J,H,ee,te,se,ae,le,ce,me,pe,ue,de,ge,he,_e,fe,be,xe,Se,ve,Ce,ye,Ie,we,ke,Te,Le,re,oe,Fe,Ee,Z],encapsulation:2})}return n})();var ot=[{path:"",component:Be}],It=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=U({type:n});static \u0275inj=W({imports:[X,ie,Pe,Y.forChild(ot),ze]})}return n})();export{It as LastResultsPageModule};
