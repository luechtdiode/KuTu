import{$a as be,B as s,Ba as ne,Bb as Ae,C as a,D as u,E as h,Ea as oe,Fa as re,G as p,H as c,Ha as se,Ja as ae,Ka as le,N as y,Na as ce,O as d,Oa as me,Q as x,Qa as de,R,Ra as ue,T as A,Ta as k,U as M,V as L,Va as ge,Wa as pe,Xa as _e,Y as S,Ya as w,Z as T,Za as fe,_ as H,a as E,ab as he,b as P,ba as K,c as F,ca as Y,d as B,da as q,e as O,ea as G,eb as Ce,f as N,fb as Ie,g as I,ga as J,gb as ye,h as W,hb as xe,i as $,j as Q,k as j,kb as ve,lb as Se,m as U,ma as X,o as _,p as f,q as z,qa as Z,rb as ke,sa as ee,t as l,tb as we,u as C,ub as Re,v,va as te,w as D,x as b,z as m,za as ie}from"./chunk-KMY4ZES7.js";import"./chunk-6IQPZO6F.js";import"./chunk-JSAAGAZE.js";import"./chunk-5XVA5RR2.js";import"./chunk-LOHYXAXQ.js";import"./chunk-P5VFIEEE.js";import"./chunk-HC6MZPB3.js";import"./chunk-J5OMF6R4.js";import"./chunk-KWW2H4SN.js";import"./chunk-7HA5TF5T.js";import"./chunk-ZOBGMWXG.js";import"./chunk-426OJ4HC.js";import"./chunk-RPQZFOYD.js";import"./chunk-GIGBYVJT.js";import"./chunk-MM5QLNJM.js";import"./chunk-H3GX5QFY.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-G2DZN4YG.js";import"./chunk-MCRJI3T3.js";import"./chunk-TI7J2N3O.js";import"./chunk-TTFYQ64X.js";import{g as V}from"./chunk-2R6CW7ES.js";var Le=(()=>{class o{clubregistration;status;selected=new z;constructor(){}ngOnInit(){}static \u0275fac=function(i){return new(i||o)};static \u0275cmp=v({type:o,selectors:[["clublist-item"]],inputs:{clubregistration:"clubregistration",status:"status"},outputs:{selected:"selected"},standalone:!1,decls:10,vars:5,consts:[[3,"click"],["slot","start"],["src","assets/imgs/verein.png"],["slot","end"]],template:function(i,t){i&1&&(s(0,"ion-item",0),p("click",function(){return t.selected?t.selected.emit(t.clubregistration):{}}),s(1,"ion-avatar",1),u(2,"img",2),a(),s(3,"ion-label"),d(4),u(5,"br"),s(6,"small"),d(7),a()(),s(8,"ion-note",3),d(9),a()()),i&2&&(l(4),R("",t.clubregistration.vereinname,", ",t.clubregistration.verband,""),l(3),R("(",t.clubregistration.respVorname," ",t.clubregistration.respName,")"),l(2),x(" Status ",t.status," "))},dependencies:[se,k,w,he],encapsulation:2})}return o})();function Be(o,g){if(o&1&&(s(0,"ion-select-option",12),d(1),S(2,"date"),a()),o&2){let e=g.$implicit;m("value",e.uuid),l(),x(" ",e.titel+" "+H(2,2,e.datum,"dd-MM-yy"),"")}}function Oe(o,g){if(o&1){let e=h();s(0,"ion-select",10),L("ngModelChange",function(t){_(e);let n=c();return M(n.competition,t)||(n.competition=t),f(t)}),b(1,Be,3,5,"ion-select-option",11),a()}if(o&2){let e=c();A("ngModel",e.competition),l(),m("ngForOf",e.getCompetitions())}}function Ne(o,g){o&1&&(s(0,"ion-item")(1,"ion-label"),d(2,"loading ..."),a(),u(3,"ion-spinner"),a())}function We(o,g){if(o&1){let e=h();s(0,"ion-item-option",20),p("click",function(){_(e),c();let t=y(1),n=c(2);return f(n.logout(t))}),u(1,"ion-icon",17),d(2," Abmelden "),a()}}function $e(o,g){if(o&1){let e=h();s(0,"ion-item-option",21),p("click",function(){_(e);let t=c().$implicit,n=y(1),r=c(2);return f(r.delete(t,n))}),u(1,"ion-icon",17),d(2," L\xF6schen "),a()}}function Qe(o,g){if(o&1){let e=h();s(0,"ion-item-sliding",null,0)(2,"clublist-item",14),p("click",function(){let t=_(e).$implicit,n=y(1),r=c(2);return f(r.itemTapped(t,n))}),a(),s(3,"ion-item-options",15)(4,"ion-item-option",16),p("click",function(){let t=_(e).$implicit,n=y(1),r=c(2);return f(r.login(t,n))}),u(5,"ion-icon",17),d(6),a(),b(7,We,3,0,"ion-item-option",18)(8,$e,3,0,"ion-item-option",19),a()()}if(o&2){let e=g.$implicit,i=c(2);l(2),m("clubregistration",e)("status",i.getStatus(e)),l(4),x(" ",i.isLoggedIn(e)?"Bearbeiten":"Login"," "),l(),m("ngIf",i.isLoggedIn(e)),l(),m("ngIf",i.isLoggedIn(e))}}function je(o,g){if(o&1&&(s(0,"ion-content")(1,"ion-list"),b(2,Ne,4,0,"ion-item",7),S(3,"async"),b(4,Qe,9,5,"ion-item-sliding",13),a()()),o&2){let e=c();l(2),m("ngIf",T(3,2,e.isBusy)),l(2),m("ngForOf",e.filteredStartList)}}function Ue(o,g){if(o&1){let e=h();s(0,"ion-button",22),p("click",function(){_(e);let t=c();return f(t.createRegistration())}),u(1,"ion-icon",23),d(2," Neue Anmeldung... "),a()}}function ze(o,g){if(o&1){let e=h();s(0,"ion-button",24,1),S(2,"async"),p("click",function(){_(e);let t=c();return f(t.logout(null))}),u(3,"ion-icon",25),d(4,"Vereins-Login Abmelden"),a()}if(o&2){let e=c();m("disabled",T(2,1,e.isBusy))}}var Te=(()=>{class o{navCtrl;route;backendService;toastController;alertCtrl;sClubRegistrationList;sFilteredRegistrationList;sMyQuery;sSyncActions=[];tMyQueryStream=new E;sFilterTask=void 0;busy=new P(!1);constructor(e,i,t,n,r){this.navCtrl=e,this.route=i,this.backendService=t,this.toastController=n,this.alertCtrl=r,this.backendService.competitions||this.backendService.getCompetitions()}ngOnInit(){this.busy.next(!0);let e=this.route.snapshot.paramMap.get("wkId");e?this.competition=e:this.backendService.competition&&(this.competition=this.backendService.competition)}ionViewWillEnter(){this.getSyncActions()}get stationFreezed(){return this.backendService.stationFreezed}set competition(e){(!this.clubregistrations||e!==this.backendService.competition)&&(this.busy.next(!0),this.clubregistrations=[],this.backendService.getClubRegistrations(e).pipe(I(1)).subscribe(i=>{this.getSyncActions(),this.clubregistrations=i,this.busy.next(!1),this.tMyQueryStream.pipe(O(n=>!!n&&!!n.target),B(n=>n.target.value||"*"),N(300),W(),j(n=>this.busy.next(!0)),Q(this.runQuery(i)),$()).subscribe(n=>{this.sFilteredRegistrationList=n,this.busy.next(!1)})}))}get competition(){return this.backendService.competition||""}set clubregistrations(e){this.sClubRegistrationList=e,this.reloadList(this.sMyQuery)}get clubregistrations(){return this.sClubRegistrationList}get filteredStartList(){return this.sFilteredRegistrationList||this.sClubRegistrationList}get isBusy(){return this.busy}getSyncActions(){this.backendService.loadRegistrationSyncActions().pipe(I(1)).subscribe(e=>{this.sSyncActions=e})}getStatus(e){return this.sSyncActions?this.sSyncActions.find(i=>i.verein.id===e.id)?"Abgleich ausstehend":"Nachgef\xFChrt":"n/a"}runQuery(e){return i=>{let t=i.trim(),n=[];return t&&e&&e.forEach(r=>{this.filter(t)(r)&&n.push(r)}),F(n)}}reloadList(e){this.tMyQueryStream.next(e)}itemTapped(e,i){i.getOpenAmount().then(t=>{t>0?i.close():i.open("end")})}isLoggedIn(e){return this.backendService.loggedIn&&this.backendService.authenticatedClubId===e.id+""}isLoggedInAsClub(){return this.backendService.loggedIn&&!!this.backendService.authenticatedClubId}logout(e){e&&e.close(),this.alertCtrl.create({header:"Achtung",message:"F\xFCr sp\xE4tere Bearbeitungen an der Registrierung des Vereins am Wettkampf ist ein erneutes Login notwendig.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.clublogout()}}]}).then(t=>t.present())}delete(e,i){i.close(),this.alertCtrl.create({header:"Achtung",subHeader:"L\xF6schen der Vereins-Registrierung und dessen Anmeldungen am Wettkampf",message:"Hiermit wird die Vereinsanmeldung am Wettkampf komplett gel\xF6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.deleteClubRegistration(this.competition,e.id)}}]}).then(n=>n.present())}showPasswordResetSuccess(){return V(this,null,function*(){(yield this.toastController.create({header:"Passwort-Reset",message:"Es wurde eine EMail mit dem Reset-Link versendet!",animated:!0,position:"middle",buttons:[{text:"OK",role:"cancel"}]})).present()})}login(e,i){i.close(),this.isLoggedIn(e)?this.navCtrl.navigateForward(`registration/${this.competition}/${e.id}`):this.alertCtrl.create({header:"Vereins-Login",message:`Login f\xFCr die Bearbeitung der Vereinsanmeldung am Wettkampf ${this.competitionName()}`,inputs:[{name:"username",label:"Vereinsname",placeholder:"Vereinsname",value:`${e.vereinname} (${e.verband})`,type:"text"},{name:"pw",label:"Passwort",placeholder:"Passwort",type:"password"}],buttons:[{text:"Abbrechen",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Login",handler:n=>n.pw&&n.pw.trim().length>0?(this.backendService.clublogin(e.id,n.pw).pipe(I(1)).subscribe({next:r=>{this.navCtrl.navigateForward(`registration/${this.competition}/${e.id}`)},error:r=>{r.status===401&&this.alertCtrl.create({header:"Vereins-Login Fehlgeschlagen",message:`Soll f\xFCr diese Vereinsanmeldung am Wettkampf ${this.competitionName()} ein Passwort-Reset Vorgang gestartet werden?`,inputs:[],buttons:[{text:"Abbrechen",role:"cancel",handler:()=>(console.log("Cancel clicked"),!1)},{text:"Passwort-Reset",handler:()=>(this.backendService.resetRegistration(e.id).pipe(I(1)).subscribe(()=>{this.showPasswordResetSuccess()}),!0)}]}).then(Ee=>{Ee.present()})}}),!0):!1}]}).then(n=>{n.onkeypress=r=>{r.code==="Enter"&&n.getElementsByClassName("ion-activatable")[1].click()},n.present()})}createRegistration(){this.navCtrl.navigateForward(`registration/${this.competition}/0`)}getCompetitions(){return this.backendService.competitions||[]}competitionName(){return this.backendService.competitionName}filter(e){let i=e.toUpperCase().split(" ");return t=>e.trim()==="*"||i.filter(n=>{if(t.vereinname.toUpperCase().indexOf(n)>-1||t.verband.toUpperCase().indexOf(n)>-1||t.mail.toUpperCase().indexOf(n)>-1||t.respName.toUpperCase().indexOf(n)>-1||t.respVorname.toUpperCase().indexOf(n)>-1)return!0}).length===i.length}static \u0275fac=function(i){return new(i||o)(C(ne),C(X),C(Ae),C(we),C(ke))};static \u0275cmp=v({type:o,selectors:[["app-registration"]],standalone:!1,decls:18,vars:5,consts:[["slidingClubRegistrationItem",""],["btnDelete",""],["slot","start"],["slot","icon-only","name","menu"],["slot","end"],["label","Wettkampf","placeholder","Bitte ausw\xE4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["placeholder","Search","showCancelButton","never",3,"ngModelChange","ionInput","ionCancel","ngModel"],[4,"ngIf"],["size","large","expand","block","color","success",3,"click",4,"ngIf"],["size","large","expand","block","color","danger",3,"disabled","click",4,"ngIf"],["label","Wettkampf","placeholder","Bitte ausw\xE4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngFor","ngForOf"],[3,"click","clubregistration","status"],["side","end"],["color","primary",3,"click"],["name","arrow-forward-circle-outline","ios","md-arrow-forward-circle-outline"],["color","secondary",3,"click",4,"ngIf"],["color","danger",3,"click",4,"ngIf"],["color","secondary",3,"click"],["color","danger",3,"click"],["size","large","expand","block","color","success",3,"click"],["slot","start","name","add"],["size","large","expand","block","color","danger",3,"click","disabled"],["slot","start","name","log-out"]],template:function(i,t){i&1&&(s(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-menu-toggle")(4,"ion-button"),u(5,"ion-icon",3),a()()(),s(6,"ion-title")(7,"ion-label"),d(8,"Wettkampf-Anmeldungen"),a()(),s(9,"ion-buttons",4),b(10,Oe,2,2,"ion-select",5),a()(),s(11,"ion-searchbar",6),L("ngModelChange",function(r){return M(t.sMyQuery,r)||(t.sMyQuery=r),r}),p("ionInput",function(r){return t.reloadList(r)})("ionCancel",function(r){return t.reloadList(r)}),a()(),b(12,je,5,4,"ion-content",7),s(13,"ion-footer")(14,"ion-toolbar")(15,"ion-list"),b(16,Ue,3,0,"ion-button",8)(17,ze,5,3,"ion-button",9),a()()()),i&2&&(l(10),m("ngIf",t.getCompetitions().length>0),l(),A("ngModel",t.sMyQuery),l(),m("ngIf",t.competition&&t.clubregistrations),l(4),m("ngIf",!t.isLoggedInAsClub()),l(),m("ngIf",t.isLoggedInAsClub()))},dependencies:[K,Y,ee,te,ae,le,ce,me,de,ue,k,ge,pe,_e,w,fe,be,Ce,Ie,ye,xe,ve,Se,oe,re,Le,q,G],encapsulation:2})}return o})();var De=[{path:"",component:Te}],dt=(()=>{class o{static \u0275fac=function(i){return new(i||o)};static \u0275mod=D({type:o});static \u0275inj=U({imports:[J,ie,Re,Z.forChild(De)]})}return o})();export{dt as RegistrationPageModule};
