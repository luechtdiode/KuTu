import{g as he,h as ue}from"./chunk-T4CFNL5Z.js";import{B as o,Ba as D,Bb as pe,C as r,D as d,E as v,Fa as L,G as C,H as c,Ha as J,Ja as Y,Ka as $,N as f,Na as G,O as m,Oa as Z,Q as w,Qa as Q,Ra as X,Sa as ee,T as y,Ta as te,U as x,Ua as ie,V as S,Za as ne,ab as re,ba as R,ca as N,g as E,ga as T,kb as oe,lb as ae,m as P,ma as W,nb as se,o as h,ob as le,p as u,qa as F,r as A,rb as de,sa as z,sb as ce,t as a,ta as B,u as _,ua as O,ub as me,v as V,va as j,w as M,wa as q,wb as ge,x as b,xa as U,ya as H,z as l,za as K}from"./chunk-SCHL4OOB.js";import"./chunk-RTI2IBQE.js";import"./chunk-YPCCWTCR.js";import"./chunk-IXGCB5RR.js";import"./chunk-LOHYXAXQ.js";import"./chunk-N7UIYTQY.js";import"./chunk-HC6MZPB3.js";import"./chunk-J5OMF6R4.js";import"./chunk-KWW2H4SN.js";import"./chunk-7HA5TF5T.js";import"./chunk-ADN7P72M.js";import"./chunk-426OJ4HC.js";import"./chunk-RPQZFOYD.js";import"./chunk-GIGBYVJT.js";import"./chunk-MM5QLNJM.js";import"./chunk-H3GX5QFY.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-YPW7SQSE.js";import"./chunk-MCRJI3T3.js";import"./chunk-PL2JVG7G.js";import"./chunk-ACERUE7O.js";import{g as k}from"./chunk-2R6CW7ES.js";function Ce(n,g){n&1&&(o(0,"ion-button",27),d(1,"ion-icon",28),m(2,"\xA0\xA0 Verein aus liste ausw\xE4hlen ..."),r())}function we(n,g){if(n&1){let e=v();o(0,"app-typeahead",30),C("selectionChange",function(i){h(e),c();let s=f(1);return c(2).setVereinSelected(i),u(s.dismiss())})("selectionCancel",function(){h(e),c();let i=f(1);return u(i.dismiss())}),r()}if(n&2){let e=c(3);l("items",e.clublist)("selectedItem",e.getVereinSelected)}}function Ie(n,g){n&1&&(o(0,"ion-modal",29,2),b(2,we,1,2,"ng-template"),r())}function ye(n,g){if(n&1&&(o(0,"ion-item")(1,"ion-avatar",4),d(2,"img",31),r(),d(3,"ion-input",32)(4,"ion-input",33),r()),n&2){let e=c(2);a(3),l("readonly",!1)("disabled",!1)("ngModel",e.newRegistration.secret),a(),l("readonly",!1)("disabled",!1)("ngModel",e.newRegistration.verification)}}function xe(n,g){if(n&1){let e=v();o(0,"ion-item")(1,"ion-avatar",4),d(2,"img",31),r(),o(3,"ion-input",34),S("ngModelChange",function(i){h(e);let s=c(2);return x(s.changePassword.secret,i)||(s.changePassword.secret=i),u(i)}),r(),o(4,"ion-input",35),S("ngModelChange",function(i){h(e);let s=c(2);return x(s.changePassword.verification,i)||(s.changePassword.verification=i),u(i)}),r()()}if(n&2){let e=c(2);a(3),l("readonly",!1)("disabled",!1),y("ngModel",e.changePassword.secret),a(),l("readonly",!1)("disabled",!1),y("ngModel",e.changePassword.verification)}}function Se(n,g){if(n&1){let e=v();o(0,"ion-item")(1,"ion-avatar",4),m(2," \xA0 "),r(),o(3,"ion-button",36,3),C("click",function(){h(e);let i=c(2);return u(i.savePWChange())}),d(5,"ion-icon",25),m(6,"Passwort \xE4ndern "),r()()}if(n&2){let e=c(2);a(3),l("disabled",e.waiting||!e.changePassword.secret||e.changePassword.secret!==e.changePassword.verification)}}function ke(n,g){if(n&1&&(o(0,"ion-item"),m(1),r()),n&2){let e=g.$implicit;a(),w(" ",e," ")}}function Ee(n,g){if(n&1){let e=v();o(0,"ion-content"),b(1,Ce,3,0,"ion-button",11)(2,Ie,3,0,"ion-modal",12),o(3,"form",13,0),C("ngSubmit",function(){h(e);let i=f(4),s=c();return u(s.save(i))})("keyup.enter",function(){h(e);let i=f(4),s=c();return u(s.save(i))}),o(5,"ion-list")(6,"ion-item-divider",14),m(7,"Verein"),r(),o(8,"ion-item")(9,"ion-avatar",4),d(10,"img",15),r(),d(11,"ion-input",16)(12,"ion-input",17),r(),o(13,"ion-item-divider",14),m(14,"Verantwortliche Person"),r(),o(15,"ion-item")(16,"ion-avatar",4),d(17,"img",18),r(),d(18,"ion-input",19)(19,"ion-input",20),r(),b(20,ye,5,6,"ion-item",8)(21,xe,5,6,"ion-item",8)(22,Se,7,1,"ion-item",8),o(23,"ion-item-divider",14),m(24,"Kontakt"),r(),o(25,"ion-item")(26,"ion-avatar",4),d(27,"img",21),r(),d(28,"ion-input",22)(29,"ion-input",23),r()(),o(30,"ion-button",24,1),d(32,"ion-icon",25),m(33,"Speichern "),r()(),o(34,"ion-list")(35,"ion-item-divider",14),m(36),r(),b(37,ke,2,1,"ion-item",26),r()()}if(n&2){let e=f(4),t=c();a(),l("ngIf",t.regId===0),a(),l("ngIf",t.regId===0),a(9),l("readonly",!1)("autofocus",!0)("disabled",!1)("ngModel",t.registration.vereinname),a(),l("readonly",!1)("disabled",!1)("ngModel",t.registration.verband),a(6),l("readonly",!1)("disabled",!1)("ngModel",t.registration.respVorname),a(),l("readonly",!1)("disabled",!1)("ngModel",t.registration.respName),a(),l("ngIf",t.regId===0),a(),l("ngIf",t.regId>0),a(),l("ngIf",t.regId>0),a(6),l("readonly",!1)("disabled",!1)("ngModel",t.registration.mail),a(),l("readonly",!1)("disabled",!1)("ngModel",t.registration.mobilephone),a(),l("disabled",t.waiting||!e.valid||e.untouched),a(6),w("Pendente Verarbeitungen (",t.sSyncActions.length,")"),a(),l("ngForOf",t.sSyncActions)}}var _e=(()=>{class n{navCtrl;route;backendService;alertCtrl;actionSheetController;zone;constructor(e,t,i,s,p,be){this.navCtrl=e,this.route=t,this.backendService=i,this.alertCtrl=s,this.actionSheetController=p,this.zone=be,this.backendService.competitions||this.backendService.getCompetitions(),this.backendService.getClubList().subscribe(fe=>{this.clublist=fe.map(I=>({item:I,text:I.name+" ("+I.verband+")"}))})}_selectedVerein;get getVereinSelected(){return this._selectedVerein}setVereinSelected(e){this._selectedVerein=e,this.newRegistration.vereinname=e.name,this.newRegistration.verband=e.verband}waiting=!1;registration;newRegistration;changePassword;sSyncActions=[];clublist=[];wettkampf;regId;wkId;wettkampfId;ngOnInit(){this.waiting=!0,this.wkId=this.route.snapshot.paramMap.get("wkId"),this.regId=parseInt(this.route.snapshot.paramMap.get("regId")),this.backendService.getCompetitions().subscribe(e=>{this.wettkampfId=parseInt(e.find(t=>t.uuid===this.wkId).id),this.regId?this.backendService.getClubRegistrations(this.wkId).subscribe(t=>{t&&t.length>0&&this.updateUI(t.find(i=>i.id===this.regId))}):this.updateUI({mobilephone:"+417"})})}filter(e){let t=e.toUpperCase().split(" ");return i=>e.trim()==="*"||t.filter(s=>{if(i.name.toUpperCase().indexOf(s)>-1||i.verband.toUpperCase().indexOf(s)>-1)return!0}).length===t.length}presentActionSheet(){return k(this,null,function*(){let e={};this.registration.vereinId?e={header:"Anmeldungen",cssClass:"my-actionsheet-class",buttons:[{text:"Athlet & Athletinnen",icon:"list",handler:()=>{this.editAthletRegistrations()}},{text:"Wertungsrichter",icon:"glasses",handler:()=>{this.editJudgeRegistrations()}},{text:"Kopieren aus anderem Wettkampf",icon:"share",handler:()=>{this.copyFromOthers()}},{text:"Registrierung l\xF6schen",role:"destructive",icon:"trash",handler:()=>{this.delete()}},{text:"Abbrechen",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]}:e={header:"Anmeldungen",cssClass:"my-actionsheet-class",buttons:[{text:"Athlet & Athletinnen",icon:"list",handler:()=>{this.editAthletRegistrations()}},{text:"Wertungsrichter",icon:"glasses",handler:()=>{this.editJudgeRegistrations()}},{text:"Registrierung l\xF6schen",role:"destructive",icon:"trash",handler:()=>{this.delete()}},{text:"Abbrechen",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]},yield(yield this.actionSheetController.create(e)).present()})}editable(){return this.backendService.loggedIn}ionViewWillEnter(){this.getSyncActions()}getSyncActions(){this.regId>0&&this.backendService.loadRegistrationSyncActions().pipe(E(1)).subscribe(e=>{this.sSyncActions=e.filter(t=>t.verein.id===this.registration.id).map(t=>t.caption)})}updateUI(e){this.zone.run(()=>{this.waiting=!1,this.wettkampf=this.backendService.competitionName,this.registration=e,e&&(this.regId===0?this.newRegistration=e:this.changePassword={id:this.regId,wettkampfId:e.wettkampfId||this.wettkampfId,secret:"",verification:""},this.registration.mail&&this.registration.mail.length>1&&(this.backendService.currentUserName=this.registration.mail))})}savePWChange(){this.changePassword&&this.changePassword.secret&&this.changePassword.secret===this.changePassword.verification&&this.backendService.saveClubRegistrationPW(this.wkId,this.changePassword)}save(e){if(!e.valid)return;let t=e.value;if(this.regId===0){let i=t;if(i.secret!==i.verification)this.alertCtrl.create({header:"Achtung",subHeader:"Passwort-Verifikation",message:"Das Passwort stimmt nicht mit der Verifikation \xFCberein. Beide m\xFCssen genau gleich erfasst sein.",buttons:[{text:"OKAY",role:"cancel",handler:()=>{}}]}).then(p=>p.present());else{let s={mail:i.mail,mobilephone:i.mobilephone,respName:i.respName,respVorname:i.respVorname,verband:i.verband,vereinname:i.vereinname,wettkampfId:i.wettkampfId||this.wettkampfId,secret:i.secret};this.backendService.createClubRegistration(this.wkId,s).subscribe(p=>{this.regId=p.id,this.registration=p,this.backendService.currentUserName=p.mail,this.presentActionSheet()})}}else{let i={id:this.registration.id,registrationTime:this.registration.registrationTime,vereinId:this.registration.vereinId,mail:t.mail,mobilephone:t.mobilephone,respName:t.respName,respVorname:t.respVorname,verband:t.verband,vereinname:t.vereinname,wettkampfId:t.wettkampfId||this.wettkampfId};this.backendService.saveClubRegistration(this.wkId,i)}}delete(){this.alertCtrl.create({header:"Achtung",subHeader:"L\xF6schen der Vereins-Registrierung und dessen Anmeldungen am Wettkampf",message:"Hiermit wird die Vereinsanmeldung am Wettkampf komplett gel\xF6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.deleteClubRegistration(this.wkId,this.regId).subscribe(()=>{this.navCtrl.pop()})}}]}).then(t=>t.present())}editAthletRegistrations(){this.navCtrl.navigateForward(`reg-athletlist/${this.backendService.competition}/${this.regId}`)}editJudgeRegistrations(){this.navCtrl.navigateForward(`reg-judgelist/${this.backendService.competition}/${this.regId}`)}copyFromOthers(){this.backendService.findCompetitionsByVerein(this.registration.vereinId).subscribe(e=>{let t=e.map(i=>({type:"radio",label:i.titel+" ("+ge(i.datum)+")",value:i}));this.alertCtrl.create({header:"Anmeldungen kopieren",cssClass:"my-optionselection-class",message:"Aus welchem Wettkampf sollen die Anmeldungen kopiert werden?",inputs:t,buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:i=>{this.backendService.copyClubRegsFromCompetition(i,this.backendService.competition,this.registration.id).subscribe(()=>{this.getSyncActions(),this.alertCtrl.create({header:"Anmeldungen kopieren",message:"Alle nicht bereits erfassten Anmeldungen wurden \xFCbernommen.",buttons:[{text:"OKAY",role:"cancel",handler:()=>{}},{text:"> Athlet-Anmeldungen",handler:()=>{this.editAthletRegistrations()}},{text:"> WR Anmeldungen",handler:()=>{this.editJudgeRegistrations()}}]}).then(s=>s.present())})}}]}).then(i=>i.present())})}static \u0275fac=function(t){return new(t||n)(_(D),_(W),_(pe),_(de),_(ce),_(A))};static \u0275cmp=V({type:n,selectors:[["app-clubreg-editor"]],standalone:!1,decls:15,vars:3,consts:[["clubRegistrationform","ngForm"],["btnSaveNext",""],["modal",""],["btnChangePassword",""],["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[4,"ngIf"],["size","large","expand","block","color","primary",3,"click","disabled"],["slot","start","name","list"],["id","searchClubPresets","size","large","expand","block",4,"ngIf"],["trigger","searchClubPresets",4,"ngIf"],[3,"ngSubmit","keyup.enter"],["color","primary"],["src","assets/imgs/verein.png"],["placeholder","Vereinsname","autocomplete","true","type","text","name","vereinname","required","",3,"readonly","autofocus","disabled","ngModel"],["placeholder","Verband","autocomplete","true","type","text","name","verband","required","",3,"readonly","disabled","ngModel"],["src","assets/imgs/chief.png"],["placeholder","Vorname","type","text","autocomplete","given-name","name","respVorname","required","",3,"readonly","disabled","ngModel"],["placeholder","Nachname","type","text","autocomplete","name","name","respName","required","",3,"readonly","disabled","ngModel"],["src","assets/imgs/atmail.png"],["placeholder","Mail","type","email","autocomplete","email","pattern","^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)*(\\.[a-z]{2,5})$","name","mail","required","",3,"readonly","disabled","ngModel"],["placeholder","Mobile/SMS (+4179...)","type","tel","autocomplete","on","pattern","[+]{1}[0-9]{11,14}","name","mobilephone","required","",3,"readonly","disabled","ngModel"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["slot","start","name","save"],[4,"ngFor","ngForOf"],["id","searchClubPresets","size","large","expand","block"],["name","search-outline","ios","md-search-outline"],["trigger","searchClubPresets"],["title","Vorbelegen mit",1,"ion-page",3,"selectionChange","selectionCancel","items","selectedItem"],["src","assets/imgs/password.png"],["placeholder","Passwort","type","password","name","secret","required","",3,"readonly","disabled","ngModel"],["placeholder","Passwort best\xE4tigen","type","password","name","verification","required","",3,"readonly","disabled","ngModel"],["placeholder","Passwort","type","password","name","secret",3,"ngModelChange","readonly","disabled","ngModel"],["placeholder","Passwort best\xE4tigen","type","password","name","verification",3,"ngModelChange","readonly","disabled","ngModel"],["size","small","color","danger",3,"click","disabled"]],template:function(t,i){t&1&&(o(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",4),d(3,"ion-back-button",5),r(),o(4,"ion-title"),m(5,"Vereins-Registrierung"),r(),o(6,"ion-note",6)(7,"div",7),m(8),r()()()(),b(9,Ee,38,27,"ion-content",8),o(10,"ion-footer")(11,"ion-toolbar")(12,"ion-button",9),C("click",function(){return i.presentActionSheet()}),d(13,"ion-icon",10),m(14,"Anmeldungen... "),r()()()),t&2&&(a(8),w("f\xFCr ",i.wettkampf,""),a(),l("ngIf",i.registration),a(3),l("disabled",i.waiting||i.regId===0))},dependencies:[R,N,q,z,B,U,H,j,O,J,Y,$,G,Z,Q,X,ee,te,ie,ne,re,oe,ae,le,L,se,he],encapsulation:2})}return n})();var Pe=[{path:"",component:_e}],De=(()=>{class n{static \u0275fac=function(t){return new(t||n)};static \u0275mod=M({type:n});static \u0275inj=P({imports:[T,K,me,F.forChild(Pe),ue]})}return n})();export{De as ClubregEditorPageModule};
