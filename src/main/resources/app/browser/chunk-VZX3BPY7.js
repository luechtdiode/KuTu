import{f as ce,h as me}from"./chunk-5JK2MF46.js";import{a as ue}from"./chunk-74DM2BCI.js";import{Aa as q,B as s,Ba as H,Bb as ge,C as l,D as w,Da as Z,E as v,G as S,H as m,Ja as G,K as _,Ka as J,L as I,M as C,N as p,Na as X,O as c,P as y,Q as O,Qa as Y,Ra as $,Sa as ee,T as E,Ta as te,U as N,V as W,Za as ie,ab as ne,ca as j,ga as U,kb as re,lb as oe,m as P,ma as z,nb as se,o as h,p as f,qa as F,r as V,rb as ae,sa as R,t as d,ta as B,tb as le,u as g,ua as Q,ub as de,v as T,va as L,w as D,wa as A,x,z as a,za as K,zb as M}from"./chunk-KMY4ZES7.js";import"./chunk-6IQPZO6F.js";import"./chunk-JSAAGAZE.js";import"./chunk-5XVA5RR2.js";import"./chunk-LOHYXAXQ.js";import"./chunk-P5VFIEEE.js";import"./chunk-HC6MZPB3.js";import"./chunk-J5OMF6R4.js";import"./chunk-KWW2H4SN.js";import"./chunk-7HA5TF5T.js";import"./chunk-ZOBGMWXG.js";import"./chunk-426OJ4HC.js";import"./chunk-RPQZFOYD.js";import"./chunk-GIGBYVJT.js";import"./chunk-MM5QLNJM.js";import"./chunk-H3GX5QFY.js";import"./chunk-7D6K5XYM.js";import"./chunk-OBXDPQ3V.js";import"./chunk-G2DZN4YG.js";import"./chunk-MCRJI3T3.js";import"./chunk-TI7J2N3O.js";import"./chunk-TTFYQ64X.js";import{g as k}from"./chunk-2R6CW7ES.js";var ve=["wertungsform"],_e=["enote"],Ie=["dnote"];function Ce(r,b){if(r&1){let e=v();s(0,"app-wertung-avg-calc",17,3),W("ngModelChange",function(t){h(e);let n=m();return N(n.wertung.noteD,t)||(n.wertung.noteD=t),f(t)}),l()}if(r&2){let e=m();a("waiting",e.waiting)("valueTitle",e.dNoteLabel),E("ngModel",e.wertung.noteD),a("disabled",!e.editable())}}function ye(r,b){r&1&&(s(0,"ion-item"),c(1," Ung\xFCltige Eingabe. Die Werte m\xFCssen im Format ##.## (2-3 Nachkommastellen mit Dezimalpunkt) eingegeben werden. "),l())}function ke(r,b){if(r&1&&(s(0,"ion-item"),c(1),l()),r&2){let e=m();d(),O(" An diesem Ger\xE4t macht ",e.item.vorname+" "+e.item.name," Pause. Es k\xF6nnen keine Resultate erfasst werden. ")}}function xe(r,b){if(r&1&&(s(0,"ion-button",18,4),w(2,"ion-icon",19),c(3,"Speichern & Weiter"),l()),r&2){let e=m(),i=p(13);a("disabled",e.waiting||!i.valid)}}function Se(r,b){if(r&1){let e=v();s(0,"ion-button",20),S("click",function(){h(e);let t=m(),n=p(13);return f(t.saveClose(n))}),w(1,"ion-icon",21),c(2,"Speichern"),l()}if(r&2){let e=m(),i=p(13);a("disabled",e.waiting||!i.valid)}}var pe=(()=>{class r{navCtrl;route;alertCtrl;toastController;backendService;platform;zone;constructor(e,i,t,n,o,u,he){this.navCtrl=e,this.route=i,this.alertCtrl=t,this.toastController=n,this.backendService=o,this.platform=u,this.zone=he,this.durchgang=o.durchgang,this.step=o.step,this.geraetId=o.geraet;let fe=parseInt(this.route.snapshot.paramMap.get("itemId"));this.updateUI(o.wertungen.find(we=>we.id===fe))}itemOriginal;form;enote;dnote;subscription;item;wertung;geraetId;step;durchgang;waiting=!1;isDNoteUsed=!0;get dNoteLabel(){return this.item.isDNoteUsed&&M.indexOf(this.item.programm)>-1?"A-Note":"D-Note"}get eNoteLabel(){return this.item.isDNoteUsed&&M.indexOf(this.item.programm)>-1?"B-Note":"E-Note"}ionViewWillLeave(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0)}ionViewWillEnter(){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.subscription=this.backendService.wertungUpdated.subscribe(e=>{console.log("incoming wertung from service",e),e.wertung.athletId===this.wertung.athletId&&e.wertung.wettkampfdisziplinId===this.wertung.wettkampfdisziplinId&&e.wertung.endnote!==this.wertung.endnote&&(console.log("updateing wertung from service"),this.item.wertung=Object.assign({},e.wertung),this.itemOriginal.wertung=Object.assign({},e.wertung),this.wertung=Object.assign({noteD:0,noteE:0,endnote:0},this.item.wertung))}),this.platform.ready().then(()=>{setTimeout(()=>{let e;ue.getPlatform()!=="web"&&e.show&&(e.show(),console.log("keyboard called")),this.isDNoteUsed&&this.dnote?(this.dnote.setFocus(),console.log("dnote focused")):this.enote&&(this.enote.setFocus(),console.log("enote focused"))},400)})}editable(){return this.backendService.loggedIn&&this.wertung.wettkampfdisziplinId>0}updateUI(e){this.zone.run(()=>{this.waiting=!1,this.item=Object.assign({},e),this.isDNoteUsed=this.item.isDNoteUsed,this.itemOriginal=Object.assign({},e),this.wertung=Object.assign({noteD:0,noteE:0,endnote:0},this.itemOriginal.wertung),this.ionViewWillEnter()})}ensureInitialValues(e){return Object.assign(this.wertung,e)}saveClose(e){e.valid&&(this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe({next:i=>{this.updateUI(i),this.navCtrl.pop()},error:i=>{this.waiting=!1,console.log(i)}}))}save(e){e.valid&&(this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe({next:i=>{this.updateUI(i)},error:i=>{this.waiting=!1,console.log(i)}}))}saveNext(e){e.valid&&(this.waiting=!0,this.backendService.updateWertung(this.durchgang,this.step,this.geraetId,this.ensureInitialValues(e.value)).subscribe({next:i=>{this.waiting=!1;let t=this.backendService.wertungen.findIndex(o=>o.wertung.id===i.wertung.id);t<0&&console.log("unexpected wertung - id matches not with current wertung: "+i.wertung.id);let n=t+1;if(t<0)n=0;else if(t>=this.backendService.wertungen.length-1)if(this.backendService.wertungen.filter(o=>o.wertung.endnote===void 0).length===0){this.navCtrl.pop(),this.toastSuggestCompletnessCheck();return}else n=this.backendService.wertungen.findIndex(o=>o.wertung.endnote===void 0),this.toastMissingResult(e,this.backendService.wertungen[n].vorname+" "+this.backendService.wertungen[n].name);e.resetForm(),this.updateUI(this.backendService.wertungen[n])},error:i=>{this.waiting=!1,console.log(i)}}))}nextEmptyOrFinish(e){let i=this.backendService.wertungen.findIndex(t=>t.wertung.id===this.wertung.id);if(this.backendService.wertungen.filter((t,n)=>n>i&&t.wertung.endnote===void 0).length===0){this.navCtrl.pop(),this.toastSuggestCompletnessCheck();return}else{let t=this.backendService.wertungen.findIndex((n,o)=>o>i&&n.wertung.endnote===void 0);this.toastMissingResult(e,this.backendService.wertungen[t].vorname+" "+this.backendService.wertungen[t].name),e.resetForm(),this.updateUI(this.backendService.wertungen[t])}}geraetName(){return this.backendService.geraete?this.backendService.geraete.find(e=>e.id===this.geraetId).name:""}toastSuggestCompletnessCheck(){return k(this,null,function*(){(yield this.toastController.create({header:"Qualit\xE4tskontrolle",message:"Es sind jetzt alle Resultate erfasst. Bitte ZU ZWEIT die Resultate pr\xFCfen und abschliessen!",animated:!0,position:"middle",buttons:[{text:"OK, gelesen.",icon:"checkmark-circle",role:"cancel",handler:()=>{console.log("OK, gelesen. clicked")}}]})).present()})}toastMissingResult(e,i){return k(this,null,function*(){(yield this.alertCtrl.create({header:"Achtung",subHeader:"Fehlendes Resultat!",message:"Nach der Erfassung der letzten Wertung in dieser Riege scheint es noch leere Wertungen zu geben. Bitte pr\xFCfen, ob "+i.toUpperCase()+" geturnt hat.",buttons:[{text:"Nicht geturnt",role:"edit",handler:()=>{this.nextEmptyOrFinish(e)}},{text:"Korrigieren",role:"cancel",handler:()=>{console.log("Korrigieren clicked")}}]})).present()})}static \u0275fac=function(i){return new(i||r)(g(H),g(z),g(ae),g(le),g(ge),g(q),g(V))};static \u0275cmp=T({type:r,selectors:[["app-wertung-editor"]],viewQuery:function(i,t){if(i&1&&(_(ve,5),_(_e,5),_(Ie,5)),i&2){let n;I(n=C())&&(t.form=n.first),I(n=C())&&(t.enote=n.first),I(n=C())&&(t.dnote=n.first)}},standalone:!1,decls:26,vars:14,consts:[["wertungsform","ngForm"],["enote",""],["endnote",""],["dnote",""],["btnSaveNext",""],["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[1,"riege"],[3,"ngSubmit","keyup.enter"],["name","noteD",3,"waiting","valueTitle","ngModel","disabled","ngModelChange",4,"ngIf"],["name","noteE",3,"ngModelChange","waiting","valueTitle","ngModel","disabled"],["label","Endnote","type","number","readonly","","name","endnote",3,"ngModel","disabled"],[4,"ngIf"],["size","large","expand","block","type","submit","color","success",3,"disabled",4,"ngIf"],["size","large","expand","block","color","secondary",3,"disabled","click",4,"ngIf"],["name","noteD",3,"ngModelChange","waiting","valueTitle","ngModel","disabled"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["slot","start","name","arrow-forward-circle-outline"],["size","large","expand","block","color","secondary",3,"click","disabled"],["slot","start","name","checkmark-circle"]],template:function(i,t){if(i&1){let n=v();s(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",5),w(3,"ion-back-button",6),l(),s(4,"ion-title"),c(5),l(),s(6,"ion-note",7)(7,"div",8),c(8),l(),s(9,"div",9),c(10),l()()()(),s(11,"ion-content")(12,"form",10,0),S("ngSubmit",function(){h(n);let u=p(13);return f(t.saveNext(u))})("keyup.enter",function(){h(n);let u=p(13);return f(t.saveNext(u))}),s(14,"ion-list"),x(15,Ce,2,4,"app-wertung-avg-calc",11),s(16,"app-wertung-avg-calc",12,1),W("ngModelChange",function(u){return h(n),N(t.wertung.noteE,u)||(t.wertung.noteE=u),f(u)}),l(),s(18,"ion-item"),w(19,"ion-input",13,2),l()(),s(21,"ion-list"),x(22,ye,2,0,"ion-item",14)(23,ke,2,1,"ion-item",14)(24,xe,4,1,"ion-button",15)(25,Se,3,1,"ion-button",16),l()()()}if(i&2){let n=p(13);d(5),y(t.geraetName()),d(3),y(t.item.vorname+" "+t.item.name),d(2),y(t.wertung.riege),d(5),a("ngIf",t.isDNoteUsed),d(),a("waiting",t.waiting)("valueTitle",t.eNoteLabel),E("ngModel",t.wertung.noteE),a("disabled",!t.editable()),d(3),a("ngModel",t.wertung.endnote)("disabled",!t.editable()),d(3),a("ngIf",!n.valid&&t.editable()),d(),a("ngIf",!t.editable()),d(),a("ngIf",t.editable()),d(),a("ngIf",t.editable())}},dependencies:[j,A,R,B,L,Q,G,J,X,Y,$,ee,te,ie,ne,re,oe,Z,se,ce],styles:[".riege[_ngcontent-%COMP%]{font-size:small;padding-right:16px;color:var(--ion-color-medium)}.athlet[_ngcontent-%COMP%]{font-size:larger;padding-right:16px;font-weight:bolder;color:var(--ion-color-primary)}"]})}return r})();var Ee=[{path:"",component:pe}],Ae=(()=>{class r{static \u0275fac=function(i){return new(i||r)};static \u0275mod=D({type:r});static \u0275inj=P({imports:[U,K,de,F.forChild(Ee),me]})}return r})();export{Ae as WertungEditorPageModule};
