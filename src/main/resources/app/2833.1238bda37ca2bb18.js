"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2833],{2833:(D,_,c)=>{c.r(_),c.d(_,{RegAthletEditorPageModule:()=>S});var m=c(2200),h=c(4341),p=c(8132),s=c(9893),o=c(2615),e=c(3664),b=c(5035),f=c(1266),k=c(2350),u=c(8103);function I(a,d){1&a&&(e.j41(0,"ion-label"),e.EFF(1," Athlet / Athletin "),e.k0s())}function R(a,d){if(1&a&&(e.j41(0,"ion-select-option",16)(1,"ion-avatar",5),e.nrm(2,"img",10),e.k0s(),e.j41(3,"ion-label"),e.EFF(4),e.nrm(5,"br"),e.j41(6,"small"),e.EFF(7),e.nI1(8,"date"),e.k0s()()()),2&a){const t=d.$implicit;e.Y8G("value",t.athletId),e.R7$(4),e.E5c("",t.name,", ",t.vorname," (",t.geschlecht,")"),e.R7$(3),e.SpI(" (",e.bMT(8,5,t.gebdat),")")}}function A(a,d){if(1&a){const t=e.RV6();e.j41(0,"ion-select",23),e.mxI("ngModelChange",function(n){o.eBV(t);const r=e.XpG(2);return e.DH7(r.selectedClubAthletId,n)||(r.selectedClubAthletId=n),o.Njj(n)}),e.DNE(1,R,9,7,"ion-select-option",24),e.k0s()}if(2&a){const t=e.XpG(2);e.R50("ngModel",t.selectedClubAthletId),e.R7$(),e.Y8G("ngForOf",t.clubAthletList)}}function v(a,d){1&a&&(e.j41(0,"ion-item-divider")(1,"ion-avatar",3),e.nrm(2,"img",25),e.k0s(),e.j41(3,"ion-label"),e.EFF(4,"Einteilung"),e.k0s()())}function F(a,d){if(1&a&&(e.j41(0,"ion-select-option",16),e.EFF(1),e.k0s()),2&a){const t=d.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function j(a,d){if(1&a){const t=e.RV6();e.j41(0,"ion-item"),e.nrm(1,"ion-avatar",3),e.j41(2,"ion-select",26),e.mxI("ngModelChange",function(n){o.eBV(t);const r=e.XpG(2);return e.DH7(r.registration.programId,n)||(r.registration.programId=n),o.Njj(n)}),e.DNE(3,F,2,2,"ion-select-option",24),e.k0s()()}if(2&a){const t=e.XpG(2);e.R7$(2),e.R50("ngModel",t.registration.programId),e.R7$(),e.Y8G("ngForOf",t.filterPGMsForAthlet(t.registration))}}function C(a,d){if(1&a&&(e.j41(0,"ion-row"),e.EFF(1),e.k0s()),2&a){const t=d.$implicit;e.R7$(),e.SpI("f\xfcr ",t)}}function E(a,d){if(1&a&&(e.j41(0,"ion-select-option",16),e.EFF(1),e.k0s()),2&a){const t=d.$implicit,i=e.XpG(3);e.Y8G("value",t.index),e.R7$(),e.JRh(i.mapTeam(t.index))}}function w(a,d){if(1&a){const t=e.RV6();e.j41(0,"ion-item-divider")(1,"ion-avatar",3),e.nrm(2,"img",27),e.k0s(),e.j41(3,"ion-label"),e.EFF(4,"Team-/Mannschaftszuweisung"),e.k0s()(),e.j41(5,"ion-item"),e.nrm(6,"ion-avatar",3),e.j41(7,"ion-grid",28),e.DNE(8,C,2,1,"ion-row",29),e.j41(9,"ion-row")(10,"ion-select",30),e.mxI("ngModelChange",function(n){o.eBV(t);const r=e.XpG(2);return e.DH7(r.registration.team,n)||(r.registration.team=n),o.Njj(n)}),e.j41(11,"ion-select-option",16),e.EFF(12,"Keine Teamzuordnung"),e.k0s(),e.DNE(13,E,2,2,"ion-select-option",24),e.k0s()()()()}if(2&a){const t=e.XpG(2);e.R7$(8),e.Y8G("ngForOf",t.teamrules),e.R7$(2),e.R50("ngModel",t.registration.team),e.R7$(),e.Y8G("value",0),e.R7$(2),e.Y8G("ngForOf",t.teams)}}function M(a,d){if(1&a){const t=e.RV6();e.j41(0,"ion-label"),e.EFF(1),e.k0s(),e.j41(2,"ion-button",31),e.bIt("click",function(){o.eBV(t);const n=e.XpG(2);return o.Njj(n.onFileChange(null))}),e.EFF(3,"Zum anh\xf6ren laden"),e.k0s()}if(2&a){const t=e.XpG(2);e.R7$(),e.SpI("Aktuelle Datei: ",null==t.registration.mediafile?null:t.registration.mediafile.name)}}function x(a,d){1&a&&(e.j41(0,"ion-label"),e.EFF(1,"Keine Datei ausgew\xe4hlt"),e.k0s())}function G(a,d){if(1&a){const t=e.RV6();e.j41(0,"ion-content")(1,"form",9,0),e.bIt("ngSubmit",function(){o.eBV(t);const n=e.sdS(2),r=e.XpG();return o.Njj(r.save(n))})("keyup.enter",function(){o.eBV(t);const n=e.sdS(2),r=e.XpG();return o.Njj(r.save(n))}),e.j41(3,"ion-list")(4,"ion-item-divider")(5,"ion-avatar",3),e.nrm(6,"img",10),e.k0s(),e.DNE(7,I,2,0,"ion-label",7)(8,A,2,2,"ion-select",11),e.k0s(),e.j41(9,"ion-item"),e.nrm(10,"ion-avatar",3),e.j41(11,"ion-input",12),e.mxI("ngModelChange",function(n){o.eBV(t);const r=e.XpG();return e.DH7(r.registration.name,n)||(r.registration.name=n),o.Njj(n)}),e.k0s()(),e.j41(12,"ion-item"),e.nrm(13,"ion-avatar",3),e.j41(14,"ion-input",13),e.mxI("ngModelChange",function(n){o.eBV(t);const r=e.XpG();return e.DH7(r.registration.vorname,n)||(r.registration.vorname=n),o.Njj(n)}),e.k0s()(),e.j41(15,"ion-item"),e.nrm(16,"ion-avatar",3),e.j41(17,"ion-input",14),e.mxI("ngModelChange",function(n){o.eBV(t);const r=e.XpG();return e.DH7(r.registration.gebdat,n)||(r.registration.gebdat=n),o.Njj(n)}),e.k0s()(),e.j41(18,"ion-item"),e.nrm(19,"ion-avatar",3),e.j41(20,"ion-select",15),e.mxI("ngModelChange",function(n){o.eBV(t);const r=e.XpG();return e.DH7(r.registration.geschlecht,n)||(r.registration.geschlecht=n),o.Njj(n)}),e.j41(21,"ion-select-option",16),e.EFF(22,"weiblich"),e.k0s(),e.j41(23,"ion-select-option",16),e.EFF(24,"m\xe4nnlich"),e.k0s()()(),e.DNE(25,v,5,0,"ion-item-divider",7)(26,j,4,2,"ion-item",7),e.nVh(27,w,14,4),e.j41(28,"ion-item-divider")(29,"ion-avatar",3),e.nrm(30,"img",17),e.k0s(),e.j41(31,"ion-label"),e.EFF(32,"Bodenmusik (optional)"),e.k0s()(),e.j41(33,"ion-item"),e.nrm(34,"ion-avatar",3),e.j41(35,"ion-label"),e.EFF(36,"Neu hochladen"),e.k0s(),e.j41(37,"input",18),e.bIt("change",function(n){o.eBV(t);const r=e.XpG();return o.Njj(r.onFileChange(n))}),e.k0s()(),e.j41(38,"ion-item"),e.nrm(39,"ion-avatar",3),e.nVh(40,M,4,1)(41,x,2,0,"ion-label"),e.k0s(),e.j41(42,"ion-item")(43,"audio",19),e.nrm(44,"source",20),e.k0s()()(),e.j41(45,"ion-list")(46,"ion-button",21,1),e.nrm(48,"ion-icon",22),e.EFF(49,"Speichern"),e.k0s()()()()}if(2&a){const t=e.sdS(2),i=e.XpG();e.R7$(7),e.Y8G("ngIf",i.registration.id>0),e.R7$(),e.Y8G("ngIf",0===i.registration.id&&i.clubAthletList.length>0),e.R7$(3),e.Y8G("disabled",!1),e.R50("ngModel",i.registration.name),e.R7$(3),e.Y8G("disabled",!1),e.R50("ngModel",i.registration.vorname),e.R7$(3),e.Y8G("disabled",!1),e.R50("ngModel",i.registration.gebdat),e.R7$(3),e.R50("ngModel",i.registration.geschlecht),e.R7$(),e.Y8G("value","W"),e.R7$(2),e.Y8G("value","M"),e.R7$(2),e.Y8G("ngIf",i.needsPGMChoice()),e.R7$(),e.Y8G("ngIf",i.needsPGMChoice()),e.R7$(),e.vxM(i.teamsAllowed()?27:-1),e.R7$(13),e.vxM(null!=i.registration.mediafile&&i.registration.mediafile.name?40:41),e.R7$(4),e.BMQ("src",i.mediaSource,e.B4B),e.R7$(2),e.Y8G("disabled",i.waiting||!i.isFormValid()||!t.valid||t.untouched)}}function P(a,d){if(1&a){const t=e.RV6();e.j41(0,"ion-button",32,2),e.bIt("click",function(){o.eBV(t);const n=e.XpG();return o.Njj(n.delete())}),e.nrm(2,"ion-icon",33),e.EFF(3,"Anmeldung l\xf6schen"),e.k0s()}if(2&a){const t=e.XpG();e.Y8G("disabled",t.waiting)}}const T=[{path:"",component:(()=>{class a{navCtrl=(0,o.WQX)(b.q9);route=(0,o.WQX)(f.nX);backendService=(0,o.WQX)(k.m);alertCtrl=(0,o.WQX)(s.hG);zone=(0,o.WQX)(e.SKi);constructor(){}waiting=!1;registration;wettkampf;wettkampfFull;regId;athletId;wkId;wkPgms;teams;wettkampfId;clubAthletList;clubAthletListCurrent;_selectedClubAthletId;ngOnInit(){this.waiting=!0,this.wkId=this.route.snapshot.paramMap.get("wkId"),this.regId=parseInt(this.route.snapshot.paramMap.get("regId")),this.athletId=parseInt(this.route.snapshot.paramMap.get("athletId")),this.backendService.getCompetitions().subscribe(t=>{const i=t.find(n=>n.uuid===this.wkId);this.wettkampfId=parseInt(i.id),this.backendService.loadProgramsForCompetition(i.uuid).subscribe(n=>{this.wkPgms=n,this.backendService.loadTeamsListForClub(this.wkId,this.regId).subscribe(r=>{this.teams=r.filter(l=>l.name?.trim().length>0),this.backendService.loadAthletListForClub(this.wkId,this.regId).subscribe(l=>{this.clubAthletList=l,this.backendService.loadAthletRegistrations(this.wkId,this.regId).subscribe(g=>{this.clubAthletListCurrent=g,this.updateUI(this.athletId?g.find(N=>N.id===this.athletId):{id:0,vereinregistrationId:this.regId,name:"",vorname:"",geschlecht:"W",gebdat:void 0,programId:void 0,team:0,registrationTime:0})})})})})})}get selectedClubAthletId(){return this._selectedClubAthletId}set selectedClubAthletId(t){this._selectedClubAthletId=t,this.registration=this.clubAthletList.find(i=>i.athletId===t)}get teamrules(){return(this.wettkampfFull.teamrule||"").split(",")}needsPGMChoice(){const t=[...this.wkPgms][0];return!(1==t.aggregate&&t.riegenmode>1)}alter(t){if(this.wettkampfFull.altersklassen?.trim().length>0){let i=Math.abs(new Date(this.wettkampfFull.datum).getTime()-new Date(t.gebdat).getTime());return Math.floor(i/864e5/365+.25)}{const i=new Date((0,u.HN)(t.gebdat)).getFullYear();return new Date(this.wettkampfFull.datum).getFullYear()-i}}similarRegistration(t,i){return t.athletId>0&&i.athletId>0&&t.athletId===i.athletId||t.name===i.name&&t.vorname===i.vorname&&t.gebdat===i.gebdat&&t.geschlecht===i.geschlecht}alternatives(t){return this.clubAthletListCurrent?.filter(i=>this.similarRegistration(i,t)&&i.id!=t.id)||[]}getAthletPgm(t){return this.wkPgms.find(i=>i.id===t.programId)||Object.assign({parent:0})}filterPGMsForAthlet(t){const i=this.alter(t),n=this.alternatives(t);return this.wkPgms.filter(r=>(r.alterVon||0)<=i&&(r.alterBis||100)>=i&&0===n.filter(l=>l.programId===r.id||this.getAthletPgm(l).parentId===r.parentId).length)}teamsAllowed(){return this.wettkampfFull.teamrule?.length>0&&"Keine Teams"!==this.wettkampfFull.teamrule}mapTeam(t){return[...this.teams.filter(i=>i.index==t).map(i=>i.index>0?i.name+" "+i.index:i.name),""][0]}editable(){return this.backendService.loggedIn}updateUI(t){this.zone.run(()=>{this.waiting=!1,this.wettkampf=this.backendService.competitionName,this.wettkampfFull=this.backendService.currentCompetition(),this.registration=Object.assign({},t),this.registration.gebdat=(0,u.HN)(this.registration.gebdat),this.registration.team||(this.registration.team=0)})}isFormValid(){return!this.registration?.programId&&!this.needsPGMChoice()&&(this.registration.programId=this.filterPGMsForAthlet(this.registration)[0]?.id),!!this.registration.gebdat&&!!this.registration.geschlecht&&this.registration.geschlecht.length>0&&!!this.registration.name&&this.registration.name.length>0&&!!this.registration.vorname&&this.registration.vorname.length>0&&!!this.registration.programId&&this.registration.programId>0&&(!this.teamsAllowed()||(!!this.registration.team||0===this.registration.team)&&!isNaN(this.registration.team))}checkPersonOverride(t){if(t.athletId){const i=[...this.clubAthletListCurrent,...this.clubAthletList].find(n=>n.athletId===t.athletId);if(i.geschlecht!==t.geschlecht||new Date((0,u.HN)(i.gebdat)).toJSON()!==new Date((0,u.HN)(t.gebdat)).toJSON()||i.name!==t.name||i.vorname!==t.vorname)return!0}return!1}mediaSource;onFileChange(t){if(t){const i=t?.target?.files[0];let n=new FormData;n.append("mediafile",i,i.name),this.backendService.uploadFile(this.wkId,this.regId,this.registration.id,n).subscribe(r=>{console.log("File upload finished: response:",r),this.registration.mediafile=r.mediafile,this.backendService.downloadFile(this.wkId,this.regId,this.registration.id).subscribe(l=>{this.mediaSource=URL.createObjectURL(l);const g=document.querySelector("#myAudio");g.src=URL.createObjectURL(l),g.load()})})}else this.backendService.downloadFile(this.wkId,this.regId,this.registration.id).subscribe(i=>{this.mediaSource=URL.createObjectURL(i);const n=document.querySelector("#myAudio");n.src=URL.createObjectURL(i),n.load()})}save(t){if(!t.valid)return;const i=Object.assign({},this.registration,{gebdat:new Date(t.value.gebdat).toJSON(),team:t.value.team?t.value.team:0,athletId:this.registration.athletId>0?this.registration.athletId:0});0===this.athletId||0===i.id?(this.needsPGMChoice()||this.filterPGMsForAthlet(this.registration).filter(n=>n.id!==i.programId).forEach(n=>{this.backendService.createAthletRegistration(this.wkId,this.regId,Object.assign({},i,{programId:n.id}))}),this.backendService.createAthletRegistration(this.wkId,this.regId,i).subscribe(()=>{this.navCtrl.pop()})):this.checkPersonOverride(i)?this.alertCtrl.create({header:"Achtung",subHeader:"Person \xfcberschreiben vs korrigieren",message:"Es wurden \xc4nderungen an den Personen-Feldern vorgenommen. Diese sind ausschliesslich f\xfcr Korrekturen zul\xe4ssig. Die Identit\xe4t der Person darf dadurch nicht ge\xe4ndert werden!",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"Korektur durchf\xfchren",handler:()=>{this.backendService.saveAthletRegistration(this.wkId,this.regId,i).subscribe(()=>{this.clubAthletListCurrent.filter(l=>this.similarRegistration(this.registration,l)).filter(l=>l.id!==this.registration.id).forEach(l=>{const g=Object.assign({},i,{id:l.id,registrationTime:l.registrationTime,programId:l.programId});this.backendService.saveAthletRegistration(this.wkId,this.regId,g)}),this.navCtrl.pop()})}}]}).then(l=>l.present()):this.backendService.saveAthletRegistration(this.wkId,this.regId,i).subscribe(()=>{this.navCtrl.pop()})}delete(){this.alertCtrl.create({header:"Achtung",subHeader:"L\xf6schen der Athlet-Anmeldung am Wettkampf",message:"Hiermit wird die Anmeldung von "+this.registration.name+", "+this.registration.vorname+" am Wettkampf gel\xf6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.needsPGMChoice()||this.clubAthletListCurrent.filter(i=>this.similarRegistration(this.registration,i)).filter(i=>i.id!==this.registration.id).forEach(i=>{this.backendService.deleteAthletRegistration(this.wkId,this.regId,i)}),this.backendService.deleteAthletRegistration(this.wkId,this.regId,this.registration).subscribe(()=>{this.navCtrl.pop()})}}]}).then(i=>i.present())}static \u0275fac=function(i){return new(i||a)};static \u0275cmp=e.VBU({type:a,selectors:[["app-reg-athlet-editor"]],standalone:!1,decls:14,vars:3,consts:[["athletRegistrationForm","ngForm"],["btnSaveNext",""],["btnDelete",""],["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[4,"ngIf"],["size","large","expand","block","color","danger",3,"disabled","click",4,"ngIf"],[3,"ngSubmit","keyup.enter"],["src","assets/imgs/athlete.png"],["label","Athlet / Athletin","placeholder","Auswahl aus Liste","name","clubAthletid","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["label","Name","required","","placeholder","Name","type","text","name","name","required","",3,"ngModelChange","disabled","ngModel"],["label","Vorname","required","","placeholder","Vorname","type","text","name","vorname","required","",3,"ngModelChange","disabled","ngModel"],["label","Geburtsdatum","required","","placeholder","Geburtsdatum","type","date","display-timezone","utc","name","gebdat","required","",3,"ngModelChange","disabled","ngModel"],["label","Geschlecht","required","","placeholder","bitte ausw\xe4hlen","name","geschlecht","okText","Okay","cancelText","Abbrechen","required","",3,"ngModelChange","ngModel"],[3,"value"],["src","assets/imgs/boden.svg"],["type","file",3,"change"],["controls","","id","myAudio"],["type","audio/mp3"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["slot","start","name",""],["label","Athlet / Athletin","placeholder","Auswahl aus Liste","name","clubAthletid","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],["src","assets/imgs/wettkampf.png"],["label","Programm/Kategorie","required","","placeholder","bitte ausw\xe4hlen","name","programId","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["src","assets/imgs/verein.png"],["no-padding",""],[4,"ngFor","ngForOf"],["label","Team","placeholder","Team","name","team","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"click"],["size","large","expand","block","color","danger",3,"click","disabled"],["slot","start","name","trash"]],template:function(i,n){1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",3),e.nrm(3,"ion-back-button",4),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Anmeldung Athlet/Athletin"),e.k0s(),e.j41(6,"ion-note",5)(7,"div",6),e.EFF(8),e.k0s()()()(),e.DNE(9,G,50,17,"ion-content",7),e.j41(10,"ion-footer")(11,"ion-toolbar")(12,"ion-list"),e.DNE(13,P,4,1,"ion-button",8),e.k0s()()()),2&i&&(e.R7$(8),e.SpI("f\xfcr ",n.wettkampf),e.R7$(),e.Y8G("ngIf",n.registration),e.R7$(4),e.Y8G("ngIf",n.athletId>0))},dependencies:[m.Sq,m.bT,h.qT,h.BC,h.cb,h.YS,h.vS,h.cV,s.mC,s.Jm,s.QW,s.W9,s.M0,s.lO,s.eU,s.iq,s.$w,s.uz,s.Dg,s.he,s.nf,s.JI,s.ln,s.Nm,s.Ip,s.BC,s.ai,s.Je,s.Gw,s.el,m.vh],styles:[".teamlabel[_ngcontent-%COMP%]{padding-top:10p}"]})}return a})()}];let S=(()=>{class a{static \u0275fac=function(i){return new(i||a)};static \u0275mod=e.$C({type:a});static \u0275inj=o.G2t({imports:[m.MD,h.YN,s.bv,p.iI.forChild(T)]})}return a})()}}]);