"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[170],{170:(E,u,l)=>{l.r(u),l.d(u,{RegAthletlistPageModule:()=>B});var g=l(6895),d=l(433),m=l(5472),o=l(502),f=l(1135),A=l(7579),v=l(9646),p=l(5698),_=l(9300),b=l(4004),x=l(8372),I=l(1884),R=l(8505),T=l(3900),Z=l(3099),t=l(8274),C=l(600);function k(n,a){if(1&n&&(t.TgZ(0,"ion-col")(1,"small"),t._uU(2),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(e.getTeamText())}}let y=(()=>{class n{constructor(){this.selected=new t.vpe}statusBadgeColor(){return"in sync"===this.status?"success":"warning"}statusComment(){return"in sync"===this.status?"":this.status.substring(this.status.indexOf("(")+1,this.status.length-1)}statusBadgeText(){return"in sync"===this.status?"\u2714 "+this.status:"\u2757 "+this.status.substring(0,this.status.indexOf("(")-1)}ngOnInit(){}getProgrammText(){const e=this.programmlist.find(i=>i.id===this.athletregistration.programId);return e?e.name:"..."}getTeamText(){const i=this.vereinregistration;if(this.athletregistration.team>0){const r=this.getProgrammText();return"Team "+i.vereinname+" "+this.athletregistration.team+" (bei "+this.athletregistration.geschlecht+"/"+r+")"}return""}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-reg-athlet-item"]],inputs:{athletregistration:"athletregistration",vereinregistration:"vereinregistration",status:"status",programmlist:"programmlist"},outputs:{selected:"selected"},decls:19,vars:10,consts:[[3,"click"],["slot","start"],["src","assets/imgs/athlete.png"],["no-padding",""],[4,"ngIf"],["slot","end",3,"color"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-item",0),t.NdJ("click",function(){return i.selected?i.selected.emit(i.athletregistration):{}}),t.TgZ(1,"ion-avatar",1),t._UZ(2,"img",2),t.qZA(),t.TgZ(3,"ion-grid",3)(4,"ion-row")(5,"ion-col")(6,"ion-label"),t._uU(7),t._UZ(8,"br"),t.TgZ(9,"small"),t._uU(10),t.ALo(11,"date"),t.qZA()()()(),t.TgZ(12,"ion-row"),t.YNc(13,k,3,1,"ion-col",4),t.qZA()(),t.TgZ(14,"ion-badge",5),t._uU(15),t._UZ(16,"br"),t.TgZ(17,"small"),t._uU(18),t.qZA()()()),2&e&&(t.xp6(7),t.lnq("",i.athletregistration.name,", ",i.athletregistration.vorname," (",i.athletregistration.geschlecht,")"),t.xp6(3),t.hij("(",t.lcZ(11,8,i.athletregistration.gebdat),")"),t.xp6(3),t.Q6J("ngIf",i.athletregistration.team>0),t.xp6(1),t.Q6J("color",i.statusBadgeColor()),t.xp6(1),t.Oqu(i.statusBadgeText()),t.xp6(3),t.Oqu(i.statusComment()))},dependencies:[g.O5,o.BJ,o.yp,o.wI,o.jY,o.Ie,o.Q$,o.Nd,g.uU]}),n})();function P(n,a){if(1&n&&(t.TgZ(0,"ion-select-option",10),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=a.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.titel+" "+t.xi3(2,2,e.datum,"dd-MM-yy"),"")}}function S(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-select",8),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw(2);return t.KtG(s.competition=r)}),t.YNc(1,P,3,5,"ion-select-option",9),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("ngModel",e.competition),t.xp6(1),t.Q6J("ngForOf",e.getCompetitions())}}function M(n,a){if(1&n&&(t.TgZ(0,"ion-col")(1,"ion-item")(2,"ion-label"),t._uU(3,"Wettkampf"),t.qZA(),t.YNc(4,S,2,2,"ion-select",7),t.qZA()()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.getCompetitions().length>0)}}function w(n,a){if(1&n&&(t.TgZ(0,"ion-note",11),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.competitionName()," ")}}function U(n,a){1&n&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2,"loading ..."),t.qZA(),t._UZ(3,"ion-spinner"),t.qZA())}function Q(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item-option",19),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().$implicit,s=t.MAs(1),c=t.oxw(3);return t.KtG(c.delete(r,s))}),t._UZ(1,"ion-icon",17),t._uU(2," L\xf6schen "),t.qZA()}}function L(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item-sliding",null,13)(2,"app-reg-athlet-item",14),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.MAs(1),h=t.oxw(3);return t.KtG(h.itemTapped(s,c))}),t.qZA(),t.TgZ(3,"ion-item-options",15)(4,"ion-item-option",16),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.MAs(1),h=t.oxw(3);return t.KtG(h.edit(s,c))}),t._UZ(5,"ion-icon",17),t._uU(6),t.qZA(),t.YNc(7,Q,3,0,"ion-item-option",18),t.qZA()()}if(2&n){const e=a.$implicit,i=t.oxw(3);t.xp6(2),t.Q6J("athletregistration",e)("vereinregistration",i.currentRegistration)("status",i.getStatus(e))("programmlist",i.wkPgms),t.xp6(4),t.hij(" ",i.isLoggedInAsClub()?"Bearbeiten":i.isLoggedIn()?"Best\xe4tigen":"Anzeigen"," "),t.xp6(1),t.Q6J("ngIf",i.isLoggedInAsClub())}}function O(n,a){if(1&n&&(t.TgZ(0,"div")(1,"ion-item-divider"),t._uU(2),t.qZA(),t.YNc(3,L,8,6,"ion-item-sliding",12),t.qZA()),2&n){const e=a.$implicit,i=t.oxw(2);t.xp6(2),t.Oqu(e.name),t.xp6(1),t.Q6J("ngForOf",i.filteredStartList(e.id))}}function J(n,a){if(1&n&&(t.TgZ(0,"ion-content")(1,"ion-list"),t.YNc(2,U,4,0,"ion-item",3),t.ALo(3,"async"),t.YNc(4,O,4,2,"div",12),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",t.lcZ(3,2,e.busy)||!(e.competition&&e.currentRegistration&&e.filteredPrograms)),t.xp6(2),t.Q6J("ngForOf",e.filteredPrograms)}}function N(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",20),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.createRegistration())}),t._UZ(1,"ion-icon",21),t._uU(2," Neue Anmeldung... "),t.qZA()}}const F=[{path:"",component:(()=>{class n{constructor(e,i,r,s){this.navCtrl=e,this.route=i,this.backendService=r,this.alertCtrl=s,this.busy=new f.X(!1),this.tMyQueryStream=new A.x,this.sFilterTask=void 0,this.sSyncActions=[],this.backendService.competitions||this.backendService.getCompetitions()}ngOnInit(){this.busy.next(!0);const e=this.route.snapshot.paramMap.get("wkId");this.currentRegId=parseInt(this.route.snapshot.paramMap.get("regId")),e?this.competition=e:this.backendService.competition&&(this.competition=this.backendService.competition)}ionViewWillEnter(){this.refreshList()}getSyncActions(){this.backendService.loadRegistrationSyncActions().pipe((0,p.q)(1)).subscribe(e=>{this.sSyncActions=e})}getStatus(e){if(this.sSyncActions){const i=this.sSyncActions.find(r=>r.verein.id===e.vereinregistrationId&&r.caption.indexOf(e.name)>-1&&r.caption.indexOf(e.vorname)>-1);return i?"pending ("+i.caption.substring(0,(i.caption+":").indexOf(":"))+")":"in sync"}return"n/a"}refreshList(){this.busy.next(!0),this.currentRegistration=void 0,this.getSyncActions(),this.backendService.getClubRegistrations(this.competition).pipe((0,_.h)(e=>!!e.find(i=>i.id===this.currentRegId)),(0,p.q)(1)).subscribe(e=>{this.currentRegistration=e.find(i=>i.id===this.currentRegId),console.log("ask athletes-list for registration"),this.backendService.loadAthletRegistrations(this.competition,this.currentRegId).subscribe(i=>{this.busy.next(!1),this.athletregistrations=i,this.tMyQueryStream.pipe((0,_.h)(s=>!!s&&!!s.target),(0,b.U)(s=>s.target.value||"*"),(0,x.b)(300),(0,I.x)(),(0,R.b)(s=>this.busy.next(!0)),(0,T.w)(this.runQuery(i)),(0,Z.B)()).subscribe(s=>{this.sFilteredRegistrationList=s,this.busy.next(!1)})})})}set competition(e){(!this.currentRegistration||e!==this.backendService.competition)&&this.backendService.loadProgramsForCompetition(this.competition).subscribe(i=>{this.wkPgms=i})}get competition(){return this.backendService.competition||""}getCompetitions(){return this.backendService.competitions||[]}competitionName(){return this.backendService.competitionName}runQuery(e){return i=>{const r=i.trim(),s=new Map;return e&&e.forEach(c=>{if(this.filter(r)(c)){const Y=s.get(c.programId)||[];s.set(c.programId,[...Y,c].sort((q,$)=>q.name.localeCompare($.name)))}}),(0,v.of)(s)}}set athletregistrations(e){this.sAthletRegistrationList=e,this.runQuery(e)("*").subscribe(i=>this.sFilteredRegistrationList=i),this.reloadList(this.sMyQuery||"*")}get athletregistrations(){return this.sAthletRegistrationList}get filteredPrograms(){return[...this.wkPgms.filter(e=>this.sFilteredRegistrationList?.has(e.id))]}mapProgram(e){return this.wkPgms.filter(i=>i.id==e)[0]}filteredStartList(e){return this.sFilteredRegistrationList?.get(e)||this.sAthletRegistrationList||[]}reloadList(e){this.tMyQueryStream.next(e)}itemTapped(e,i){i.getOpenAmount().then(r=>{r>0?i.close():i.open("end")})}isLoggedInAsClub(){return this.backendService.loggedIn&&this.backendService.authenticatedClubId===this.currentRegId+""}isLoggedInAsAdmin(){return this.backendService.loggedIn&&!!this.backendService.authenticatedClubId}isLoggedIn(){return this.backendService.loggedIn}filter(e){const i=e.toUpperCase().split(" ");return r=>"*"===e.trim()||i.filter(s=>{if(r.name.toUpperCase().indexOf(s)>-1||r.vorname.toUpperCase().indexOf(s)>-1||this.wkPgms.find(c=>r.programId===c.id&&c.name===s)||r.gebdat.indexOf(s)>-1||3==s.length&&r.geschlecht.indexOf(s.substring(1,2))>-1)return!0}).length===i.length}createRegistration(){this.navCtrl.navigateForward(`reg-athletlist/${this.backendService.competition}/${this.currentRegId}/0`)}edit(e,i){this.navCtrl.navigateForward(`reg-athletlist/${this.backendService.competition}/${this.currentRegId}/${e.id}`),i.close()}needsPGMChoice(){const e=[...this.wkPgms][0];return!(1==e.aggregate&&e.riegenmode>1)}similarRegistration(e,i){return e.athletId===i.athletId||e.name===i.name&&e.vorname===i.vorname&&e.gebdat===i.gebdat&&e.geschlecht===i.geschlecht}delete(e,i){i.close(),this.alertCtrl.create({header:"Achtung",subHeader:"L\xf6schen der Athlet-Anmeldung am Wettkampf",message:"Hiermit wird die Anmeldung von "+e.name+", "+e.vorname+" am Wettkampf gel\xf6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.needsPGMChoice()||this.athletregistrations.filter(s=>this.similarRegistration(s,e)).filter(s=>s.id!==e.id).forEach(s=>{this.backendService.deleteAthletRegistration(this.backendService.competition,this.currentRegId,s)}),this.backendService.deleteAthletRegistration(this.backendService.competition,this.currentRegId,e).subscribe(()=>{this.refreshList()})}}]}).then(s=>s.present())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(o.SH),t.Y36(m.gz),t.Y36(C.v),t.Y36(o.Br))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-reg-athletlist"]],decls:18,vars:5,consts:[["slot","start"],["defaultHref","/"],["no-padding",""],[4,"ngIf"],["slot","end",4,"ngIf"],["placeholder","Search","showCancelButton","never",3,"ngModel","ngModelChange","ionInput","ionCancel"],["size","large","expand","block","color","success",3,"click",4,"ngIf"],["placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","end"],[4,"ngFor","ngForOf"],["slidingAthletRegistrationItem",""],[3,"athletregistration","vereinregistration","status","programmlist","click"],["side","end"],["color","primary",3,"click"],["name","arrow-forward-circle-outline","ios","md-arrow-forward-circle-outline"],["color","danger",3,"click",4,"ngIf"],["color","danger",3,"click"],["size","large","expand","block","color","success",3,"click"],["slot","start","name","add"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title")(5,"ion-grid",2)(6,"ion-row")(7,"ion-col")(8,"ion-label"),t._uU(9,"Angemeldete Athleten/Athletinnen"),t.qZA()(),t.YNc(10,M,5,1,"ion-col",3),t.qZA()()(),t.YNc(11,w,2,1,"ion-note",4),t.qZA(),t.TgZ(12,"ion-searchbar",5),t.NdJ("ngModelChange",function(s){return i.sMyQuery=s})("ionInput",function(s){return i.reloadList(s)})("ionCancel",function(s){return i.reloadList(s)}),t.qZA()(),t.YNc(13,J,5,4,"ion-content",3),t.TgZ(14,"ion-footer")(15,"ion-toolbar")(16,"ion-list"),t.YNc(17,N,3,0,"ion-button",6),t.qZA()()()),2&e&&(t.xp6(10),t.Q6J("ngIf",!i.competition),t.xp6(1),t.Q6J("ngIf",i.competition),t.xp6(1),t.Q6J("ngModel",i.sMyQuery),t.xp6(1),t.Q6J("ngIf",i.wkPgms&&i.wkPgms.length>0),t.xp6(4),t.Q6J("ngIf",i.isLoggedInAsClub()))},dependencies:[g.sg,g.O5,d.JJ,d.On,o.oU,o.YG,o.Sm,o.wI,o.W2,o.fr,o.jY,o.Gu,o.gu,o.Ie,o.rH,o.u8,o.IK,o.td,o.Q$,o.q_,o.uN,o.Nd,o.VI,o.t9,o.n0,o.PQ,o.wd,o.sr,o.QI,o.j9,o.cs,y,g.Ov,g.uU]}),n})()}];let B=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[g.ez,d.u5,o.Pc,m.Bz.forChild(F)]}),n})()}}]);