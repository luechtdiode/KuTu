"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7852],{7852:(ye,C,u)=>{u.r(C),u.d(C,{LastResultsPageModule:()=>je});var p=u(2200),_=u(4341),S=u(8132),a=u(9893),F=u(467),l=u(2615),T=u(5035),k=u(1266),j=u(1413),M=u(4412),$=u(7673),f=u(5964),b=u(6354),y=u(152),L=u(3294),P=u(7647),A=u(5558),R=u(1158),I=u(2350),G=u(8103),e=u(3664),v=u(7705);function V(i,s){1&i&&(e.j41(0,"ion-avatar",1),e.nrm(1,"img",3),e.k0s())}function D(i,s){1&i&&(e.j41(0,"ion-avatar",1),e.nrm(1,"img",4),e.k0s())}function E(i,s){if(1&i&&(e.j41(0,"li")(1,"small")(2,"em"),e.EFF(3),e.k0s()()()),2&i){const t=s.$implicit;e.R7$(3),e.JRh(t)}}function X(i,s){if(1&i&&(e.j41(0,"ion-label"),e.EFF(1),e.nrm(2,"br"),e.EFF(3," \xa0\xa0\xa0\xa0\xa0\xa0"),e.j41(4,"small")(5,"em"),e.EFF(6),e.k0s()(),e.nrm(7,"br"),e.j41(8,"ul"),e.Z7z(9,E,4,1,"li",null,e.fX1),e.k0s()()),2&i){const t=e.XpG();e.R7$(),e.Lme("",t.teilnehmer().Rang,". ",t.teilnehmer()["Team/Athlet"]),e.R7$(5),e.JRh(t.teilnehmerSubResults),e.R7$(3),e.Dyx(t.teamTeilnehmerSubResults)}}function B(i,s){if(1&i&&(e.j41(0,"ion-label"),e.EFF(1),e.j41(2,"small"),e.EFF(3),e.k0s(),e.nrm(4,"br"),e.EFF(5," \xa0\xa0\xa0\xa0\xa0\xa0"),e.j41(6,"small")(7,"em"),e.EFF(8),e.k0s()()()),2&i){const t=e.XpG();e.R7$(),e.E5c("",t.teilnehmer().Rang,". ",t.teilnehmer().Athlet," (",t.teilnehmer().Jahrgang,")\xa0"),e.R7$(2),e.SpI(" - ",t.teilnehmer().Verein),e.R7$(5),e.JRh(t.teilnehmerSubResults)}}function N(i,s){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI("\xf8 Ger\xe4t ",t.teilnehmer()["\xf8 Ger\xe4t"])}}function U(i,s){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme("Total D/E ",t.teilnehmer()["Total D"],"/",t.teilnehmer()["Total E"])}}function z(i,s){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme("Total A/B ",t.teilnehmer()["Total A"],"/",t.teilnehmer()["Total B"])}}let O=(()=>{class i{teilnehmerSubResults="";teamTeilnehmerSubResults=[];teilnehmer=(0,v.hFB)(void 0);selected=(0,v.CGW)();constructor(){}ngOnInit(){this.teilnehmerSubResults=x(this.teilnehmer());const t=this.teilnehmer();this.teamTeilnehmerSubResults=0==t.rows?.length?[]:t.rows.map(H)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["scorelist-item"]],inputs:{teilnehmer:[1,"teilnehmer"]},outputs:{selected:"selected"},standalone:!1,decls:12,vars:8,consts:[[3,"click"],["slot","start"],["slot","end"],["src","assets/imgs/athlete.png"],["src","assets/imgs/verein.png"]],template:function(n,o){1&n&&(e.j41(0,"ion-item",0),e.bIt("click",function(){return o.selected?o.selected.emit(o.teilnehmer()):{}}),e.nVh(1,V,2,0,"ion-avatar",1),e.nVh(2,D,2,0,"ion-avatar",1),e.nVh(3,X,11,3,"ion-label"),e.nVh(4,B,9,5,"ion-label"),e.j41(5,"ion-note",2)(6,"b"),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.nVh(9,N,2,1,"em"),e.nVh(10,U,2,2,"em"),e.nVh(11,z,2,2,"em"),e.k0s()()),2&n&&(e.R7$(),e.vxM(o.teilnehmer().Athlet?1:-1),e.R7$(),e.vxM(o.teamTeilnehmerSubResults.length>0?2:-1),e.R7$(),e.vxM(o.teamTeilnehmerSubResults.length>0?3:-1),e.R7$(),e.vxM(o.teilnehmer().Athlet?4:-1),e.R7$(3),e.SpI("Total Punkte ",o.teilnehmer()["Total Punkte"]),e.R7$(2),e.vxM(o.teilnehmer()["\xf8 Ger\xe4t"]?9:-1),e.R7$(),e.vxM(o.teilnehmer()["Total D"]?10:-1),e.R7$(),e.vxM(o.teilnehmer()["Total A"]?11:-1))},dependencies:[a.mC,a.uz,a.he,a.JI],styles:["ion-note[_ngcontent-%COMP%]{text-align:end}"]})}return i})();const W=["athletID","rows","Rang","Athlet","Team","Team/Athlet","Jahrgang","Verein","K","\xf8 Ger\xe4t","Total D","Total E","Total A","Total B","Total Punkte"];function H(i){return`${i.Team} (${i.K}): ${x(i)}`}function x(i){return Object.keys(i).map(s=>`${s}`).filter(s=>W.indexOf(s)<0&&i[s].Endnote).map(s=>`${s}: ${function w(i){let s="",t="";return i["Endnote-styles"].indexOf("best")>=0&&(s="*"),i["Endnote-styles"].indexOf("stroke")>=0&&(t="!"),`${s}${i["Endnote-raw"].trim()}${t}`}(i[s])} (${i[s].Rang.trim()})`).join(", ")}const Q=i=>({"gradient-border":i});function K(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-buttons")(1,"ion-button",7),e.bIt("click",function(){l.eBV(t);const o=e.XpG(2);return l.Njj(o.toggleOptions())}),e.nrm(2,"ion-icon",8),e.k0s()()}}function J(i,s){if(1&i&&(e.j41(0,"ion-note",5),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.competitionName()," ")}}function Z(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-searchbar",9),e.mxI("ngModelChange",function(o){l.eBV(t);const r=e.XpG(2);return e.DH7(r.sMyQuery,o)||(r.sMyQuery=o),l.Njj(o)}),e.bIt("ionInput",function(o){l.eBV(t);const r=e.XpG(2);return l.Njj(r.reloadList(o))})("ionCancel",function(o){l.eBV(t);const r=e.XpG(2);return l.Njj(r.reloadList(o))}),e.k0s()}if(2&i){const t=e.XpG(2);e.R50("ngModel",t.sMyQuery)}}function Y(i,s){if(1&i&&(e.j41(0,"ion-select-option",16),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const t=s.$implicit;e.Y8G("value",t.uuid),e.R7$(),e.SpI(" ",t.titel+" "+e.i5U(2,2,t.datum,"dd-MM-yy"))}}function q(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-select",15),e.mxI("ngModelChange",function(o){l.eBV(t);const r=e.XpG(3);return e.DH7(r.competition,o)||(r.competition=o),l.Njj(o)}),e.Z7z(1,Y,3,5,"ion-select-option",16,e.fX1),e.k0s()}if(2&i){const t=e.XpG(3);e.R50("ngModel",t.competition),e.R7$(),e.Dyx(t.getCompetitions())}}function ee(i,s){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("(atkiv) ",t)}}function te(i,s){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("(inaktiv) ",t)}}function ie(i,s){if(1&i&&(e.j41(0,"ion-select-option",16),e.nVh(1,ee,2,1,"em"),e.nVh(2,te,2,1,"div"),e.k0s()),2&i){const t=s.$implicit,n=e.XpG(4);e.Y8G("value",t),e.R7$(),e.vxM(n.isDurchgangActiv(t)?1:-1),e.R7$(),e.vxM(n.isDurchgangActiv(t)?-1:2)}}function ne(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-select",17),e.mxI("ngModelChange",function(o){l.eBV(t);const r=e.XpG(3);return e.DH7(r.durchgangFilter,o)||(r.durchgangFilter=o),l.Njj(o)}),e.j41(1,"ion-select-option",18),e.EFF(2,"Kein Durchgangfilter"),e.k0s(),e.Z7z(3,ie,3,3,"ion-select-option",16,e.fX1),e.k0s()}if(2&i){const t=e.XpG(3);e.R50("ngModel",t.durchgangFilter),e.R7$(3),e.Dyx(t.getDurchgaenge())}}function oe(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-list")(1,"ion-item"),e.nVh(2,q,3,1,"ion-select",10),e.k0s(),e.j41(3,"ion-item"),e.nVh(4,ne,5,1,"ion-select",11),e.k0s(),e.j41(5,"ion-item")(6,"ion-select",12),e.mxI("ngModelChange",function(o){l.eBV(t);const r=e.XpG(2);return e.DH7(r.kategorieFilter,o)||(r.kategorieFilter=o),l.Njj(o)}),e.j41(7,"ion-select-option",13),e.EFF(8,"Kategorien getrennt"),e.k0s(),e.j41(9,"ion-select-option",14),e.EFF(10,"Kategorien gemischt"),e.k0s()()(),e.j41(11,"ion-item")(12,"ion-label"),e.EFF(13),e.k0s(),e.j41(14,"ion-button",7),e.bIt("click",function(){l.eBV(t);const o=e.XpG(2);return l.Njj(o.toggleHeader())}),e.EFF(15,"Umschalten"),e.k0s()()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.vxM(t.getCompetitions().length>0?2:-1),e.R7$(2),e.vxM(t.getDurchgaenge()&&t.getDurchgaenge().length>0?4:-1),e.R7$(2),e.R50("ngModel",t.kategorieFilter),e.R7$(7),e.SpI("doppel-click wechselt die Position des Toolbars (",t.nextToolbarPosition,")")}}function se(i,s){if(1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",3)(3,"ion-menu-toggle")(4,"ion-button"),e.nrm(5,"ion-icon",4),e.k0s()(),e.nVh(6,K,3,0,"ion-buttons"),e.k0s(),e.j41(7,"ion-title")(8,"ion-grid",2)(9,"ion-row")(10,"ion-col")(11,"ion-label"),e.EFF(12),e.k0s()()()()(),e.nVh(13,J,2,1,"ion-note",5),e.k0s(),e.nVh(14,Z,1,1,"ion-searchbar",6),e.nVh(15,oe,16,4,"ion-list"),e.k0s()),2&i){const t=e.XpG();e.R7$(6),e.vxM(t.scorelistAvailable()?-1:6),e.R7$(6),e.JRh(t.title),e.R7$(),e.vxM(t.competition?13:-1),e.R7$(),e.vxM(t.scorelistAvailable()?14:-1),e.R7$(),e.vxM(t.optionsVisible&&t.isToolbarTop()?15:-1)}}function re(i,s){if(1&i&&(e.j41(0,"ion-col",19)(1,"div",20),e.nrm(2,"result-display",21),e.k0s()()),2&i){const t=s.$implicit,n=e.XpG(3);e.BMQ("size-xs",n.getColumnSpecs()[0])("size-sm",n.getColumnSpecs()[1])("size-md",n.getColumnSpecs()[2])("size-lg",n.getColumnSpecs()[3])("size-xl",n.getMaxColumnSpec()),e.R7$(),e.Y8G("ngClass",e.eq3(9,Q,n.isNew(t))),e.R7$(),e.Y8G("item",t)("title",n.getTitle(t))("groupedBy",n.groupBy.PROGRAMM)}}function le(i,s){if(1&i&&(e.j41(0,"ion-row"),e.Z7z(1,re,3,11,"ion-col",19,e.fX1),e.k0s()),2&i){const t=s.$implicit,n=e.XpG(2);e.R7$(),e.Dyx(n.getWertungen(t))}}function ae(i,s){if(1&i&&(e.j41(0,"ion-grid",2),e.Z7z(1,le,3,0,"ion-row",null,e.fX1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Dyx(t.getProgramme())}}function ce(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-item-option",25),e.bIt("click",function(){l.eBV(t);const o=e.XpG().$implicit,r=e.sdS(1),c=e.XpG(3);return l.Njj(c.followAthlet(o,r))}),e.nrm(1,"ion-icon",26),e.EFF(2),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" Detail-Wertungen ",t.Athlet," ")}}function ue(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-item-sliding",null,0)(2,"scorelist-item",22),e.bIt("click",function(){const o=l.eBV(t).$implicit,r=e.sdS(1),c=e.XpG(3);return l.Njj(c.scoreItemTapped(o,r))}),e.k0s(),e.j41(3,"ion-item-options",23),e.nVh(4,ce,3,1,"ion-item-option",24),e.k0s()()}if(2&i){const t=s.$implicit;e.R7$(2),e.Y8G("teilnehmer",t),e.R7$(2),e.vxM(t.athletID?4:-1)}}function de(i,s){if(1&i&&(e.j41(0,"div")(1,"ion-item-divider"),e.EFF(2),e.k0s(),e.Z7z(3,ue,5,2,"ion-item-sliding",null,e.fX1),e.k0s()),2&i){const t=s.$implicit;e.R7$(2),e.JRh(t.title.text),e.R7$(),e.Dyx(t.rows)}}function he(i,s){if(1&i&&(e.j41(0,"ion-list"),e.Z7z(1,de,5,1,"div",null,e.fX1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Dyx(t.filteredScoreList)}}function me(i,s){if(1&i&&(e.j41(0,"ion-select-option",16),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const t=s.$implicit;e.Y8G("value",t.uuid),e.R7$(),e.SpI(" ",t.titel+" "+e.i5U(2,2,t.datum,"dd-MM-yy"))}}function ge(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-select",15),e.mxI("ngModelChange",function(o){l.eBV(t);const r=e.XpG(3);return e.DH7(r.competition,o)||(r.competition=o),l.Njj(o)}),e.Z7z(1,me,3,5,"ion-select-option",16,e.fX1),e.k0s()}if(2&i){const t=e.XpG(3);e.R50("ngModel",t.competition),e.R7$(),e.Dyx(t.getCompetitions())}}function pe(i,s){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("(aktiv) ",t)}}function _e(i,s){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("(inaktiv) ",t)}}function fe(i,s){if(1&i&&(e.j41(0,"ion-select-option",16),e.nVh(1,pe,2,1,"em"),e.nVh(2,_e,2,1,"div"),e.k0s()),2&i){const t=s.$implicit,n=e.XpG(4);e.Y8G("value",t),e.R7$(),e.vxM(n.isDurchgangActiv(t)?1:-1),e.R7$(),e.vxM(n.isDurchgangActiv(t)?-1:2)}}function be(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-select",17),e.mxI("ngModelChange",function(o){l.eBV(t);const r=e.XpG(3);return e.DH7(r.durchgangFilter,o)||(r.durchgangFilter=o),l.Njj(o)}),e.j41(1,"ion-select-option",18),e.EFF(2,"Kein Durchgangfilter"),e.k0s(),e.Z7z(3,fe,3,3,"ion-select-option",16,e.fX1),e.k0s()}if(2&i){const t=e.XpG(3);e.R50("ngModel",t.durchgangFilter),e.R7$(3),e.Dyx(t.getDurchgaenge())}}function Ce(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-list")(1,"ion-item"),e.nVh(2,ge,3,1,"ion-select",10),e.k0s(),e.j41(3,"ion-item"),e.nVh(4,be,5,1,"ion-select",11),e.k0s(),e.j41(5,"ion-item")(6,"ion-select",12),e.mxI("ngModelChange",function(o){l.eBV(t);const r=e.XpG(2);return e.DH7(r.kategorieFilter,o)||(r.kategorieFilter=o),l.Njj(o)}),e.j41(7,"ion-select-option",13),e.EFF(8,"Kategorien getrennt"),e.k0s(),e.j41(9,"ion-select-option",14),e.EFF(10,"Kategorien gemischt"),e.k0s()()(),e.j41(11,"ion-item")(12,"ion-label"),e.EFF(13),e.k0s(),e.j41(14,"ion-button",7),e.bIt("click",function(){l.eBV(t);const o=e.XpG(2);return l.Njj(o.toggleHeader())}),e.EFF(15,"Umschalten"),e.k0s()()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.vxM(t.getCompetitions().length>0?2:-1),e.R7$(2),e.vxM(t.getDurchgaenge()&&t.getDurchgaenge().length>0?4:-1),e.R7$(2),e.R50("ngModel",t.kategorieFilter),e.R7$(7),e.SpI("doppel-click wechselt die Position des Toolbars (",t.nextToolbarPosition,")")}}function ke(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-buttons")(1,"ion-button",7),e.bIt("click",function(){l.eBV(t);const o=e.XpG(2);return l.Njj(o.toggleOptions())}),e.nrm(2,"ion-icon",8),e.k0s()()}}function Re(i,s){if(1&i&&(e.j41(0,"ion-note",5),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.competitionName()," ")}}function ve(i,s){if(1&i&&(e.j41(0,"ion-footer"),e.nVh(1,Ce,16,4,"ion-list"),e.j41(2,"ion-toolbar")(3,"ion-buttons",3)(4,"ion-menu-toggle")(5,"ion-button"),e.nrm(6,"ion-icon",4),e.k0s()(),e.nVh(7,ke,3,0,"ion-buttons"),e.k0s(),e.j41(8,"ion-title")(9,"ion-grid",2)(10,"ion-row")(11,"ion-col")(12,"ion-label"),e.EFF(13),e.k0s()()()()(),e.nVh(14,Re,2,1,"ion-note",5),e.k0s()()),2&i){const t=e.XpG();e.R7$(),e.vxM(t.optionsVisible?1:-1),e.R7$(6),e.vxM(t.scorelistAvailable()?-1:7),e.R7$(6),e.JRh(t.title),e.R7$(),e.vxM(t.competition?14:-1)}}function xe(i,s){if(1&i){const t=e.RV6();e.j41(0,"ion-footer")(1,"ion-toolbar")(2,"ion-button",27),e.bIt("click",function(){l.eBV(t);const o=e.XpG();return l.Njj(o.presentActionSheet())}),e.nrm(3,"ion-icon",28),e.k0s()()()}}let Se=(()=>{class i{navCtrl=(0,l.WQX)(T.q9);backendService=(0,l.WQX)(I.m);route=(0,l.WQX)(k.nX);router=(0,l.WQX)(k.Ix);actionSheetController=(0,l.WQX)(a.GD);groupBy=R.R;items=[];mixeditems=[];hasCountingItems=void 0;lastItems;geraete=[];scorelinks=[];defaultPath=void 0;scoreblocks=[];sFilteredScoreList=[];sMyQuery;isDNoteUsed=!0;tMyQueryStream=new j.B;sFilterTask=void 0;busy=new M.t(!1);durchgangopen;subscriptions=[];constructor(){this.backendService.competitions||this.backendService.getCompetitions(),this.durchgangopen=!1,this.backendService.durchgangStarted.pipe((0,f.p)(t=>void 0!==t),(0,b.T)(t=>t.filter(n=>n.wettkampfUUID===this.backendService.competition).length>0)).subscribe(t=>{this.durchgangopen=t})}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.cleanScoreListSubscriptions()}ngOnInit(){this.competition=this.route.snapshot.queryParamMap.get("c")||this.backendService.competition,this.kategorieFilter=this.route.snapshot.queryParamMap.get("k")||"getrennt",this.durchgangFilter=this.route.snapshot.queryParamMap.get("d")||"undefined",this.subscriptions.push(this.backendService.competitionSubject.subscribe(t=>{this.subscriptions.push(this.backendService.newLastResults.pipe((0,f.p)(n=>void 0!==n)).subscribe(n=>this.refreshItems(n)))}))}_optionsVisible=!1;get optionsVisible(){return this._optionsVisible||!this.competition}set optionsVisible(t){this._optionsVisible=t}toggleOptions(){this._optionsVisible=!this._optionsVisible}teamsAllowed(t){return t.teamrule?.trim().length>0&&"Keine Teams"!==t.teamrule}_title="Aktuelle Resultate";get title(){return this._title}set title(t){this._title=t}isNew(t){return 0===this.lastItems.filter(n=>n===t.id*this.geraete.length+t.geraet).length}get stationFreezed(){return this.backendService.stationFreezed}set competition(t){this.stationFreezed||(this.backendService.getDurchgaenge(t),this.router.navigate(["last-results"],{queryParams:{c:this.competition,k:this._kategorieFilter,d:this.backendService.durchgang},queryParamsHandling:"merge"}))}get competition(){return this.backendService.competition||""}getCompetitions(){return this.backendService.competitions||[]}competitionContainer(){const t={titel:"",datum:new Date,auszeichnung:void 0,auszeichnungendnote:void 0,id:void 0,uuid:void 0,programmId:0,teamrule:""};if(!this.backendService.competitions)return t;const n=this.backendService.competitions.filter(o=>o.uuid===this.backendService.competition);return 1===n.length?n[0]:t}competitionName(){const t=this.competitionContainer();return""===t.titel?"":t.titel+", am "+(t.datum+"T").split("T")[0].split("-").reverse().join("-")}geraetOrder(t){return this.geraete?this.geraete.findIndex(n=>n.id===t):0}geraetText(t){if(!this.geraete)return"";const n=this.geraete.filter(o=>o.id===t).map(o=>o.name);return 1===n.length?n[0]:""}getColumnSpec(){return this.geraete?.length||0}getColumnSpecs(){return 6===this.getColumnSpec()?[12,12,6,4,this.getMaxColumnSpec()]:[12,6,6,3,this.getMaxColumnSpec()]}getMaxColumnSpec(){return Math.min(12,Math.max(1,Math.floor(12/this.geraete.length+.5)))}getTitle(t){return t.programm+" - "+this.geraetText(t.geraet)}onlyUnique(t,n,o){return o.indexOf(t)===n}getProgramme(){return"getrennt"===this.kategorieFilter?this.items.map(t=>t.programm).filter(this.onlyUnique):[this.mixeditems.map(t=>t.programm)[0]]}getWertungen(t){return"getrennt"===this.kategorieFilter?this.items.filter(n=>n.programm===t):this.getMixedWertungen()}getMixedWertungen(){return this.mixeditems}getDurchgaenge(){return[...this.backendService.activeDurchgangList.map(t=>t.durchgang),...this.backendService.durchgaenge.filter(t=>!this.isDurchgangActiv(t))]}isDurchgangActiv(t){return void 0!==this.backendService.activeDurchgangList.find(n=>n.durchgang===t)}_durchgang=void 0;set durchgangFilter(t){"undefined"===t?(this.router.navigate(["last-results"],{queryParams:{c:this.competition,k:this._kategorieFilter,d:void 0},queryParamsHandling:"merge"}),this.backendService.getGeraete(this.backendService.competition,void 0).subscribe(n=>{this.geraete=n??[]}),this.backendService.disconnectWS(!0),this.backendService.initWebsocket(),this._durchgang=void 0):(this.router.navigate(["last-results"],{queryParams:{c:this.competition,k:this._kategorieFilter,d:t},queryParamsHandling:"merge"}),this.backendService.getGeraete(this.backendService.competition,t).subscribe(n=>{this.geraete=n??[]}),this.backendService.disconnectWS(!0),this.backendService.initWebsocket(),this._durchgang=t)}get durchgangFilter(){return this._durchgang||"undefined"}_kategorieFilter="getrennt";set kategorieFilter(t){this._kategorieFilter=t,this._kategorieFilter?.trim().length>0?this.router.navigate(["last-results"],{queryParams:{c:this.competition,k:t,d:this.backendService.durchgang},queryParamsHandling:"merge"}):this.router.navigate(["last-results"],{queryParams:{c:this.competition,d:this.backendService.durchgang},queryParamsHandling:"merge"})}get kategorieFilter(){return this._kategorieFilter}hideHeader=0;toggleHeader(){this.scorelistAvailable()||(this.hideHeader=this.hideHeader+=1,this.hideHeader>2&&(this.hideHeader=0))}get nextToolbarPosition(){return 0===this.hideHeader?"von oben nach unten, und dann auf ausgeblendet":1===this.hideHeader?"von unten nach ausgeblendet":"oben"}isToolbarTop(){return 0===this.hideHeader||this.scorelistAvailable()}isToolbarBottom(){return 1===this.hideHeader}isFullscreen(){return 2===this.hideHeader}get isBusy(){return this.busy}refreshItems(t){if(this.lastItems=this.items.map(n=>n.id*this.geraete.length+n.geraet),this.items=[],this.mixeditems=[],this.hasCountingItems=!1,t&&t.resultsPerWkDisz){const n=Object.values(t.resultsPerWkDisz),o=n.map(d=>d.programm).filter(this.onlyUnique),r=o.length>0?o:["\xa0"];n.length>0&&(this.isDNoteUsed=n.findIndex((d,h,m)=>d.isDNoteUsed)>-1);const c=[];r.forEach(d=>{this.geraete.map(h=>n.find(m=>m.geraet===h.id&&m.wertung.endnote&&("\xa0"===d||m.programm===d))||{programm:d,geraet:h.id,id:0,vorname:"\xa0",name:"\xa0",geschlecht:void 0,verein:"\xa0",wertung:{noteE:0,noteD:0,endnote:0,wettkampfdisziplinId:0},isDNoteUsed:this.isDNoteUsed}).forEach(h=>{this.hasCountingItems=this.hasCountingItems||h.wertung.endnote>0,c.push(h)})}),this.items=c,this.mixeditems=this.geraete.map(d=>t.resultsPerDisz[d.id]??{programm:"\xa0",geraet:d.id,id:0,vorname:"\xa0",name:"\xa0",geschlecht:void 0,verein:"\xa0",wertung:{noteE:0,noteD:0,endnote:0,wettkampfdisziplinId:0},isDNoteUsed:!(this.items.length>0)||this.items[0].isDNoteUsed})}this.scorelistAvailable()?this.loadScoreList():this.title="Aktuelle Resultate"}scorelistAvailable(){return void 0!==this.hasCountingItems&&!this.durchgangopen&&!this.hasCountingItems&&new Date(this.competitionContainer().datum).getTime()<new Date(Date.now()-864e5).getTime()}get filteredScoreList(){return this.sFilteredScoreList?.length>0?this.sFilteredScoreList:this.getScoreListItems()}loadScoreList(){this.backendService.getScoreLists().subscribe(t=>{const n=this.competitionContainer();let o="";n.altersklassen&&n.altersklassen.trim().length>0?o=":Wettkampf%20Altersklassen":n.jahrgangsklassen&&n.jahrgangsklassen.trim().length>0&&(o=":Wettkampf%20JG-Altersklassen");const r=`/api/scores/${n.uuid}/query?groupby=Kategorie${o}:Geschlecht`;if(t){const d=Object.values(t).filter(g=>"Zwischenresultate"!=g.name).sort((g,$e)=>g.name.localeCompare($e.name)),h={name:"Generische Rangliste",published:!0,"published-date":"","scores-href":r,"scores-query":r},m={name:"Generische Team-Rangliste",published:!0,"published-date":"","scores-href":`/api/scores/${n.uuid}/query?kind=Teamrangliste`,"scores-query":`/api/scores/${n.uuid}/query?kind=Teamrangliste`};this.scorelinks=this.teamsAllowed(n)?[...d,m,h]:[...d,h];const Me=this.scorelinks.filter(g=>""+g.published=="true");this.refreshScoreList(Me[0])}})}_scorelistSubscription=[];cleanScoreListSubscriptions(){this._scorelistSubscription.forEach(t=>t.unsubscribe()),this._scorelistSubscription=[]}refreshScoreList(t){let n=t["scores-href"];t.published||(n=t["scores-query"]),n.startsWith("/")&&(n=n.substring(1)),n=n.replace("html",""),this._optionsVisible=!1,this.title=t.name,this.defaultPath=n,this._scorelistSubscription.push(this.backendService.getScoreList(this.defaultPath).pipe((0,b.T)(o=>o.title&&o.scoreblocks?o.scoreblocks:[])).subscribe(o=>{this.scoreblocks=o,this.sFilteredScoreList=o,this.cleanScoreListSubscriptions();const r=this.tMyQueryStream.pipe((0,f.p)(c=>!!c&&!!c.target&&!!c.target.value),(0,b.T)(c=>c.target.value),(0,y.B)(1e3),(0,L.F)(),(0,P.u)());this._scorelistSubscription.push(r.subscribe(()=>{this.busy.next(!0)})),this._scorelistSubscription.push(r.pipe((0,A.n)(this.runQuery(this.scoreblocks))).subscribe(c=>{this.sFilteredScoreList=c,this.busy.next(!1)}))}))}runQuery(t){return n=>{const o=n.trim();let r=[];return o&&t&&t.forEach(c=>{const d=this.filter(o),h=c.rows.filter(m=>d(m,c));if(h.length>0){const m={title:c.title,rows:h};r=[...r,m]}}),(0,$.of)(r)}}filter(t){const n=t.toUpperCase(),o=n.split(" ");return(r,c)=>c.title.text.toUpperCase().indexOf(n)>-1||o.filter(d=>[r,...r.rows].find(h=>{if(h.Athlet?.toUpperCase().indexOf(d)>-1||h["Team/Athlet"]?.toUpperCase().indexOf(d)>-1||h.Team?.toUpperCase().indexOf(d)>-1||h.Verein?.toUpperCase().indexOf(d)>-1||h.Jahrgang?.toUpperCase()===d||c.title.text.toUpperCase().replace("."," ").replace(","," ").split(" ").indexOf(d)>-1)return!0})).length===o.length}reloadList(t){this.tMyQueryStream.next(t)}makeGenericScoreListLink(){return`${G.EV}${this.defaultPath}&html`}getScoreListItems(){return this.scoreblocks}scoreItemTapped(t,n){n.getOpenAmount().then(o=>{o>0?n.close():n.open("end")})}followAthlet(t,n){n.close(),t.athletID&&this.navCtrl.navigateForward(`athlet-view/${this.backendService.competition}/${t.athletID}`)}open(){window.open(this.makeGenericScoreListLink(),"_blank")}isShareAvailable(){return!!navigator&&!!navigator.share}share(){let t="GeTu";const o=this.competitionContainer();""!==o.titel&&(t={1:"Athletik",11:"KuTu",20:"GeTu",31:"KuTu"}[o.programmId]);let r=`${this.competitionName()} #${t}-${o.titel.replace(","," ").split(" ").join("_")}`;this.isShareAvailable()&&navigator.share({title:`${t} Rangliste`,text:r,url:this.makeGenericScoreListLink()}).then(function(){console.log("Article shared")}).catch(function(c){console.log(c.message)})}presentActionSheet(){var t=this;return(0,F.A)(function*(){let n=[...t.scorelinks.map(c=>""+c.published=="true"?{text:`${c.name} anzeigen ...`,icon:"document",handler:()=>{t.refreshScoreList(c)}}:{text:`${c.name} (unver\xf6ffentlicht)`,icon:"today-outline",handler:()=>{t.refreshScoreList(c)}}),{text:"Rangliste \xf6ffnen ...",icon:"open",handler:()=>{t.open()}}];t.isShareAvailable()&&(n=[...n,{text:"Teilen / Share ...",icon:"share",handler:()=>{t.share()}}]);let o={header:"Aktionen",cssClass:"my-actionsheet-class",buttons:n};yield(yield t.actionSheetController.create(o)).present()})()}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["app-last-results"]],standalone:!1,decls:6,vars:5,consts:[["slidingAthletScoreItem",""],[3,"dblclick","click"],["no-padding",""],["slot","start"],["slot","icon-only","name","menu"],["slot","end"],["placeholder","Search","showCancelButton","never",3,"ngModel"],[3,"click"],["slot","icon-only","name","options"],["placeholder","Search","showCancelButton","never",3,"ngModelChange","ionInput","ionCancel","ngModel"],["label","Wettkampf","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel"],["label","Durchgang","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel"],["label","Kategorien","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["value","getrennt"],["value","gemischt"],["label","Wettkampf","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value"],["label","Durchgang","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["value","undefined"],[1,"align-self-start"],[3,"ngClass"],[3,"item","title","groupedBy"],[3,"click","teilnehmer"],["side","end"],["color","primary"],["color","primary",3,"click"],["name","arrow-forward-circle-outline","ios","md-arrow-forward-circle-outline"],["size","large","expand","block","color","primary",3,"click"],["slot","start","name","list"]],template:function(n,o){1&n&&(e.nVh(0,se,16,5,"ion-header"),e.j41(1,"ion-content",1),e.bIt("dblclick",function(){return o.toggleHeader()})("click",function(){return o.optionsVisible=!1}),e.nVh(2,ae,3,0,"ion-grid",2),e.nVh(3,he,3,0,"ion-list"),e.k0s(),e.nVh(4,ve,15,4,"ion-footer"),e.nVh(5,xe,4,0,"ion-footer")),2&n&&(e.vxM(o.isToolbarTop()?0:-1),e.R7$(2),e.vxM(o.scorelistAvailable()?-1:2),e.R7$(),e.vxM(o.scorelistAvailable()?3:-1),e.R7$(),e.vxM(!o.scorelistAvailable()&&o.isToolbarBottom()?4:-1),e.R7$(),e.vxM(o.scorelistAvailable()?5:-1))},dependencies:[p.YU,_.BC,_.vS,a.Jm,a.QW,a.hU,a.W9,a.M0,a.lO,a.eU,a.iq,a.uz,a.Dg,a.LU,a.CE,a.A7,a.he,a.nf,a.cA,a.JI,a.ln,a.S1,a.Nm,a.Ip,a.BC,a.ai,a.Je,a.Gw,R.v,O,p.vh],encapsulation:2})}return i})();var Fe=u(5079);const Te=[{path:"",component:Se}];let je=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=e.$C({type:i});static \u0275inj=l.G2t({imports:[p.MD,_.YN,a.bv,S.iI.forChild(Te),Fe.h]})}return i})()}}]);