"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[7852],{7852:(Ce,k,_)=>{_.r(k),_.d(k,{LastResultsPageModule:()=>xe});var m=_(6396),p=_(4341),v=_(9355),c=_(7125),F=_(467),I=_(1413),x=_(4412),G=_(7673),f=_(5964),b=_(6354),j=_(152),C=_(3294),$=_(7647),L=_(5558),R=_(1158),D=_(8103),e=_(7241),l=_(8564),E=_(2872),P=_(2350),S=_(8325);function A(i,o){1&i&&(e.j41(0,"ion-avatar",4),e.nrm(1,"img",5),e.k0s())}function y(i,o){1&i&&(e.j41(0,"ion-avatar",4),e.nrm(1,"img",6),e.k0s())}function M(i,o){if(1&i&&(e.j41(0,"li")(1,"small")(2,"em"),e.EFF(3),e.k0s()()()),2&i){const t=o.$implicit;e.R7$(3),e.JRh(t)}}function N(i,o){if(1&i&&(e.j41(0,"ion-label"),e.EFF(1),e.nrm(2,"br"),e.EFF(3," \xa0\xa0\xa0\xa0\xa0\xa0"),e.j41(4,"small")(5,"em"),e.EFF(6),e.k0s()(),e.nrm(7,"br"),e.j41(8,"ul"),e.DNE(9,M,4,1,"li",7),e.k0s()()),2&i){const t=e.XpG();e.R7$(),e.Lme("",t.teilnehmer.Rang,". ",t.teilnehmer["Team/Athlet"]),e.R7$(5),e.JRh(t.teilnehmerSubResults),e.R7$(3),e.Y8G("ngForOf",t.teamTeilnehmerSubResults)}}function X(i,o){if(1&i&&(e.j41(0,"ion-label"),e.EFF(1),e.j41(2,"small"),e.EFF(3),e.k0s(),e.nrm(4,"br"),e.EFF(5," \xa0\xa0\xa0\xa0\xa0\xa0"),e.j41(6,"small")(7,"em"),e.EFF(8),e.k0s()()()),2&i){const t=e.XpG();e.R7$(),e.E5c("",t.teilnehmer.Rang,". ",t.teilnehmer.Athlet," (",t.teilnehmer.Jahrgang,")\xa0"),e.R7$(2),e.SpI(" - ",t.teilnehmer.Verein),e.R7$(5),e.JRh(t.teilnehmerSubResults)}}function Y(i,o){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.SpI("\xf8 Ger\xe4t ",t.teilnehmer["\xf8 Ger\xe4t"])}}function B(i,o){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme("Total D/E ",t.teilnehmer["Total D"],"/",t.teilnehmer["Total E"])}}function O(i,o){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Lme("Total A/B ",t.teilnehmer["Total A"],"/",t.teilnehmer["Total B"])}}let V=(()=>{class i{teilnehmerSubResults="";teamTeilnehmerSubResults=[];teilnehmer;selected;constructor(){}ngOnInit(){this.teilnehmerSubResults=T(this.teilnehmer),this.teamTeilnehmerSubResults=0==this.teilnehmer.rows?.length?[]:this.teilnehmer.rows.map(w)}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=e.VBU({type:i,selectors:[["scorelist-item"]],inputs:{teilnehmer:"teilnehmer"},outputs:{selected:"selected"},standalone:!1,decls:12,vars:8,consts:[[3,"click"],["slot","start",4,"ngIf"],[4,"ngIf"],["slot","end"],["slot","start"],["src","assets/imgs/athlete.png"],["src","assets/imgs/verein.png"],[4,"ngFor","ngForOf"]],template:function(n,s){1&n&&(e.j41(0,"ion-item",0),e.bIt("click",function(){return s.selected?s.selected.emit(s.teilnehmer):{}}),e.DNE(1,A,2,0,"ion-avatar",1)(2,y,2,0,"ion-avatar",1)(3,N,10,4,"ion-label",2)(4,X,9,5,"ion-label",2),e.j41(5,"ion-note",3)(6,"b"),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.DNE(9,Y,2,1,"em",2)(10,B,2,2,"em",2)(11,O,2,2,"em",2),e.k0s()()),2&n&&(e.R7$(),e.Y8G("ngIf",s.teilnehmer.Athlet),e.R7$(),e.Y8G("ngIf",s.teamTeilnehmerSubResults.length>0),e.R7$(),e.Y8G("ngIf",s.teamTeilnehmerSubResults.length>0),e.R7$(),e.Y8G("ngIf",s.teilnehmer.Athlet),e.R7$(3),e.SpI("Total Punkte ",s.teilnehmer["Total Punkte"]),e.R7$(2),e.Y8G("ngIf",s.teilnehmer["\xf8 Ger\xe4t"]),e.R7$(),e.Y8G("ngIf",s.teilnehmer["Total D"]),e.R7$(),e.Y8G("ngIf",s.teilnehmer["Total A"]))},dependencies:[m.Sq,m.bT,c.mC,c.uz,c.he,c.JI],styles:["ion-note[_ngcontent-%COMP%]{text-align:end}"]})}return i})();const U=["athletID","rows","Rang","Athlet","Team","Team/Athlet","Jahrgang","Verein","K","\xf8 Ger\xe4t","Total D","Total E","Total A","Total B","Total Punkte"];function w(i){return`${i.Team} (${i.K}): ${T(i)}`}function T(i){return Object.keys(i).map(o=>`${o}`).filter(o=>U.indexOf(o)<0&&i[o].Endnote).map(o=>`${o}: ${function H(i){let o="",t="";return i["Endnote-styles"].indexOf("best")>=0&&(o="*"),i["Endnote-styles"].indexOf("stroke")>=0&&(t="!"),`${o}${i["Endnote-raw"].trim()}${t}`}(i[o])} (${i[o].Rang.trim()})`).join(", ")}const z=i=>({"gradient-border":i});function W(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-buttons")(1,"ion-button",9),e.bIt("click",function(){l.eBV(t);const s=e.XpG(2);return l.Njj(s.toggleOptions())}),e.nrm(2,"ion-icon",10),e.k0s()()}}function K(i,o){if(1&i&&(e.j41(0,"ion-note",11),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.competitionName()," ")}}function J(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-searchbar",12),e.mxI("ngModelChange",function(s){l.eBV(t);const r=e.XpG(2);return e.DH7(r.sMyQuery,s)||(r.sMyQuery=s),l.Njj(s)}),e.bIt("ionInput",function(s){l.eBV(t);const r=e.XpG(2);return l.Njj(r.reloadList(s))})("ionCancel",function(s){l.eBV(t);const r=e.XpG(2);return l.Njj(r.reloadList(s))}),e.k0s()}if(2&i){const t=e.XpG(2);e.R50("ngModel",t.sMyQuery)}}function Q(i,o){if(1&i&&(e.j41(0,"ion-select-option",20),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const t=o.$implicit;e.Y8G("value",t.uuid),e.R7$(),e.SpI(" ",t.titel+" "+e.i5U(2,2,t.datum,"dd-MM-yy"))}}function q(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-select",18),e.mxI("ngModelChange",function(s){l.eBV(t);const r=e.XpG(3);return e.DH7(r.competition,s)||(r.competition=s),l.Njj(s)}),e.DNE(1,Q,3,5,"ion-select-option",19),e.k0s()}if(2&i){const t=e.XpG(3);e.R50("ngModel",t.competition),e.R7$(),e.Y8G("ngForOf",t.getCompetitions())}}function Z(i,o){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("(atkiv) ",t)}}function ee(i,o){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("(inaktiv) ",t)}}function te(i,o){if(1&i&&(e.j41(0,"ion-select-option",20),e.DNE(1,Z,2,1,"em",1)(2,ee,2,1,"div",1),e.k0s()),2&i){const t=o.$implicit,n=e.XpG(4);e.Y8G("value",t),e.R7$(),e.Y8G("ngIf",n.isDurchgangActiv(t)),e.R7$(),e.Y8G("ngIf",!n.isDurchgangActiv(t))}}function ie(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-select",21),e.mxI("ngModelChange",function(s){l.eBV(t);const r=e.XpG(3);return e.DH7(r.durchgangFilter,s)||(r.durchgangFilter=s),l.Njj(s)}),e.j41(1,"ion-select-option",22),e.EFF(2,"Kein Durchgangfilter"),e.k0s(),e.DNE(3,te,3,3,"ion-select-option",19),e.k0s()}if(2&i){const t=e.XpG(3);e.R50("ngModel",t.durchgangFilter),e.R7$(3),e.Y8G("ngForOf",t.getDurchgaenge())}}function ne(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-list")(1,"ion-item"),e.DNE(2,q,2,2,"ion-select",13),e.k0s(),e.j41(3,"ion-item"),e.DNE(4,ie,4,2,"ion-select",14),e.k0s(),e.j41(5,"ion-item")(6,"ion-select",15),e.mxI("ngModelChange",function(s){l.eBV(t);const r=e.XpG(2);return e.DH7(r.kategorieFilter,s)||(r.kategorieFilter=s),l.Njj(s)}),e.j41(7,"ion-select-option",16),e.EFF(8,"Kategorien getrennt"),e.k0s(),e.j41(9,"ion-select-option",17),e.EFF(10,"Kategorien gemischt"),e.k0s()()(),e.j41(11,"ion-item")(12,"ion-label"),e.EFF(13),e.k0s(),e.j41(14,"ion-button",9),e.bIt("click",function(){l.eBV(t);const s=e.XpG(2);return l.Njj(s.toggleHeader())}),e.EFF(15,"Umschalten"),e.k0s()()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.getCompetitions().length>0),e.R7$(2),e.Y8G("ngIf",t.getDurchgaenge()&&t.getDurchgaenge().length>0),e.R7$(2),e.R50("ngModel",t.kategorieFilter),e.R7$(7),e.SpI("doppel-click wechselt die Position des Toolbars (",t.nextToolbarPosition,")")}}function se(i,o){if(1&i&&(e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",4)(3,"ion-menu-toggle")(4,"ion-button"),e.nrm(5,"ion-icon",5),e.k0s()(),e.DNE(6,W,3,0,"ion-buttons",1),e.k0s(),e.j41(7,"ion-title")(8,"ion-grid",6)(9,"ion-row")(10,"ion-col")(11,"ion-label"),e.EFF(12),e.k0s()()()()(),e.DNE(13,K,2,1,"ion-note",7),e.k0s(),e.DNE(14,J,1,1,"ion-searchbar",8)(15,ne,16,4,"ion-list",1),e.k0s()),2&i){const t=e.XpG();e.R7$(6),e.Y8G("ngIf",!t.scorelistAvailable()),e.R7$(6),e.JRh(t.title),e.R7$(),e.Y8G("ngIf",t.competition),e.R7$(),e.Y8G("ngIf",t.scorelistAvailable()),e.R7$(),e.Y8G("ngIf",t.optionsVisible&&t.isToolbarTop())}}function oe(i,o){if(1&i&&(e.j41(0,"ion-col",25)(1,"div",26),e.nrm(2,"result-display",27),e.k0s()()),2&i){const t=o.$implicit,n=e.XpG(3);e.BMQ("size-xs",n.getColumnSpecs()[0])("size-sm",n.getColumnSpecs()[1])("size-md",n.getColumnSpecs()[2])("size-lg",n.getColumnSpecs()[3])("size-xl",n.getMaxColumnSpec()),e.R7$(),e.Y8G("ngClass",e.eq3(9,z,n.isNew(t))),e.R7$(),e.Y8G("item",t)("title",n.getTitle(t))("groupedBy",n.groupBy.PROGRAMM)}}function re(i,o){if(1&i&&(e.j41(0,"ion-row"),e.DNE(1,oe,3,11,"ion-col",24),e.k0s()),2&i){const t=o.$implicit,n=e.XpG(2);e.R7$(),e.Y8G("ngForOf",n.getWertungen(t))}}function le(i,o){if(1&i&&(e.j41(0,"ion-grid",6),e.DNE(1,re,2,1,"ion-row",23),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.getProgramme())}}function ae(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-item-option",31),e.bIt("click",function(){l.eBV(t);const s=e.XpG().$implicit,r=e.sdS(1),a=e.XpG(3);return l.Njj(a.followAthlet(s,r))}),e.nrm(1,"ion-icon",32),e.EFF(2),e.k0s()}if(2&i){const t=e.XpG().$implicit;e.R7$(2),e.SpI(" Detail-Wertungen ",t.Athlet," ")}}function ce(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-item-sliding",null,0)(2,"scorelist-item",28),e.bIt("click",function(){const s=l.eBV(t).$implicit,r=e.sdS(1),a=e.XpG(3);return l.Njj(a.scoreItemTapped(s,r))}),e.k0s(),e.j41(3,"ion-item-options",29),e.DNE(4,ae,3,1,"ion-item-option",30),e.k0s()()}if(2&i){const t=o.$implicit;e.R7$(2),e.Y8G("teilnehmer",t),e.R7$(2),e.Y8G("ngIf",t.athletID)}}function ue(i,o){if(1&i&&(e.j41(0,"div")(1,"ion-item-divider"),e.EFF(2),e.k0s(),e.DNE(3,ce,5,2,"ion-item-sliding",23),e.k0s()),2&i){const t=o.$implicit;e.R7$(2),e.JRh(t.title.text),e.R7$(),e.Y8G("ngForOf",t.rows)}}function _e(i,o){if(1&i&&(e.j41(0,"ion-list"),e.DNE(1,ue,4,2,"div",23),e.k0s()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngForOf",t.filteredScoreList)}}function ge(i,o){if(1&i&&(e.j41(0,"ion-select-option",20),e.EFF(1),e.nI1(2,"date"),e.k0s()),2&i){const t=o.$implicit;e.Y8G("value",t.uuid),e.R7$(),e.SpI(" ",t.titel+" "+e.i5U(2,2,t.datum,"dd-MM-yy"))}}function he(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-select",18),e.mxI("ngModelChange",function(s){l.eBV(t);const r=e.XpG(3);return e.DH7(r.competition,s)||(r.competition=s),l.Njj(s)}),e.DNE(1,ge,3,5,"ion-select-option",19),e.k0s()}if(2&i){const t=e.XpG(3);e.R50("ngModel",t.competition),e.R7$(),e.Y8G("ngForOf",t.getCompetitions())}}function me(i,o){if(1&i&&(e.j41(0,"em"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("(atkiv) ",t)}}function de(i,o){if(1&i&&(e.j41(0,"div"),e.EFF(1),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(),e.SpI("(inaktiv) ",t)}}function pe(i,o){if(1&i&&(e.j41(0,"ion-select-option",20),e.DNE(1,me,2,1,"em",1)(2,de,2,1,"div",1),e.k0s()),2&i){const t=o.$implicit,n=e.XpG(4);e.Y8G("value",t),e.R7$(),e.Y8G("ngIf",n.isDurchgangActiv(t)),e.R7$(),e.Y8G("ngIf",!n.isDurchgangActiv(t))}}function fe(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-select",21),e.mxI("ngModelChange",function(s){l.eBV(t);const r=e.XpG(3);return e.DH7(r.durchgangFilter,s)||(r.durchgangFilter=s),l.Njj(s)}),e.j41(1,"ion-select-option",22),e.EFF(2,"Kein Durchgangfilter"),e.k0s(),e.DNE(3,pe,3,3,"ion-select-option",19),e.k0s()}if(2&i){const t=e.XpG(3);e.R50("ngModel",t.durchgangFilter),e.R7$(3),e.Y8G("ngForOf",t.getDurchgaenge())}}function be(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-list")(1,"ion-item"),e.DNE(2,he,2,2,"ion-select",13),e.k0s(),e.j41(3,"ion-item"),e.DNE(4,fe,4,2,"ion-select",14),e.k0s(),e.j41(5,"ion-item")(6,"ion-select",15),e.mxI("ngModelChange",function(s){l.eBV(t);const r=e.XpG(2);return e.DH7(r.kategorieFilter,s)||(r.kategorieFilter=s),l.Njj(s)}),e.j41(7,"ion-select-option",16),e.EFF(8,"Kategorien getrennt"),e.k0s(),e.j41(9,"ion-select-option",17),e.EFF(10,"Kategorien gemischt"),e.k0s()()(),e.j41(11,"ion-item")(12,"ion-label"),e.EFF(13),e.k0s(),e.j41(14,"ion-button",9),e.bIt("click",function(){l.eBV(t);const s=e.XpG(2);return l.Njj(s.toggleHeader())}),e.EFF(15,"Umschalten"),e.k0s()()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.Y8G("ngIf",t.getCompetitions().length>0),e.R7$(2),e.Y8G("ngIf",t.getDurchgaenge()&&t.getDurchgaenge().length>0),e.R7$(2),e.R50("ngModel",t.kategorieFilter),e.R7$(7),e.SpI("doppel-click wechselt die Position des Toolbars (",t.nextToolbarPosition,")")}}function ke(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-buttons")(1,"ion-button",9),e.bIt("click",function(){l.eBV(t);const s=e.XpG(2);return l.Njj(s.toggleOptions())}),e.nrm(2,"ion-icon",10),e.k0s()()}}function Re(i,o){if(1&i&&(e.j41(0,"ion-note",11),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(),e.SpI(" ",t.competitionName()," ")}}function Se(i,o){if(1&i&&(e.j41(0,"ion-footer"),e.DNE(1,be,16,4,"ion-list",1),e.j41(2,"ion-toolbar")(3,"ion-buttons",4)(4,"ion-menu-toggle")(5,"ion-button"),e.nrm(6,"ion-icon",5),e.k0s()(),e.DNE(7,ke,3,0,"ion-buttons",1),e.k0s(),e.j41(8,"ion-title")(9,"ion-grid",6)(10,"ion-row")(11,"ion-col")(12,"ion-label"),e.EFF(13),e.k0s()()()()(),e.DNE(14,Re,2,1,"ion-note",7),e.k0s()()),2&i){const t=e.XpG();e.R7$(),e.Y8G("ngIf",t.optionsVisible),e.R7$(6),e.Y8G("ngIf",!t.scorelistAvailable()),e.R7$(6),e.JRh(t.title),e.R7$(),e.Y8G("ngIf",t.competition)}}function Te(i,o){if(1&i){const t=e.RV6();e.j41(0,"ion-footer")(1,"ion-toolbar")(2,"ion-button",33),e.bIt("click",function(){l.eBV(t);const s=e.XpG();return l.Njj(s.presentActionSheet())}),e.nrm(3,"ion-icon",34),e.k0s()()()}}let ve=(()=>{class i{navCtrl;backendService;route;router;actionSheetController;groupBy=R.R;items=[];mixeditems=[];hasCountingItems=void 0;lastItems;geraete=[];scorelinks=[];defaultPath=void 0;scoreblocks=[];sFilteredScoreList=[];sMyQuery;isDNoteUsed=!0;tMyQueryStream=new I.B;sFilterTask=void 0;busy=new x.t(!1);durchgangopen;subscriptions=[];constructor(t,n,s,r,a){this.navCtrl=t,this.backendService=n,this.route=s,this.router=r,this.actionSheetController=a,this.backendService.competitions||this.backendService.getCompetitions(),this.durchgangopen=!1,this.backendService.durchgangStarted.pipe((0,f.p)(u=>void 0!==u),(0,b.T)(u=>u.filter(g=>g.wettkampfUUID===this.backendService.competition).length>0)).subscribe(u=>{this.durchgangopen=u})}ngOnDestroy(){this.subscriptions.forEach(t=>t.unsubscribe()),this.cleanScoreListSubscriptions()}ngOnInit(){this.competition=this.route.snapshot.queryParamMap.get("c")||this.backendService.competition,this.kategorieFilter=this.route.snapshot.queryParamMap.get("k")||"getrennt",this.durchgangFilter=this.route.snapshot.queryParamMap.get("d")||"undefined",this.subscriptions.push(this.backendService.competitionSubject.subscribe(t=>{this.subscriptions.push(this.backendService.newLastResults.pipe((0,f.p)(n=>void 0!==n)).subscribe(n=>this.refreshItems(n)))}))}_optionsVisible=!1;get optionsVisible(){return this._optionsVisible||!this.competition}set optionsVisible(t){this._optionsVisible=t}toggleOptions(){this._optionsVisible=!this._optionsVisible}teamsAllowed(t){return t.teamrule?.trim().length>0&&"Keine Teams"!==t.teamrule}_title="Aktuelle Resultate";get title(){return this._title}set title(t){this._title=t}isNew(t){return 0===this.lastItems.filter(n=>n===t.id*this.geraete.length+t.geraet).length}get stationFreezed(){return this.backendService.stationFreezed}set competition(t){this.stationFreezed||(this.backendService.getDurchgaenge(t),this.router.navigate(["last-results"],{queryParams:{c:this.competition,k:this._kategorieFilter,d:this.backendService.durchgang},queryParamsHandling:"merge"}))}get competition(){return this.backendService.competition||""}getCompetitions(){return this.backendService.competitions||[]}competitionContainer(){const t={titel:"",datum:new Date,auszeichnung:void 0,auszeichnungendnote:void 0,id:void 0,uuid:void 0,programmId:0,teamrule:""};if(!this.backendService.competitions)return t;const n=this.backendService.competitions.filter(s=>s.uuid===this.backendService.competition);return 1===n.length?n[0]:t}competitionName(){const t=this.competitionContainer();return""===t.titel?"":t.titel+", am "+(t.datum+"T").split("T")[0].split("-").reverse().join("-")}geraetOrder(t){return this.geraete?this.geraete.findIndex(n=>n.id===t):0}geraetText(t){if(!this.geraete)return"";const n=this.geraete.filter(s=>s.id===t).map(s=>s.name);return 1===n.length?n[0]:""}getColumnSpec(){return this.geraete?.length||0}getColumnSpecs(){return 6===this.getColumnSpec()?[12,12,6,4,this.getMaxColumnSpec()]:[12,6,6,3,this.getMaxColumnSpec()]}getMaxColumnSpec(){return Math.min(12,Math.max(1,Math.floor(12/this.geraete.length+.5)))}getTitle(t){return t.programm+" - "+this.geraetText(t.geraet)}onlyUnique(t,n,s){return s.indexOf(t)===n}getProgramme(){return"getrennt"===this.kategorieFilter?this.items.map(t=>t.programm).filter(this.onlyUnique):[this.mixeditems.map(t=>t.programm)[0]]}getWertungen(t){return"getrennt"===this.kategorieFilter?this.items.filter(n=>n.programm===t):this.getMixedWertungen()}getMixedWertungen(){return this.mixeditems}getDurchgaenge(){return[...this.backendService.activeDurchgangList.map(t=>t.durchgang),...this.backendService.durchgaenge.filter(t=>!this.isDurchgangActiv(t))]}isDurchgangActiv(t){return void 0!==this.backendService.activeDurchgangList.find(n=>n.durchgang===t)}_durchgang=void 0;set durchgangFilter(t){"undefined"===t?(this.router.navigate(["last-results"],{queryParams:{c:this.competition,k:this._kategorieFilter,d:void 0},queryParamsHandling:"merge"}),this.backendService.getGeraete(this.backendService.competition,void 0).subscribe(n=>{this.geraete=n??[]}),this.backendService.disconnectWS(!0),this.backendService.initWebsocket(),this._durchgang=void 0):(this.router.navigate(["last-results"],{queryParams:{c:this.competition,k:this._kategorieFilter,d:t},queryParamsHandling:"merge"}),this.backendService.getGeraete(this.backendService.competition,t).subscribe(n=>{this.geraete=n??[]}),this.backendService.disconnectWS(!0),this.backendService.initWebsocket(),this._durchgang=t)}get durchgangFilter(){return this._durchgang||"undefined"}_kategorieFilter="getrennt";set kategorieFilter(t){this._kategorieFilter=t,this._kategorieFilter?.trim().length>0?this.router.navigate(["last-results"],{queryParams:{c:this.competition,k:t,d:this.backendService.durchgang},queryParamsHandling:"merge"}):this.router.navigate(["last-results"],{queryParams:{c:this.competition,d:this.backendService.durchgang},queryParamsHandling:"merge"})}get kategorieFilter(){return this._kategorieFilter}hideHeader=0;toggleHeader(){this.scorelistAvailable()||(this.hideHeader=this.hideHeader+=1,this.hideHeader>2&&(this.hideHeader=0))}get nextToolbarPosition(){return 0===this.hideHeader?"von oben nach unten, und dann auf ausgeblendet":1===this.hideHeader?"von unten nach ausgeblendet":"oben"}isToolbarTop(){return 0===this.hideHeader||this.scorelistAvailable()}isToolbarBottom(){return 1===this.hideHeader}isFullscreen(){return 2===this.hideHeader}get isBusy(){return this.busy}refreshItems(t){if(this.lastItems=this.items.map(n=>n.id*this.geraete.length+n.geraet),this.items=[],this.mixeditems=[],this.hasCountingItems=!1,t&&t.resultsPerWkDisz){const n=Object.values(t.resultsPerWkDisz),s=n.map(u=>u.programm).filter(this.onlyUnique),r=s.length>0?s:["\xa0"];n.length>0&&(this.isDNoteUsed=n.findIndex((u,g,h)=>u.isDNoteUsed)>-1);const a=[];r.forEach(u=>{this.geraete.map(g=>n.find(h=>h.geraet===g.id&&h.wertung.endnote&&("\xa0"===u||h.programm===u))||{programm:u,geraet:g.id,id:0,vorname:"\xa0",name:"\xa0",geschlecht:void 0,verein:"\xa0",wertung:{noteE:0,noteD:0,endnote:0,wettkampfdisziplinId:0},isDNoteUsed:this.isDNoteUsed}).forEach(g=>{this.hasCountingItems=this.hasCountingItems||g.wertung.endnote>0,a.push(g)})}),this.items=a,this.mixeditems=this.geraete.map(u=>t.resultsPerDisz[u.id]??{programm:"\xa0",geraet:u.id,id:0,vorname:"\xa0",name:"\xa0",geschlecht:void 0,verein:"\xa0",wertung:{noteE:0,noteD:0,endnote:0,wettkampfdisziplinId:0},isDNoteUsed:!(this.items.length>0)||this.items[0].isDNoteUsed})}this.scorelistAvailable()?this.loadScoreList():this.title="Aktuelle Resultate"}scorelistAvailable(){return void 0!==this.hasCountingItems&&!this.durchgangopen&&!this.hasCountingItems&&new Date(this.competitionContainer().datum).getTime()<new Date(Date.now()-864e5).getTime()}get filteredScoreList(){return this.sFilteredScoreList?.length>0?this.sFilteredScoreList:this.getScoreListItems()}loadScoreList(){console.log("loadScoreLists"),this.backendService.getScoreLists().subscribe(t=>{const n=this.competitionContainer();let s="";n.altersklassen&&n.altersklassen.trim().length>0?s=":Wettkampf%20Altersklassen":n.jahrgangsklassen&&n.jahrgangsklassen.trim().length>0&&(s=":Wettkampf%20JG-Altersklassen");const r=`/api/scores/${n.uuid}/query?groupby=Kategorie${s}:Geschlecht`;if(t){const u=Object.values(t).filter(d=>"Zwischenresultate"!=d.name).sort((d,je)=>d.name.localeCompare(je.name)),g={name:"Generische Rangliste",published:!0,"published-date":"","scores-href":r,"scores-query":r},h={name:"Generische Team-Rangliste",published:!0,"published-date":"","scores-href":`/api/scores/${n.uuid}/query?kind=Teamrangliste`,"scores-query":`/api/scores/${n.uuid}/query?kind=Teamrangliste`};this.scorelinks=this.teamsAllowed(n)?[...u,h,g]:[...u,g];const Ge=this.scorelinks.filter(d=>""+d.published=="true");this.refreshScoreList(Ge[0])}})}_scorelistSubscription=[];cleanScoreListSubscriptions(){this._scorelistSubscription.forEach(t=>t.unsubscribe()),this._scorelistSubscription=[]}refreshScoreList(t){console.log("refreshScoreList",t);let n=t["scores-href"];t.published||(n=t["scores-query"]),n.startsWith("/")&&(n=n.substring(1)),n=n.replace("html",""),this._optionsVisible=!1,this.title=t.name,this.defaultPath=n,this._scorelistSubscription.push(this.backendService.getScoreList(this.defaultPath).pipe((0,b.T)(s=>s.title&&s.scoreblocks?s.scoreblocks:[])).subscribe(s=>{this.scoreblocks=s,this.sFilteredScoreList=s,this.cleanScoreListSubscriptions();const r=this.tMyQueryStream.pipe((0,f.p)(a=>!!a&&!!a.target&&!!a.target.value),(0,b.T)(a=>a.target.value),(0,j.B)(1e3),(0,C.F)(),(0,$.u)());this._scorelistSubscription.push(r.subscribe(()=>{this.busy.next(!0)})),this._scorelistSubscription.push(r.pipe((0,L.n)(this.runQuery(this.scoreblocks))).subscribe(a=>{console.log("filteredList retrieved",a),this.sFilteredScoreList=a,this.busy.next(!1)}))}))}runQuery(t){return n=>{const s=n.trim();let r=[];return s&&t&&t.forEach(a=>{const u=this.filter(s),g=a.rows.filter(h=>u(h,a));if(g.length>0){const h={title:a.title,rows:g};r=[...r,h]}}),(0,G.of)(r)}}filter(t){const n=t.toUpperCase(),s=n.split(" ");return(r,a)=>a.title.text.toUpperCase().indexOf(n)>-1||s.filter(u=>[r,...r.rows].find(g=>{if(g.Athlet?.toUpperCase().indexOf(u)>-1||g["Team/Athlet"]?.toUpperCase().indexOf(u)>-1||g.Team?.toUpperCase().indexOf(u)>-1||g.Verein?.toUpperCase().indexOf(u)>-1||g.Jahrgang?.toUpperCase()===u||a.title.text.toUpperCase().replace("."," ").replace(","," ").split(" ").indexOf(u)>-1)return!0})).length===s.length}reloadList(t){this.tMyQueryStream.next(t)}makeGenericScoreListLink(){return`${D.EV}${this.defaultPath}&html`}getScoreListItems(){return this.scoreblocks}scoreItemTapped(t,n){n.getOpenAmount().then(s=>{s>0?n.close():n.open("end")})}followAthlet(t,n){n.close(),t.athletID&&this.navCtrl.navigateForward(`athlet-view/${this.backendService.competition}/${t.athletID}`)}open(){window.open(this.makeGenericScoreListLink(),"_blank")}isShareAvailable(){return!!navigator&&!!navigator.share}share(){let t="GeTu";const s=this.competitionContainer();""!==s.titel&&(t={1:"Athletik",11:"KuTu",20:"GeTu",31:"KuTu"}[s.programmId]);let r=`${this.competitionName()} #${t}-${s.titel.replace(","," ").split(" ").join("_")}`;this.isShareAvailable()&&navigator.share({title:`${t} Rangliste`,text:r,url:this.makeGenericScoreListLink()}).then(function(){console.log("Article shared")}).catch(function(a){console.log(a.message)})}presentActionSheet(){var t=this;return(0,F.A)(function*(){let n=[...t.scorelinks.map(a=>""+a.published=="true"?{text:`${a.name} anzeigen ...`,icon:"document",handler:()=>{t.refreshScoreList(a)}}:{text:`${a.name} (unver\xf6ffentlicht)`,icon:"today-outline",handler:()=>{t.refreshScoreList(a)}}),{text:"Rangliste \xf6ffnen ...",icon:"open",handler:()=>{t.open()}}];t.isShareAvailable()&&(n=[...n,{text:"Teilen / Share ...",icon:"share",handler:()=>{t.share()}}]);let s={header:"Aktionen",cssClass:"my-actionsheet-class",buttons:n};yield(yield t.actionSheetController.create(s)).present()})()}static \u0275fac=function(n){return new(n||i)(e.rXU(E.q9),e.rXU(P.m),e.rXU(S.nX),e.rXU(S.Ix),e.rXU(c.GD))};static \u0275cmp=e.VBU({type:i,selectors:[["app-last-results"]],standalone:!1,decls:6,vars:5,consts:[["slidingAthletScoreItem",""],[4,"ngIf"],[3,"dblclick","click"],["no-padding","",4,"ngIf"],["slot","start"],["slot","icon-only","name","menu"],["no-padding",""],["slot","end",4,"ngIf"],["placeholder","Search","showCancelButton","never",3,"ngModel","ngModelChange","ionInput","ionCancel",4,"ngIf"],[3,"click"],["slot","icon-only","name","options"],["slot","end"],["placeholder","Search","showCancelButton","never",3,"ngModelChange","ionInput","ionCancel","ngModel"],["label","Wettkampf","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["label","Durchgang","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["label","Kategorien","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["value","getrennt"],["value","gemischt"],["label","Wettkampf","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["label","Durchgang","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],["value","undefined"],[4,"ngFor","ngForOf"],["class","align-self-start",4,"ngFor","ngForOf"],[1,"align-self-start"],[3,"ngClass"],[3,"item","title","groupedBy"],[3,"click","teilnehmer"],["side","end"],["color","primary",3,"click",4,"ngIf"],["color","primary",3,"click"],["name","arrow-forward-circle-outline","ios","md-arrow-forward-circle-outline"],["size","large","expand","block","color","primary",3,"click"],["slot","start","name","list"]],template:function(n,s){1&n&&(e.DNE(0,se,16,5,"ion-header",1),e.j41(1,"ion-content",2),e.bIt("dblclick",function(){return s.toggleHeader()})("click",function(){return s.optionsVisible=!1}),e.DNE(2,le,2,1,"ion-grid",3)(3,_e,2,1,"ion-list",1),e.k0s(),e.DNE(4,Se,15,4,"ion-footer",1)(5,Te,4,0,"ion-footer",1)),2&n&&(e.Y8G("ngIf",s.isToolbarTop()),e.R7$(2),e.Y8G("ngIf",!s.scorelistAvailable()),e.R7$(),e.Y8G("ngIf",s.scorelistAvailable()),e.R7$(),e.Y8G("ngIf",!s.scorelistAvailable()&&s.isToolbarBottom()),e.R7$(),e.Y8G("ngIf",s.scorelistAvailable()))},dependencies:[m.YU,m.Sq,m.bT,p.BC,p.vS,c.Jm,c.QW,c.hU,c.W9,c.M0,c.lO,c.eU,c.iq,c.uz,c.Dg,c.LU,c.CE,c.A7,c.he,c.nf,c.cA,c.JI,c.ln,c.S1,c.Nm,c.Ip,c.BC,c.ai,c.Je,c.Gw,R.v,V,m.vh],encapsulation:2})}return i})();var Fe=_(5079);const Ie=[{path:"",component:ve}];let xe=(()=>{class i{static \u0275fac=function(n){return new(n||i)};static \u0275mod=e.$C({type:i});static \u0275inj=l.G2t({imports:[m.MD,p.YN,c.bv,v.iI.forChild(Ie),Fe.h]})}return i})()}}]);