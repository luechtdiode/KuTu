"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1618],{1618:(z,u,a)=>{a.r(u),a.d(u,{RegAthletlistPageModule:()=>Q});var h=a(2200),m=a(4341),R=a(8132),r=a(9893),c=a(2615),v=a(5035),b=a(1266),C=a(2350),k=a(4412),A=a(1413),I=a(7673),p=a(6697),f=a(5964),F=a(6354),_=a(152),y=a(3294),S=a(8141),x=a(5558),M=a(7647),t=a(3664),d=a(7705);function T(s,g){if(1&s&&(t.j41(0,"ion-col")(1,"small"),t.EFF(2),t.k0s()()),2&s){const e=t.XpG();t.R7$(2),t.JRh(e.getTeamText())}}let P=(()=>{class s{constructor(){}athletregistration=(0,d.hFB)(void 0);vereinregistration=(0,d.hFB)(void 0);status=(0,d.hFB)(void 0);programmlist=(0,d.hFB)(void 0);teams=(0,d.hFB)(void 0);selected=(0,d.CGW)();statusBadgeColor(){return"in sync"===this.status()?"success":"warning"}statusComment(){const e=this.status();return"in sync"===e?"":e.substring(e.indexOf("(")+1,e.length-1)}statusBadgeText(){const e=this.status();return"in sync"===e?"\u2714 "+e:"\u2757 "+e.substring(0,e.indexOf("(")-1)}ngOnInit(){}getProgrammText(){const e=this.programmlist().find(i=>i.id===this.athletregistration().programId);return e?e.name:"..."}mapTeam(e){return[...this.teams().filter(i=>i.name?.trim().length>0&&i.index==e).map(i=>i.index>0?i.name+" "+i.index:i.name),""][0]}getTeamText(){if(this.athletregistration().team){const i=this.getProgrammText();return"Team "+this.mapTeam(this.athletregistration().team)+" (bei "+this.athletregistration().geschlecht+"/"+i+")"}return""}static \u0275fac=function(i){return new(i||s)};static \u0275cmp=t.VBU({type:s,selectors:[["app-reg-athlet-item"]],inputs:{athletregistration:[1,"athletregistration"],vereinregistration:[1,"vereinregistration"],status:[1,"status"],programmlist:[1,"programmlist"],teams:[1,"teams"]},outputs:{selected:"selected"},standalone:!1,decls:19,vars:10,consts:[[3,"click"],["slot","start"],["src","assets/imgs/athlete.png"],["no-padding",""],["slot","end",3,"color"]],template:function(i,n){1&i&&(t.j41(0,"ion-item",0),t.bIt("click",function(){return n.selected?n.selected.emit(n.athletregistration()):{}}),t.j41(1,"ion-avatar",1),t.nrm(2,"img",2),t.k0s(),t.j41(3,"ion-grid",3)(4,"ion-row")(5,"ion-col")(6,"ion-label"),t.EFF(7),t.nrm(8,"br"),t.j41(9,"small"),t.EFF(10),t.nI1(11,"date"),t.k0s()()()(),t.j41(12,"ion-row"),t.nVh(13,T,3,1,"ion-col"),t.k0s()(),t.j41(14,"ion-badge",4),t.EFF(15),t.nrm(16,"br"),t.j41(17,"small"),t.EFF(18),t.k0s()()()),2&i&&(t.R7$(7),t.E5c("",n.athletregistration().name,", ",n.athletregistration().vorname," (",n.athletregistration().geschlecht,")"),t.R7$(3),t.SpI("(",t.bMT(11,8,n.athletregistration().gebdat),")"),t.R7$(3),t.vxM(0!=n.athletregistration().team?13:-1),t.R7$(),t.Y8G("color",n.statusBadgeColor()),t.R7$(),t.JRh(n.statusBadgeText()),t.R7$(3),t.JRh(n.statusComment()))},dependencies:[r.mC,r.In,r.hU,r.lO,r.uz,r.he,r.ln,h.vh],encapsulation:2})}return s})();function j(s,g){if(1&s&&(t.j41(0,"ion-select-option",9),t.EFF(1),t.nI1(2,"date"),t.k0s()),2&s){const e=g.$implicit;t.Y8G("value",e.uuid),t.R7$(),t.SpI(" ",e.titel+" "+t.i5U(2,2,e.datum,"dd-MM-yy"))}}function $(s,g){if(1&s){const e=t.RV6();t.j41(0,"ion-select",8),t.mxI("ngModelChange",function(n){c.eBV(e);const o=t.XpG(2);return t.DH7(o.competition,n)||(o.competition=n),c.Njj(n)}),t.Z7z(1,j,3,5,"ion-select-option",9,t.fX1),t.k0s()}if(2&s){const e=t.XpG(2);t.R50("ngModel",e.competition),t.R7$(),t.Dyx(e.getCompetitions())}}function B(s,g){if(1&s&&(t.j41(0,"ion-col")(1,"ion-item"),t.nVh(2,$,3,1,"ion-select",7),t.k0s()()),2&s){const e=t.XpG();t.R7$(2),t.vxM(e.getCompetitions().length>0?2:-1)}}function L(s,g){if(1&s&&(t.j41(0,"ion-note",4),t.EFF(1),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.SpI(" ",e.competitionName()," ")}}function E(s,g){1&s&&(t.j41(0,"ion-item")(1,"ion-label"),t.EFF(2,"loading ..."),t.k0s(),t.nrm(3,"ion-spinner"),t.k0s())}function G(s,g){if(1&s){const e=t.RV6();t.j41(0,"ion-item-option",15),t.bIt("click",function(){c.eBV(e);const n=t.XpG().$implicit,o=t.sdS(1),l=t.XpG(3);return c.Njj(l.delete(n,o))}),t.nrm(1,"ion-icon",13),t.EFF(2," L\xf6schen "),t.k0s()}}function X(s,g){if(1&s){const e=t.RV6();t.j41(0,"ion-item-sliding",null,0)(2,"app-reg-athlet-item",10),t.bIt("click",function(){const n=c.eBV(e).$implicit,o=t.sdS(1),l=t.XpG(3);return c.Njj(l.itemTapped(n,o))}),t.k0s(),t.j41(3,"ion-item-options",11)(4,"ion-item-option",12),t.bIt("click",function(){const n=c.eBV(e).$implicit,o=t.sdS(1),l=t.XpG(3);return c.Njj(l.edit(n,o))}),t.nrm(5,"ion-icon",13),t.EFF(6),t.k0s(),t.nVh(7,G,3,0,"ion-item-option",14),t.k0s()()}if(2&s){const e=g.$implicit,i=t.XpG(3);t.R7$(2),t.Y8G("athletregistration",e)("vereinregistration",i.currentRegistration)("status",i.getStatus(e))("programmlist",i.wkPgms)("teams",i.teams),t.R7$(4),t.SpI(" ",i.isLoggedInAsClub()?"Bearbeiten":i.isLoggedIn()?"Best\xe4tigen":"Anzeigen"," "),t.R7$(),t.vxM(i.isLoggedInAsClub()?7:-1)}}function V(s,g){if(1&s&&(t.j41(0,"div")(1,"ion-item-divider"),t.EFF(2),t.k0s(),t.Z7z(3,X,8,7,"ion-item-sliding",null,t.fX1),t.k0s()),2&s){const e=g.$implicit,i=t.XpG(2);t.R7$(2),t.JRh(e.name),t.R7$(),t.Dyx(i.filteredStartList(e.id))}}function N(s,g){if(1&s&&(t.j41(0,"ion-content")(1,"ion-list"),t.nVh(2,E,4,0,"ion-item"),t.nI1(3,"async"),t.Z7z(4,V,5,1,"div",null,t.fX1),t.k0s()()),2&s){const e=t.XpG();t.R7$(2),t.vxM(t.bMT(3,1,e.busy)||!(e.competition&&e.currentRegistration&&e.filteredPrograms)?2:-1),t.R7$(2),t.Dyx(e.filteredPrograms)}}function O(s,g){if(1&s){const e=t.RV6();t.j41(0,"ion-button",16),t.bIt("click",function(){c.eBV(e);const n=t.XpG();return c.Njj(n.createRegistration())}),t.nrm(1,"ion-icon",17),t.EFF(2," Neue Anmeldung... "),t.k0s()}}const w=[{path:"",component:(()=>{class s{navCtrl=(0,c.WQX)(v.q9);route=(0,c.WQX)(b.nX);backendService=(0,c.WQX)(C.m);alertCtrl=(0,c.WQX)(r.hG);busy=new k.t(!1);currentRegistration;teams;currentRegId;wkPgms;tMyQueryStream=new A.B;sFilterTask=void 0;sFilteredRegistrationList;sAthletRegistrationList;sMyQuery;sSyncActions=[];constructor(){this.backendService.competitions||this.backendService.getCompetitions()}ngOnInit(){this.busy.next(!0);const e=this.route.snapshot.paramMap.get("wkId");this.currentRegId=parseInt(this.route.snapshot.paramMap.get("regId")),e?this.competition=e:this.backendService.competition&&(this.competition=this.backendService.competition)}ionViewWillEnter(){this.refreshList()}getSyncActions(){this.backendService.loadRegistrationSyncActions().pipe((0,p.s)(1)).subscribe(e=>{this.sSyncActions=e})}getStatus(e){if(this.sSyncActions){const i=this.sSyncActions.find(n=>n.verein.id===e.vereinregistrationId&&n.caption.indexOf(e.name)>-1&&n.caption.indexOf(e.vorname)>-1);return i?"pending ("+i.caption.substring(0,(i.caption+":").indexOf(":"))+")":"in sync"}return"n/a"}refreshList(){this.busy.next(!0),this.currentRegistration=void 0,this.getSyncActions(),this.backendService.getClubRegistrations(this.competition).pipe((0,f.p)(e=>!!e.find(i=>i.id===this.currentRegId)),(0,p.s)(1)).subscribe(e=>{this.currentRegistration=e.find(i=>i.id===this.currentRegId),this.backendService.loadTeamsListForClub(this.competition,this.currentRegId).subscribe(i=>{this.teams=i}),console.log("ask athletes-list for registration"),this.backendService.loadAthletRegistrations(this.competition,this.currentRegId).subscribe(i=>{this.busy.next(!1),this.athletregistrations=i,this.tMyQueryStream.pipe((0,f.p)(o=>!!o&&!!o.target),(0,F.T)(o=>o.target.value||"*"),(0,_.B)(300),(0,y.F)(),(0,S.M)(o=>this.busy.next(!0)),(0,x.n)(this.runQuery(i)),(0,M.u)()).subscribe(o=>{this.sFilteredRegistrationList=o,this.busy.next(!1)})})})}set competition(e){(!this.currentRegistration||e!==this.backendService.competition)&&this.backendService.loadProgramsForCompetition(this.competition).subscribe(i=>{this.wkPgms=i})}get competition(){return this.backendService.competition||""}getCompetitions(){return this.backendService.competitions||[]}competitionName(){return this.backendService.competitionName}runQuery(e){return i=>{const n=i.trim(),o=new Map;return e&&e.forEach(l=>{if(this.filter(n)(l)){const D=o.get(l.programId)||[];o.set(l.programId,[...D,l].sort((W,U)=>W.name.localeCompare(U.name)))}}),(0,I.of)(o)}}set athletregistrations(e){this.sAthletRegistrationList=e,this.runQuery(e)("*").subscribe(i=>this.sFilteredRegistrationList=i),this.reloadList(this.sMyQuery||"*")}get athletregistrations(){return this.sAthletRegistrationList}get filteredPrograms(){return[...this.wkPgms.filter(e=>this.sFilteredRegistrationList?.has(e.id))]}mapProgram(e){return this.wkPgms.filter(i=>i.id==e)[0]}filteredStartList(e){return this.sFilteredRegistrationList?.get(e)||this.sAthletRegistrationList||[]}reloadList(e){this.tMyQueryStream.next(e)}itemTapped(e,i){i.getOpenAmount().then(n=>{n>0?i.close():i.open("end")})}isLoggedInAsClub(){return this.backendService.loggedIn&&this.backendService.authenticatedClubId===this.currentRegId+""}isLoggedInAsAdmin(){return this.backendService.loggedIn&&!!this.backendService.authenticatedClubId}isLoggedIn(){return this.backendService.loggedIn}filter(e){const i=e.toUpperCase().split(" ");return n=>"*"===e.trim()||i.filter(o=>{if(n.name.toUpperCase().indexOf(o)>-1||n.vorname.toUpperCase().indexOf(o)>-1||this.wkPgms.find(l=>n.programId===l.id&&l.name===o)||n.gebdat.indexOf(o)>-1||3==o.length&&n.geschlecht.indexOf(o.substring(1,2))>-1)return!0}).length===i.length}createRegistration(){this.navCtrl.navigateForward(`reg-athletlist/${this.backendService.competition}/${this.currentRegId}/0`)}edit(e,i){this.navCtrl.navigateForward(`reg-athletlist/${this.backendService.competition}/${this.currentRegId}/${e.id}`),i.close()}needsPGMChoice(){const e=[...this.wkPgms][0];return!(1==e.aggregate&&e.riegenmode>1)}similarRegistration(e,i){return e.athletId===i.athletId||e.name===i.name&&e.vorname===i.vorname&&e.gebdat===i.gebdat&&e.geschlecht===i.geschlecht}delete(e,i){i.close(),this.alertCtrl.create({header:"Achtung",subHeader:"L\xf6schen der Athlet-Anmeldung am Wettkampf",message:"Hiermit wird die Anmeldung von "+e.name+", "+e.vorname+" am Wettkampf gel\xf6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.needsPGMChoice()||this.athletregistrations.filter(o=>this.similarRegistration(o,e)).filter(o=>o.id!==e.id).forEach(o=>{this.backendService.deleteAthletRegistration(this.backendService.competition,this.currentRegId,o)}),this.backendService.deleteAthletRegistration(this.backendService.competition,this.currentRegId,e).subscribe(()=>{this.refreshList()})}}]}).then(o=>o.present())}static \u0275fac=function(i){return new(i||s)};static \u0275cmp=t.VBU({type:s,selectors:[["app-reg-athletlist"]],standalone:!1,decls:18,vars:5,consts:[["slidingAthletRegistrationItem",""],["slot","start"],["defaultHref","/"],["no-padding",""],["slot","end"],["placeholder","Search","showCancelButton","never",3,"ngModelChange","ionInput","ionCancel","ngModel"],["size","large","expand","block","color","success"],["label","Wettkampf","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel"],["label","Wettkampf","placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModelChange","ngModel"],[3,"value"],[3,"click","athletregistration","vereinregistration","status","programmlist","teams"],["side","end"],["color","primary",3,"click"],["name","arrow-forward-circle-outline","ios","md-arrow-forward-circle-outline"],["color","danger"],["color","danger",3,"click"],["size","large","expand","block","color","success",3,"click"],["slot","start","name","add"]],template:function(i,n){1&i&&(t.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1),t.nrm(3,"ion-back-button",2),t.k0s(),t.j41(4,"ion-title")(5,"ion-grid",3)(6,"ion-row")(7,"ion-col")(8,"ion-label"),t.EFF(9,"Angemeldete Athleten/Athletinnen"),t.k0s()(),t.nVh(10,B,3,1,"ion-col"),t.k0s()()(),t.nVh(11,L,2,1,"ion-note",4),t.k0s(),t.j41(12,"ion-searchbar",5),t.mxI("ngModelChange",function(l){return t.DH7(n.sMyQuery,l)||(n.sMyQuery=l),l}),t.bIt("ionInput",function(l){return n.reloadList(l)})("ionCancel",function(l){return n.reloadList(l)}),t.k0s()(),t.nVh(13,N,6,3,"ion-content"),t.j41(14,"ion-footer")(15,"ion-toolbar")(16,"ion-list"),t.nVh(17,O,3,0,"ion-button",6),t.k0s()()()),2&i&&(t.R7$(10),t.vxM(n.competition?-1:10),t.R7$(),t.vxM(n.competition?11:-1),t.R7$(),t.R50("ngModel",n.sMyQuery),t.R7$(),t.vxM(n.wkPgms&&n.wkPgms.length>0?13:-1),t.R7$(4),t.vxM(n.isLoggedInAsClub()?17:-1))},dependencies:[m.BC,m.vS,r.Jm,r.QW,r.hU,r.W9,r.M0,r.lO,r.eU,r.iq,r.uz,r.Dg,r.LU,r.CE,r.A7,r.he,r.nf,r.JI,r.ln,r.S1,r.Nm,r.Ip,r.w2,r.BC,r.ai,r.Je,r.Gw,r.el,P,h.Jj,h.vh],encapsulation:2})}return s})()}];let Q=(()=>{class s{static \u0275fac=function(i){return new(i||s)};static \u0275mod=t.$C({type:s});static \u0275inj=c.G2t({imports:[h.MD,m.YN,r.bv,R.iI.forChild(w)]})}return s})()}}]);