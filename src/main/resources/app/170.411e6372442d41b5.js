"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[170],{170:(O,d,l)=>{l.r(d),l.d(d,{RegAthletlistPageModule:()=>F});var g=l(9808),h=l(2382),u=l(8759),o=l(7674),f=l(1135),A=l(7579),b=l(9646),m=l(5698),p=l(9300),v=l(4004),x=l(8372),R=l(1884),I=l(8505),Z=l(3900),C=l(3099),t=l(7587),T=l(600);let k=(()=>{class n{constructor(){this.selected=new t.vpe}ngOnInit(){}getProgrammText(e){const i=this.programmlist.find(r=>r.id===e);return i?i.name:"..."}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-reg-athlet-item"]],inputs:{athletregistration:"athletregistration",status:"status",programmlist:"programmlist"},outputs:{selected:"selected"},decls:13,vars:8,consts:[[3,"click"],["slot","start"],["src","assets/imgs/athlete.png"],["slot","end"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-item",0),t.NdJ("click",function(){return i.selected?i.selected.emit(i.athletregistration):{}}),t.TgZ(1,"ion-avatar",1),t._UZ(2,"img",2),t.qZA(),t.TgZ(3,"ion-label"),t._uU(4),t._UZ(5,"br"),t.TgZ(6,"small"),t._uU(7),t.ALo(8,"date"),t.qZA()(),t.TgZ(9,"ion-note",3),t._uU(10," Programm/Kategorie"),t._UZ(11,"br"),t._uU(12),t.qZA()()),2&e&&(t.xp6(4),t.lnq("",i.athletregistration.name,", ",i.athletregistration.vorname," (",i.athletregistration.geschlecht,")"),t.xp6(3),t.hij("(",t.lcZ(8,6,i.athletregistration.gebdat),")"),t.xp6(5),t.AsE("",i.getProgrammText(i.athletregistration.programId),", ",i.status," "))},directives:[o.Ie,o.BJ,o.Q$,o.uN],pipes:[g.uU],styles:[""]}),n})();function y(n,c){if(1&n&&(t.TgZ(0,"ion-select-option",10),t._uU(1),t.ALo(2,"date"),t.qZA()),2&n){const e=c.$implicit;t.Q6J("value",e.uuid),t.xp6(1),t.hij(" ",e.titel+" "+t.xi3(2,2,e.datum,"dd-MM-yy"),"")}}function S(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"ion-select",8),t.NdJ("ngModelChange",function(r){return t.CHM(e),t.oxw(2).competition=r}),t.YNc(1,y,3,5,"ion-select-option",9),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("ngModel",e.competition),t.xp6(1),t.Q6J("ngForOf",e.getCompetitions())}}function P(n,c){if(1&n&&(t.TgZ(0,"ion-col")(1,"ion-item")(2,"ion-label"),t._uU(3,"Wettkampf"),t.qZA(),t.YNc(4,S,2,2,"ion-select",7),t.qZA()()),2&n){const e=t.oxw();t.xp6(4),t.Q6J("ngIf",e.getCompetitions().length>0)}}function M(n,c){if(1&n&&(t.TgZ(0,"ion-note",11),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.competitionName()," ")}}function U(n,c){1&n&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2,"loading ..."),t.qZA(),t._UZ(3,"ion-spinner"),t.qZA())}function L(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item-option",19),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().$implicit,s=t.MAs(1);return t.oxw(2).delete(r,s)}),t._UZ(1,"ion-icon",17),t._uU(2," L\xf6schen "),t.qZA()}}function Q(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item-sliding",null,13)(2,"app-reg-athlet-item",14),t.NdJ("click",function(){const s=t.CHM(e).$implicit,a=t.MAs(1);return t.oxw(2).itemTapped(s,a)}),t.qZA(),t.TgZ(3,"ion-item-options",15)(4,"ion-item-option",16),t.NdJ("click",function(){const s=t.CHM(e).$implicit,a=t.MAs(1);return t.oxw(2).edit(s,a)}),t._UZ(5,"ion-icon",17),t._uU(6),t.qZA(),t.YNc(7,L,3,0,"ion-item-option",18),t.qZA()()}if(2&n){const e=c.$implicit,i=t.oxw(2);t.xp6(2),t.Q6J("athletregistration",e)("status",i.getStatus(e))("programmlist",i.wkPgms),t.xp6(4),t.hij(" ",i.isLoggedInAsClub()?"Bearbeiten":i.isLoggedIn()?"Best\xe4tigen":"Anzeigen"," "),t.xp6(1),t.Q6J("ngIf",i.isLoggedInAsClub())}}function J(n,c){if(1&n&&(t.TgZ(0,"ion-content")(1,"ion-list"),t.YNc(2,U,4,0,"ion-item",3),t.ALo(3,"async"),t.YNc(4,Q,8,5,"ion-item-sliding",12),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",t.lcZ(3,2,e.busy)||!(e.competition&&e.currentRegistration&&e.sAthletRegistrationList)),t.xp6(2),t.Q6J("ngForOf",e.filteredStartList)}}function N(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",20),t.NdJ("click",function(){return t.CHM(e),t.oxw().createRegistration()}),t._UZ(1,"ion-icon",21),t._uU(2," Neue Anmeldung... "),t.qZA()}}const w=[{path:"",component:(()=>{class n{constructor(e,i,r,s){this.navCtrl=e,this.route=i,this.backendService=r,this.alertCtrl=s,this.busy=new f.X(!1),this.tMyQueryStream=new A.x,this.sFilterTask=void 0,this.sSyncActions=[],this.backendService.competitions||this.backendService.getCompetitions()}ngOnInit(){this.busy.next(!0);const e=this.route.snapshot.paramMap.get("wkId");this.currentRegId=parseInt(this.route.snapshot.paramMap.get("regId")),e?this.competition=e:this.backendService.competition&&(this.competition=this.backendService.competition)}ionViewWillEnter(){this.refreshList()}getSyncActions(){this.backendService.loadRegistrationSyncActions().pipe((0,m.q)(1)).subscribe(e=>{this.sSyncActions=e})}getStatus(e){return this.sSyncActions?this.sSyncActions.find(r=>r.verein.id===e.vereinregistrationId&&r.caption.indexOf(e.name)>-1&&r.caption.indexOf(e.vorname)>-1)?"pending":"in sync":"n/a"}refreshList(){this.busy.next(!0),this.currentRegistration=void 0,this.getSyncActions(),this.backendService.getClubRegistrations(this.competition).pipe((0,p.h)(e=>!!e.find(i=>i.id===this.currentRegId)),(0,m.q)(1)).subscribe(e=>{this.currentRegistration=e.find(i=>i.id===this.currentRegId),console.log("ask athletes-list for registration"),this.backendService.loadAthletRegistrations(this.competition,this.currentRegId).subscribe(i=>{this.busy.next(!1),this.athletregistrations=i,this.tMyQueryStream.pipe((0,p.h)(s=>!!s&&!!s.target),(0,v.U)(s=>s.target.value||"*"),(0,x.b)(300),(0,R.x)(),(0,I.b)(s=>this.busy.next(!0)),(0,Z.w)(this.runQuery(i)),(0,C.B)()).subscribe(s=>{this.sFilteredRegistrationList=s,this.busy.next(!1)})})})}set competition(e){(!this.currentRegistration||e!==this.backendService.competition)&&this.backendService.loadProgramsForCompetition(this.competition).subscribe(i=>{this.wkPgms=i})}get competition(){return this.backendService.competition||""}getCompetitions(){return this.backendService.competitions||[]}competitionName(){return this.backendService.competitionName}runQuery(e){return i=>{const r=i.trim(),s=[];return r&&e&&e.forEach(a=>{this.filter(r)(a)&&s.push(a)}),(0,b.of)(s)}}set athletregistrations(e){this.sAthletRegistrationList=e,this.reloadList(this.sMyQuery)}get athletregistrations(){return this.sAthletRegistrationList}get filteredStartList(){return this.sFilteredRegistrationList||this.sAthletRegistrationList||[]}reloadList(e){this.tMyQueryStream.next(e)}itemTapped(e,i){i.getOpenAmount().then(r=>{r>0?i.close():i.open("end")})}isLoggedInAsClub(){return this.backendService.loggedIn&&this.backendService.authenticatedClubId===this.currentRegId+""}isLoggedInAsAdmin(){return this.backendService.loggedIn&&!!this.backendService.authenticatedClubId}isLoggedIn(){return this.backendService.loggedIn}filter(e){const i=e.toUpperCase().split(" ");return r=>"*"===e.trim()||i.filter(s=>{if(r.name.toUpperCase().indexOf(s)>-1||r.vorname.toUpperCase().indexOf(s)>-1||this.wkPgms.find(a=>r.programId===a.id&&a.name===s)||r.gebdat.indexOf(s)>-1)return!0}).length===i.length}createRegistration(){this.navCtrl.navigateForward(`reg-athletlist/${this.backendService.competition}/${this.currentRegId}/0`)}edit(e,i){this.navCtrl.navigateForward(`reg-athletlist/${this.backendService.competition}/${this.currentRegId}/${e.id}`),i.close()}delete(e,i){i.close(),this.alertCtrl.create({header:"Achtung",subHeader:"L\xf6schen der Athlet-Anmeldung am Wettkampf",message:"Hiermit wird die Anmeldung von "+e.name+", "+e.vorname+" am Wettkampf gel\xf6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.deleteAthletRegistration(this.backendService.competition,this.currentRegId,e).subscribe(()=>{this.refreshList()})}}]}).then(s=>s.present())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(o.SH),t.Y36(u.gz),t.Y36(T.v),t.Y36(o.Br))},n.\u0275cmp=t.Xpm({type:n,selectors:[["app-reg-athletlist"]],decls:18,vars:5,consts:[["slot","start"],["defaultHref","/"],["no-padding",""],[4,"ngIf"],["slot","end",4,"ngIf"],["placeholder","Search","showCancelButton","never",3,"ngModel","ngModelChange","ionInput","ionCancel"],["size","large","expand","block","color","success",3,"click",4,"ngIf"],["placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["slot","end"],[4,"ngFor","ngForOf"],["slidingAthletRegistrationItem",""],[3,"athletregistration","status","programmlist","click"],["side","end"],["color","primary",3,"click"],["name","arrow-dropright-circle","ios","md-arrow-dropright-circle"],["color","danger",3,"click",4,"ngIf"],["color","danger",3,"click"],["size","large","expand","block","color","success",3,"click"],["slot","start","name","add"]],template:function(e,i){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title")(5,"ion-grid",2)(6,"ion-row")(7,"ion-col")(8,"ion-label"),t._uU(9,"Angemeldete Athleten/Athletinnen"),t.qZA()(),t.YNc(10,P,5,1,"ion-col",3),t.qZA()()(),t.YNc(11,M,2,1,"ion-note",4),t.qZA(),t.TgZ(12,"ion-searchbar",5),t.NdJ("ngModelChange",function(s){return i.sMyQuery=s})("ionInput",function(s){return i.reloadList(s)})("ionCancel",function(s){return i.reloadList(s)}),t.qZA()(),t.YNc(13,J,5,4,"ion-content",3),t.TgZ(14,"ion-footer")(15,"ion-toolbar")(16,"ion-list"),t.YNc(17,N,3,0,"ion-button",6),t.qZA()()()),2&e&&(t.xp6(10),t.Q6J("ngIf",!i.competition),t.xp6(1),t.Q6J("ngIf",i.competition),t.xp6(1),t.Q6J("ngModel",i.sMyQuery),t.xp6(1),t.Q6J("ngIf",i.wkPgms&&i.wkPgms.length>0),t.xp6(4),t.Q6J("ngIf",i.isLoggedInAsClub()))},directives:[o.Gu,o.sr,o.Sm,o.oU,o.cs,o.wd,o.jY,o.Nd,o.wI,o.Q$,g.O5,o.Ie,o.t9,o.QI,h.JJ,h.On,g.sg,o.n0,o.uN,o.VI,o.j9,o.W2,o.q_,o.PQ,o.td,k,o.IK,o.u8,o.gu,o.fr,o.YG],pipes:[g.uU,g.Ov],styles:[""]}),n})()}];let F=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[g.ez,h.u5,o.Pc,u.Bz.forChild(w)]]}),n})()}}]);