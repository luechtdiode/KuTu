"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5969],{5969:(N,m,r)=>{r.r(m),r.d(m,{ClubregEditorPageModule:()=>U});var g=r(6814),c=r(95),p=r(335),o=r(3582),_=r(5861),b=r(8180),f=r(76),e=r(2029),h=r(4414),v=r(9253);function C(s,d){if(1&s&&(e.TgZ(0,"ion-radio",7),e._uU(1),e.qZA()),2&s){const t=d.$implicit;e.Q6J("value",t),e.xp6(1),e.Oqu(t.text)}}let A=(()=>{class s{constructor(){this.items=[],this.title="Select Items",this.selectionCancel=new e.vpe,this.selectionChange=new e.vpe,this.filteredItems=[],this.workingSelectedValue=void 0}ngOnInit(){this.filteredItems=[...this.items],this.workingSelectedValue={item:this.selectedItem,text:this.items.find(t=>t.item===this.selectedItem)?.text}}cancelChanges(){this.selectionCancel.emit()}confirmChanges(){this.selectionChange.emit(this.workingSelectedValue?.item)}searchbarInput(t){this.filterList(t.target.value)}filterList(t){if(void 0===t)this.filteredItems=[...this.items];else{const n=t.toLowerCase();this.filteredItems=this.items.filter(i=>i.text.toLowerCase().includes(n))}}get selected(){return this.workingSelectedValue}set selected(t){this.workingSelectedValue=t}static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-typeahead"]],inputs:{items:"items",selectedItem:"selectedItem",title:"title"},outputs:{selectionCancel:"selectionCancel",selectionChange:"selectionChange"},decls:17,vars:3,consts:[[3,"ionInput"],["color","light",1,"ion-padding"],[3,"ngModel","ngModelChange"],["class","alert-radio-label sc-ion-alert-md","labelPlacement","end",3,"value",4,"ngFor","ngForOf"],["slot","start"],[3,"click"],["slot","end"],["labelPlacement","end",1,"alert-radio-label","sc-ion-alert-md",3,"value"]],template:function(n,i){1&n&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e._uU(3),e.qZA()(),e.TgZ(4,"ion-toolbar")(5,"ion-searchbar",0),e.NdJ("ionInput",function(l){return i.searchbarInput(l)}),e.qZA()()(),e.TgZ(6,"ion-content",1)(7,"ion-radio-group",2),e.NdJ("ngModelChange",function(l){return i.selected=l}),e.YNc(8,C,2,2,"ion-radio",3),e.qZA()(),e.TgZ(9,"ion-footer")(10,"ion-toolbar")(11,"ion-buttons",4)(12,"ion-button",5),e.NdJ("click",function(){return i.cancelChanges()}),e._uU(13,"Abbrechen"),e.qZA()(),e.TgZ(14,"ion-buttons",6)(15,"ion-button",5),e.NdJ("click",function(){return i.confirmChanges()}),e._uU(16,"Okay"),e.qZA()()()()),2&n&&(e.xp6(3),e.Oqu(i.title),e.xp6(4),e.Q6J("ngModel",i.selected),e.xp6(1),e.Q6J("ngForOf",i.filteredItems))},dependencies:[g.sg,c.JJ,c.On,o.YG,o.Sm,o.W2,o.fr,o.Gu,o.B7,o.se,o.VI,o.wd,o.sr,o.U5,o.QI,o.j9],encapsulation:2})}return s})();function w(s,d){1&s&&(e.TgZ(0,"ion-button",25),e._UZ(1,"ion-icon",26),e._uU(2,"\xa0\xa0 Verein aus liste ausw\xe4hlen ..."),e.qZA())}function x(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"app-typeahead",29),e.NdJ("selectionChange",function(i){e.CHM(t),e.oxw();const a=e.MAs(1);return e.oxw(2).setVereinSelected(i),e.KtG(a.dismiss())})("selectionCancel",function(){e.CHM(t),e.oxw();const i=e.MAs(1);return e.KtG(i.dismiss())}),e.qZA()}if(2&s){const t=e.oxw(3);e.Q6J("items",t.clublist)("selectedItem",t.getVereinSelected)}}function Z(s,d){1&s&&(e.TgZ(0,"ion-modal",27,28),e.YNc(2,x,1,2,"ng-template"),e.qZA())}function I(s,d){if(1&s&&(e.TgZ(0,"ion-item")(1,"ion-avatar",0),e._UZ(2,"img",30),e.qZA(),e._UZ(3,"ion-input",31)(4,"ion-input",32),e.qZA()),2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("readonly",!1)("disabled",!1)("ngModel",t.newRegistration.secret),e.xp6(1),e.Q6J("readonly",!1)("disabled",!1)("ngModel",t.newRegistration.verification)}}function y(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-avatar",0),e._UZ(2,"img",30),e.qZA(),e.TgZ(3,"ion-input",33),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.changePassword.secret=i)}),e.qZA(),e.TgZ(4,"ion-input",34),e.NdJ("ngModelChange",function(i){e.CHM(t);const a=e.oxw(2);return e.KtG(a.changePassword.verification=i)}),e.qZA()()}if(2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("readonly",!1)("disabled",!1)("ngModel",t.changePassword.secret),e.xp6(1),e.Q6J("readonly",!1)("disabled",!1)("ngModel",t.changePassword.verification)}}function k(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-avatar",0),e._uU(2," \xa0 "),e.qZA(),e.TgZ(3,"ion-button",35,36),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.savePWChange())}),e._UZ(5,"ion-icon",23),e._uU(6,"Passwort \xe4ndern "),e.qZA()()}if(2&s){const t=e.oxw(2);e.xp6(3),e.Q6J("disabled",t.waiting||!t.changePassword.secret||t.changePassword.secret!==t.changePassword.verification)}}function T(s,d){if(1&s&&(e.TgZ(0,"ion-item"),e._uU(1),e.qZA()),2&s){const t=d.$implicit;e.xp6(1),e.hij(" ",t," ")}}function S(s,d){if(1&s){const t=e.EpF();e.TgZ(0,"ion-content"),e.YNc(1,w,3,0,"ion-button",7),e.YNc(2,Z,3,0,"ion-modal",8),e.TgZ(3,"form",9,10),e.NdJ("ngSubmit",function(){e.CHM(t);const i=e.MAs(4),a=e.oxw();return e.KtG(a.save(i))})("keyup.enter",function(){e.CHM(t);const i=e.MAs(4),a=e.oxw();return e.KtG(a.save(i))}),e.TgZ(5,"ion-list")(6,"ion-item-divider",11),e._uU(7,"Verein"),e.qZA(),e.TgZ(8,"ion-item")(9,"ion-avatar",0),e._UZ(10,"img",12),e.qZA(),e._UZ(11,"ion-input",13)(12,"ion-input",14),e.qZA(),e.TgZ(13,"ion-item-divider",11),e._uU(14,"Verantwortliche Person"),e.qZA(),e.TgZ(15,"ion-item")(16,"ion-avatar",0),e._UZ(17,"img",15),e.qZA(),e._UZ(18,"ion-input",16)(19,"ion-input",17),e.qZA(),e.YNc(20,I,5,6,"ion-item",4),e.YNc(21,y,5,6,"ion-item",4),e.YNc(22,k,7,1,"ion-item",4),e.TgZ(23,"ion-item-divider",11),e._uU(24,"Kontakt"),e.qZA(),e.TgZ(25,"ion-item")(26,"ion-avatar",0),e._UZ(27,"img",18),e.qZA(),e._UZ(28,"ion-input",19)(29,"ion-input",20),e.qZA()(),e.TgZ(30,"ion-button",21,22),e._UZ(32,"ion-icon",23),e._uU(33,"Speichern "),e.qZA()(),e.TgZ(34,"ion-list")(35,"ion-item-divider",11),e._uU(36),e.qZA(),e.YNc(37,T,2,1,"ion-item",24),e.qZA()()}if(2&s){const t=e.MAs(4),n=e.oxw();e.xp6(1),e.Q6J("ngIf",0===n.regId),e.xp6(1),e.Q6J("ngIf",0===n.regId),e.xp6(9),e.Q6J("readonly",!1)("autofocus",!0)("disabled",!1)("ngModel",n.registration.vereinname),e.xp6(1),e.Q6J("readonly",!1)("disabled",!1)("ngModel",n.registration.verband),e.xp6(6),e.Q6J("readonly",!1)("disabled",!1)("ngModel",n.registration.respVorname),e.xp6(1),e.Q6J("readonly",!1)("disabled",!1)("ngModel",n.registration.respName),e.xp6(1),e.Q6J("ngIf",0===n.regId),e.xp6(1),e.Q6J("ngIf",n.regId>0),e.xp6(1),e.Q6J("ngIf",n.regId>0),e.xp6(6),e.Q6J("readonly",!1)("disabled",!1)("ngModel",n.registration.mail),e.xp6(1),e.Q6J("readonly",!1)("disabled",!1)("ngModel",n.registration.mobilephone),e.xp6(1),e.Q6J("disabled",n.waiting||!t.valid||t.untouched),e.xp6(6),e.hij("Pendente Verarbeitungen (",n.sSyncActions.length,")"),e.xp6(1),e.Q6J("ngForOf",n.sSyncActions)}}let P=(()=>{class s{constructor(t,n,i,a,l,q){this.navCtrl=t,this.route=n,this.backendService=i,this.alertCtrl=a,this.actionSheetController=l,this.zone=q,this.waiting=!1,this.sSyncActions=[],this.clublist=[],this.backendService.competitions||this.backendService.getCompetitions(),this.backendService.getClubList().subscribe(E=>{this.clublist=E.map(u=>({item:u,text:u.name+" ("+u.verband+")"}))})}get getVereinSelected(){return this._selectedVerein}setVereinSelected(t){this._selectedVerein=t,this.newRegistration.vereinname=t.name,this.newRegistration.verband=t.verband}ngOnInit(){this.waiting=!0,this.wkId=this.route.snapshot.paramMap.get("wkId"),this.regId=parseInt(this.route.snapshot.paramMap.get("regId")),this.backendService.getCompetitions().subscribe(t=>{this.wettkampfId=parseInt(t.find(n=>n.uuid===this.wkId).id),this.regId?this.backendService.getClubRegistrations(this.wkId).subscribe(n=>{n&&n.length>0&&this.updateUI(n.find(i=>i.id===this.regId))}):this.updateUI({mobilephone:"+417"})})}filter(t){const n=t.toUpperCase().split(" ");return i=>"*"===t.trim()||n.filter(a=>{if(i.name.toUpperCase().indexOf(a)>-1||i.verband.toUpperCase().indexOf(a)>-1)return!0}).length===n.length}presentActionSheet(){var t=this;return(0,_.Z)(function*(){let n={};n=t.registration.vereinId?{header:"Anmeldungen",cssClass:"my-actionsheet-class",buttons:[{text:"Athlet & Athletinnen",icon:"list",handler:()=>{t.editAthletRegistrations()}},{text:"Wertungsrichter",icon:"glasses",handler:()=>{t.editJudgeRegistrations()}},{text:"Kopieren aus anderem Wettkampf",icon:"share",handler:()=>{t.copyFromOthers()}},{text:"Registrierung l\xf6schen",role:"destructive",icon:"trash",handler:()=>{t.delete()}},{text:"Abbrechen",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]}:{header:"Anmeldungen",cssClass:"my-actionsheet-class",buttons:[{text:"Athlet & Athletinnen",icon:"list",handler:()=>{t.editAthletRegistrations()}},{text:"Wertungsrichter",icon:"glasses",handler:()=>{t.editJudgeRegistrations()}},{text:"Registrierung l\xf6schen",role:"destructive",icon:"trash",handler:()=>{t.delete()}},{text:"Abbrechen",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]},yield(yield t.actionSheetController.create(n)).present()})()}editable(){return this.backendService.loggedIn}ionViewWillEnter(){this.getSyncActions()}getSyncActions(){this.regId>0&&this.backendService.loadRegistrationSyncActions().pipe((0,b.q)(1)).subscribe(t=>{this.sSyncActions=t.filter(n=>n.verein.id===this.registration.id).map(n=>n.caption)})}updateUI(t){this.zone.run(()=>{this.waiting=!1,this.wettkampf=this.backendService.competitionName,this.registration=t,t&&(0===this.regId?this.newRegistration=t:this.changePassword={id:this.regId,wettkampfId:t.wettkampfId||this.wettkampfId,secret:"",verification:""},this.registration.mail&&this.registration.mail.length>1&&(this.backendService.currentUserName=this.registration.mail))})}savePWChange(){this.changePassword&&this.changePassword.secret&&this.changePassword.secret===this.changePassword.verification&&this.backendService.saveClubRegistrationPW(this.wkId,this.changePassword)}save(t){if(!t.valid)return;const n=t.value;if(0===this.regId){const i=n;i.secret!==i.verification?this.alertCtrl.create({header:"Achtung",subHeader:"Passwort-Verifikation",message:"Das Passwort stimmt nicht mit der Verifikation \xfcberein. Beide m\xfcssen genau gleich erfasst sein.",buttons:[{text:"OKAY",role:"cancel",handler:()=>{}}]}).then(l=>l.present()):this.backendService.createClubRegistration(this.wkId,{mail:i.mail,mobilephone:i.mobilephone,respName:i.respName,respVorname:i.respVorname,verband:i.verband,vereinname:i.vereinname,wettkampfId:i.wettkampfId||this.wettkampfId,secret:i.secret}).subscribe(l=>{this.regId=l.id,this.registration=l,this.backendService.currentUserName=l.mail,this.presentActionSheet()})}else this.backendService.saveClubRegistration(this.wkId,{id:this.registration.id,registrationTime:this.registration.registrationTime,vereinId:this.registration.vereinId,mail:n.mail,mobilephone:n.mobilephone,respName:n.respName,respVorname:n.respVorname,verband:n.verband,vereinname:n.vereinname,wettkampfId:n.wettkampfId||this.wettkampfId})}delete(){this.alertCtrl.create({header:"Achtung",subHeader:"L\xf6schen der Vereins-Registrierung und dessen Anmeldungen am Wettkampf",message:"Hiermit wird die Vereinsanmeldung am Wettkampf komplett gel\xf6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.deleteClubRegistration(this.wkId,this.regId).subscribe(()=>{this.navCtrl.pop()})}}]}).then(n=>n.present())}editAthletRegistrations(){this.navCtrl.navigateForward(`reg-athletlist/${this.backendService.competition}/${this.regId}`)}editJudgeRegistrations(){this.navCtrl.navigateForward(`reg-judgelist/${this.backendService.competition}/${this.regId}`)}copyFromOthers(){this.backendService.findCompetitionsByVerein(this.registration.vereinId).subscribe(t=>{const n=t.map(i=>({type:"radio",label:i.titel+" ("+(0,f.tC)(i.datum)+")",value:i}));this.alertCtrl.create({header:"Anmeldungen kopieren",cssClass:"my-optionselection-class",message:"Aus welchem Wettkampf sollen die Anmeldungen kopiert werden?",inputs:n,buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:i=>{this.backendService.copyClubRegsFromCompetition(i,this.backendService.competition,this.registration.id).subscribe(()=>{this.getSyncActions(),this.alertCtrl.create({header:"Anmeldungen kopieren",message:"Alle nicht bereits erfassten Anmeldungen wurden \xfcbernommen.",buttons:[{text:"OKAY",role:"cancel",handler:()=>{}},{text:"> Athlet-Anmeldungen",handler:()=>{this.editAthletRegistrations()}},{text:"> WR Anmeldungen",handler:()=>{this.editJudgeRegistrations()}}]}).then(a=>a.present())})}}]}).then(i=>i.present())})}static#e=this.\u0275fac=function(n){return new(n||s)(e.Y36(h.SH),e.Y36(p.gz),e.Y36(v.v),e.Y36(h.Br),e.Y36(h.BX),e.Y36(e.R0b))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-clubreg-editor"]],decls:15,vars:3,consts:[["slot","start"],["defaultHref","/"],["slot","end"],[1,"athlet"],[4,"ngIf"],["size","large","expand","block","color","primary",3,"disabled","click"],["slot","start","name","list"],["id","searchClubPresets","size","large","expand","block",4,"ngIf"],["trigger","searchClubPresets",4,"ngIf"],[3,"ngSubmit","keyup.enter"],["clubRegistrationform","ngForm"],["color","primary"],["src","assets/imgs/verein.png"],["placeholder","Vereinsname","autocomplete","true","type","text","name","vereinname","required","",3,"readonly","autofocus","disabled","ngModel"],["placeholder","Verband","autocomplete","true","type","text","name","verband","required","",3,"readonly","disabled","ngModel"],["src","assets/imgs/chief.png"],["placeholder","Vorname","type","text","autocomplete","given-name","name","respVorname","required","",3,"readonly","disabled","ngModel"],["placeholder","Nachname","type","text","autocomplete","name","name","respName","required","",3,"readonly","disabled","ngModel"],["src","assets/imgs/atmail.png"],["placeholder","Mail","type","email","autocomplete","email","pattern","^[_a-z0-9-]+(\\.[_a-z0-9-]+)*@[a-z0-9-]+(\\.[a-z0-9-]+)*(\\.[a-z]{2,5})$","name","mail","required","",3,"readonly","disabled","ngModel"],["placeholder","Mobile/SMS (+4179...)","type","tel","autocomplete","on","pattern","[+]{1}[0-9]{11,14}","name","mobilephone","required","",3,"readonly","disabled","ngModel"],["size","large","expand","block","type","submit","color","success",3,"disabled"],["btnSaveNext",""],["slot","start","name","save"],[4,"ngFor","ngForOf"],["id","searchClubPresets","size","large","expand","block"],["name","search-outline","ios","md-search-outline"],["trigger","searchClubPresets"],["modal",""],["title","Vorbelegen mit",1,"ion-page",3,"items","selectedItem","selectionChange","selectionCancel"],["src","assets/imgs/password.png"],["placeholder","Passwort","type","password","name","secret","required","",3,"readonly","disabled","ngModel"],["placeholder","Passwort best\xe4tigen","type","password","name","verification","required","",3,"readonly","disabled","ngModel"],["placeholder","Passwort","type","password","name","secret",3,"readonly","disabled","ngModel","ngModelChange"],["placeholder","Passwort best\xe4tigen","type","password","name","verification",3,"readonly","disabled","ngModel","ngModelChange"],["size","small","color","danger",3,"disabled","click"],["btnChangePassword",""]],template:function(n,i){1&n&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5,"Vereins-Registrierung"),e.qZA(),e.TgZ(6,"ion-note",2)(7,"div",3),e._uU(8),e.qZA()()()(),e.YNc(9,S,38,27,"ion-content",4),e.TgZ(10,"ion-footer")(11,"ion-toolbar")(12,"ion-button",5),e.NdJ("click",function(){return i.presentActionSheet()}),e._UZ(13,"ion-icon",6),e._uU(14,"Anmeldungen... "),e.qZA()()()),2&n&&(e.xp6(8),e.hij("f\xfcr ",i.wettkampf,""),e.xp6(1),e.Q6J("ngIf",i.registration),e.xp6(3),e.Q6J("disabled",i.waiting||0===i.regId))},dependencies:[g.sg,g.O5,c._Y,c.JJ,c.JL,c.Q7,c.c5,c.On,c.F,o.BJ,o.YG,o.Sm,o.W2,o.fr,o.Gu,o.gu,o.pK,o.Ie,o.rH,o.q_,o.uN,o.wd,o.sr,o.ki,o.j9,o.oU,A]})}return s})();var M=r(3573);const J=[{path:"",component:P}];let U=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.oAB({type:s});static#n=this.\u0275inj=e.cJS({imports:[g.ez,c.u5,o.Pc,p.Bz.forChild(J),M.K]})}return s})()}}]);