(self.webpackChunkresultcatcher=self.webpackChunkresultcatcher||[]).push([[6489],{6489:(e,t,i)=>{"use strict";i.r(t),i.d(t,{RegistrationPageModule:()=>N});var n=i(8583),s=i(665),o=i(881),r=i(2859),c=i(4762),a=i(7709),l=i(6215),u=i(5917),g=i(5435),d=i(8002),p=i(4395),h=i(7519),m=i(3342),b=i(3190),f=i(8819),Z=i(5257),A=i(8186),k=i(600);let x=(()=>{class e{constructor(){this.selected=new A.vpe}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=A.Xpm({type:e,selectors:[["clublist-item"]],inputs:{clubregistration:"clubregistration",status:"status"},outputs:{selected:"selected"},decls:10,vars:5,consts:[[3,"click"],["slot","start"],["src","assets/imgs/verein.png"],["slot","end"]],template:function(e,t){1&e&&(A.TgZ(0,"ion-item",0),A.NdJ("click",function(){return t.selected?t.selected.emit(t.clubregistration):{}}),A.TgZ(1,"ion-avatar",1),A._UZ(2,"img",2),A.qZA(),A.TgZ(3,"ion-label"),A._uU(4),A._UZ(5,"br"),A.TgZ(6,"small"),A._uU(7),A.qZA(),A.qZA(),A.TgZ(8,"ion-note",3),A._uU(9),A.qZA(),A.qZA()),2&e&&(A.xp6(4),A.AsE("",t.clubregistration.vereinname,", ",t.clubregistration.verband,""),A.xp6(3),A.AsE("(",t.clubregistration.respVorname," ",t.clubregistration.respName,")"),A.xp6(2),A.hij(" Status ",t.status," "))},directives:[r.Ie,r.BJ,r.Q$,r.uN],styles:[""]}),e})();function v(e,t){if(1&e&&(A.TgZ(0,"ion-select-option",10),A._uU(1),A.ALo(2,"date"),A.qZA()),2&e){const e=t.$implicit;A.Q6J("value",e.uuid),A.xp6(1),A.hij(" ",e.titel+" "+A.xi3(2,2,e.datum,"dd-MM-yy"),"")}}function C(e,t){if(1&e){const e=A.EpF();A.TgZ(0,"ion-select",8),A.NdJ("ngModelChange",function(t){return A.CHM(e),A.oxw().competition=t}),A.YNc(1,v,3,5,"ion-select-option",9),A.qZA()}if(2&e){const e=A.oxw();A.Q6J("ngModel",e.competition),A.xp6(1),A.Q6J("ngForOf",e.getCompetitions())}}function y(e,t){1&e&&(A.TgZ(0,"ion-item"),A.TgZ(1,"ion-label"),A._uU(2,"loading ..."),A.qZA(),A._UZ(3,"ion-spinner"),A.qZA())}function w(e,t){if(1&e){const e=A.EpF();A.TgZ(0,"ion-item-option",19),A.NdJ("click",function(){A.CHM(e),A.oxw();const t=A.MAs(1);return A.oxw(2).logout(t)}),A._UZ(1,"ion-icon",16),A._uU(2," Abmelden "),A.qZA()}}function S(e,t){if(1&e){const e=A.EpF();A.TgZ(0,"ion-item-option",20),A.NdJ("click",function(){A.CHM(e);const t=A.oxw().$implicit,i=A.MAs(1);return A.oxw(2).delete(t,i)}),A._UZ(1,"ion-icon",16),A._uU(2," L\xf6schen "),A.qZA()}}function T(e,t){if(1&e){const e=A.EpF();A.TgZ(0,"ion-item-sliding",null,12),A.TgZ(2,"clublist-item",13),A.NdJ("click",function(){const t=A.CHM(e).$implicit,i=A.MAs(1);return A.oxw(2).itemTapped(t,i)}),A.qZA(),A.TgZ(3,"ion-item-options",14),A.TgZ(4,"ion-item-option",15),A.NdJ("click",function(){const t=A.CHM(e).$implicit,i=A.MAs(1);return A.oxw(2).login(t,i)}),A._UZ(5,"ion-icon",16),A._uU(6),A.qZA(),A.YNc(7,w,3,0,"ion-item-option",17),A.YNc(8,S,3,0,"ion-item-option",18),A.qZA(),A.qZA()}if(2&e){const e=t.$implicit,i=A.oxw(2);A.xp6(2),A.Q6J("clubregistration",e)("status",i.getStatus(e)),A.xp6(4),A.hij(" ",i.isLoggedIn(e)?"Bearbeiten":"Login"," "),A.xp6(1),A.Q6J("ngIf",i.isLoggedIn(e)),A.xp6(1),A.Q6J("ngIf",i.isLoggedIn(e))}}function I(e,t){if(1&e&&(A.TgZ(0,"ion-content"),A.TgZ(1,"ion-list"),A.YNc(2,y,4,0,"ion-item",5),A.ALo(3,"async"),A.YNc(4,T,9,5,"ion-item-sliding",11),A.qZA(),A.qZA()),2&e){const e=A.oxw();A.xp6(2),A.Q6J("ngIf",A.lcZ(3,2,e.isBusy)),A.xp6(2),A.Q6J("ngForOf",e.filteredStartList)}}function q(e,t){if(1&e){const e=A.EpF();A.TgZ(0,"ion-button",21),A.NdJ("click",function(){return A.CHM(e),A.oxw().createRegistration()}),A._UZ(1,"ion-icon",22),A._uU(2," Neue Anmeldung... "),A.qZA()}}function L(e,t){if(1&e){const e=A.EpF();A.TgZ(0,"ion-button",23,24),A.NdJ("click",function(){return A.CHM(e),A.oxw().logout(null)}),A.ALo(2,"async"),A._UZ(3,"ion-icon",25),A._uU(4,"Vereins-Login Abmelden"),A.qZA()}if(2&e){const e=A.oxw();A.Q6J("disabled",A.lcZ(2,1,e.isBusy))}}const M=[{path:"",component:(()=>{class e{constructor(e,t,i,n,s){this.navCtrl=e,this.route=t,this.backendService=i,this.toastController=n,this.alertCtrl=s,this.sSyncActions=[],this.tMyQueryStream=new a.xQ,this.sFilterTask=void 0,this.busy=new l.X(!1),this.backendService.competitions||this.backendService.getCompetitions()}ngOnInit(){this.busy.next(!0);const e=this.route.snapshot.paramMap.get("wkId");e?this.competition=e:this.backendService.competition&&(this.competition=this.backendService.competition)}ionViewWillEnter(){this.getSyncActions()}get stationFreezed(){return this.backendService.stationFreezed}set competition(e){this.clubregistrations&&e===this.backendService.competition||(this.busy.next(!0),this.clubregistrations=[],this.backendService.getClubRegistrations(e).subscribe(e=>{this.clubregistrations=e,this.busy.next(!1),this.tMyQueryStream.pipe((0,g.h)(e=>!!e&&!!e.target),(0,d.U)(e=>e.target.value||"*"),(0,p.b)(300),(0,h.x)(),(0,m.b)(e=>this.busy.next(!0)),(0,b.w)(this.runQuery(e)),(0,f.B)()).subscribe(e=>{this.sFilteredRegistrationList=e,this.busy.next(!1)})}))}get competition(){return this.backendService.competition||""}set clubregistrations(e){this.sClubRegistrationList=e,this.reloadList(this.sMyQuery)}get clubregistrations(){return this.sClubRegistrationList}get filteredStartList(){return this.sFilteredRegistrationList||this.sClubRegistrationList}get isBusy(){return this.busy}getSyncActions(){this.backendService.loadRegistrationSyncActions().pipe((0,Z.q)(1)).subscribe(e=>{this.sSyncActions=e})}getStatus(e){return this.sSyncActions?this.sSyncActions.find(t=>t.verein.id===e.id)?"Abgleich ausstehend":"Nachgef\xfchrt":"n/a"}runQuery(e){return t=>{const i=t.trim(),n=[];return i&&e&&e.forEach(e=>{this.filter(i)(e)&&n.push(e)}),(0,u.of)(n)}}reloadList(e){this.tMyQueryStream.next(e)}itemTapped(e,t){t.getOpenAmount().then(e=>{e>0?t.close():t.open("end")})}isLoggedIn(e){return this.backendService.loggedIn&&this.backendService.authenticatedClubId===e.id+""}isLoggedInAsClub(){return this.backendService.loggedIn&&!!this.backendService.authenticatedClubId}logout(e){e&&e.close(),this.alertCtrl.create({header:"Achtung",message:"F\xfcr sp\xe4tere Bearbeitungen an der Registrierung des Vereins am Wettkampf ist ein erneutes Login notwendig.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.clublogout()}}]}).then(e=>e.present())}delete(e,t){t.close(),this.alertCtrl.create({header:"Achtung",subHeader:"L\xf6schen der Vereins-Registrierung und dessen Anmeldungen am Wettkampf",message:"Hiermit wird die Vereinsanmeldung am Wettkampf komplett gel\xf6scht.",buttons:[{text:"ABBRECHEN",role:"cancel",handler:()=>{}},{text:"OKAY",handler:()=>{this.backendService.deleteClubRegistration(this.competition,e.id)}}]}).then(e=>e.present())}showPasswordResetSuccess(){return(0,c.mG)(this,void 0,void 0,function*(){(yield this.toastController.create({header:"Passwort-Reset",message:"Es wurde eine EMail mit dem Reset-Link versendet!",animated:!0,position:"middle",buttons:[{text:"OK",role:"cancel"}]})).present()})}login(e,t){t.close(),this.isLoggedIn(e)?this.navCtrl.navigateForward(`registration/${this.competition}/${e.id}`):this.alertCtrl.create({header:"Vereins-Login",message:`Login f\xfcr die Bearbeitung der Vereinsanmeldung am Wettkampf ${this.competitionName()}`,inputs:[{name:"username",label:"Vereinsname",placeholder:"Vereinsname",value:`${e.vereinname} (${e.verband})`,type:"text"},{name:"pw",label:"Passwort",placeholder:"Passwort",type:"password"}],buttons:[{text:"Abbrechen",role:"cancel",handler:()=>{console.log("Cancel clicked")}},{text:"Login",handler:t=>!!(t.pw&&t.pw.trim().length>0)&&(this.backendService.clublogin(e.id,t.pw).pipe((0,Z.q)(1)).subscribe(t=>{this.navCtrl.navigateForward(`registration/${this.competition}/${e.id}`)},t=>{401===t.status&&this.alertCtrl.create({header:"Vereins-Login Fehlgeschlagen",message:`Soll f\xfcr diese Vereinsanmeldung am Wettkampf ${this.competitionName()} ein Passwort-Reset Vorgang gestartet werden?`,inputs:[],buttons:[{text:"Abbrechen",role:"cancel",handler:()=>(console.log("Cancel clicked"),!1)},{text:"Passwort-Reset",handler:()=>(this.backendService.resetRegistration(e.id).pipe((0,Z.q)(1)).subscribe(()=>{this.showPasswordResetSuccess()}),!0)}]}).then(e=>{e.present()})}),!0)}]}).then(e=>{e.onkeypress=t=>{"Enter"===t.code&&e.getElementsByClassName("ion-activatable")[1].click()},e.present()})}createRegistration(){this.navCtrl.navigateForward(`registration/${this.competition}/0`)}getCompetitions(){return this.backendService.competitions||[]}competitionName(){return this.backendService.competitionName}filter(e){const t=e.toUpperCase().split(" ");return i=>"*"===e.trim()||t.filter(e=>i.vereinname.toUpperCase().indexOf(e)>-1||i.verband.toUpperCase().indexOf(e)>-1||i.mail.toUpperCase().indexOf(e)>-1||i.respName.toUpperCase().indexOf(e)>-1||i.respVorname.toUpperCase().indexOf(e)>-1||void 0).length===t.length}}return e.\u0275fac=function(t){return new(t||e)(A.Y36(r.SH),A.Y36(o.gz),A.Y36(k.v),A.Y36(r.yF),A.Y36(r.Br))},e.\u0275cmp=A.Xpm({type:e,selectors:[["app-registration"]],decls:18,vars:5,consts:[["slot","start"],["slot","icon-only","name","menu"],["slot","end"],["placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange",4,"ngIf"],["placeholder","Search","showCancelButton","never",3,"ngModel","ngModelChange","ionInput","ionCancel"],[4,"ngIf"],["size","large","expand","block","color","success",3,"click",4,"ngIf"],["size","large","expand","block","color","danger",3,"disabled","click",4,"ngIf"],["placeholder","Bitte ausw\xe4hlen","okText","Okay","cancelText","Abbrechen",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngFor","ngForOf"],["slidingClubRegistrationItem",""],[3,"clubregistration","status","click"],["side","end"],["color","primary",3,"click"],["name","arrow-dropright-circle","ios","md-arrow-dropright-circle"],["color","secondary",3,"click",4,"ngIf"],["color","danger",3,"click",4,"ngIf"],["color","secondary",3,"click"],["color","danger",3,"click"],["size","large","expand","block","color","success",3,"click"],["slot","start","name","add"],["size","large","expand","block","color","danger",3,"disabled","click"],["btnDelete",""],["slot","start","name","log-out"]],template:function(e,t){1&e&&(A.TgZ(0,"ion-header"),A.TgZ(1,"ion-toolbar"),A.TgZ(2,"ion-buttons",0),A.TgZ(3,"ion-menu-toggle"),A.TgZ(4,"ion-button"),A._UZ(5,"ion-icon",1),A.qZA(),A.qZA(),A.qZA(),A.TgZ(6,"ion-title"),A.TgZ(7,"ion-label"),A._uU(8,"Wettkampf-Anmeldungen"),A.qZA(),A.qZA(),A.TgZ(9,"ion-buttons",2),A.YNc(10,C,2,2,"ion-select",3),A.qZA(),A.qZA(),A.TgZ(11,"ion-searchbar",4),A.NdJ("ngModelChange",function(e){return t.sMyQuery=e})("ionInput",function(e){return t.reloadList(e)})("ionCancel",function(e){return t.reloadList(e)}),A.qZA(),A.qZA(),A.YNc(12,I,5,4,"ion-content",5),A.TgZ(13,"ion-footer"),A.TgZ(14,"ion-toolbar"),A.TgZ(15,"ion-list"),A.YNc(16,q,3,0,"ion-button",6),A.YNc(17,L,5,3,"ion-button",7),A.qZA(),A.qZA(),A.qZA()),2&e&&(A.xp6(10),A.Q6J("ngIf",t.getCompetitions().length>0),A.xp6(1),A.Q6J("ngModel",t.sMyQuery),A.xp6(1),A.Q6J("ngIf",t.competition&&t.clubregistrations),A.xp6(4),A.Q6J("ngIf",!t.isLoggedInAsClub()),A.xp6(1),A.Q6J("ngIf",t.isLoggedInAsClub()))},directives:[r.Gu,r.sr,r.Sm,r.zc,r.YG,r.gu,r.wd,r.Q$,n.O5,r.VI,r.j9,s.JJ,s.On,r.fr,r.q_,r.t9,r.QI,n.sg,r.n0,r.W2,r.Ie,r.PQ,r.td,x,r.IK,r.u8],pipes:[n.uU,n.Ov],styles:[""]}),e})()}];let N=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=A.oAB({type:e}),e.\u0275inj=A.cJS({imports:[[n.ez,s.u5,r.Pc,o.Bz.forChild(M)]]}),e})()}}]);